const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{args:Object},data:function(){return{files:[],remoteFiles:[],maxUpload:this.uipress.uipAppData.options.maxUpload,modalOpen:!1,fileTypes:this.uipress.uipAppData.options.uploadTypes,query:{page:0,search:""},totalPages:0,loading:!1,ui:{uploadEnabled:!0,deleteEnabled:!0,dropping:!1,activeTab:"library",view:"grid",tabs:[{name:"library",label:__("Library","uipress-lite")},{name:"stock",label:"Unsplash"}],strings:{searchMedia:__("Search media","uipress-lite"),gridView:__("Grid view","uipress-lite"),listView:__("List view","uipress-lite"),listView:__("List view","uipress-lite"),add:__("Choose image","uipress-lite"),full:__("Full size","uipress-lite"),regular:__("Medium","uipress-lite"),small:__("Small","uipress-lite"),thumb:__("Thumbnail","uipress-lite"),upload:__("Upload","uipress-lite"),delete:__("Delete","uipress-lite"),photoBy:__("Photo by","uipress-lite"),on:__("on","uipress-lite")}}}},inject:["uipress"],watch:{"query.page":{handler(t,e){this.getImages()},deep:!0},"query.search":{handler(t,e){""==t&&(this.query.page=0,this.files=[],this.getImages())},deep:!0},"ui.activeTab":{handler(t,e){this.getImages()},deep:!0}},mounted:function(){this.getImages(),this.enableFeatures(),requestAnimationFrame(()=>{document.documentElement.addEventListener("click",this.onClickOutside,!1)})},computed:{selected(){let t=[];if("library"==this.ui.activeTab)for(const e of this.files)e.selected&&t.push(e);if("stock"==this.ui.activeTab)for(const e of this.remoteFiles)e.selected&&t.push(e);return t[0],t},selectedIDS(){let t=[];if("library"==this.ui.activeTab)for(const e of this.files)e.selected&&t.push(e.id);return t}},methods:{enableFeatures(){this.args&&this.uipress.isObject(this.args)&&Array.isArray(this.args.features)&&(this.args.features.includes("stock")||this.ui.tabs.splice(1,1),this.args.features.includes("upload")||(this.ui.uploadEnabled=!1),this.args.features.includes("delete")||(this.ui.deleteEnabled=!1))},searchLibrary(){this.query.page=0,this.files=[],this.remoteFiles=[],this.getImages()},watchScroll({target:{scrollTop:t,clientHeight:e,scrollHeight:i}}){t+e>=i&&this.query.page<this.totalPages&&(this.query.page+=1)},onClickOutside(){if("inline"==this.args.style)return;if(!this.$refs.uipMedia)return;if(this.modalOpen)return;const t=event.path||(event.composedPath?event.composedPath():void 0);!t||t.includes(this.$refs.uipMedia)||this.$refs.uipMedia.contains(event.target)||this.destroyGallery()},getImages(t,e){let i=this;if(i.loading=!0,"stock"==i.ui.activeTab)return void this.fetchRemote();e&&(i.query.page=1);let s=!1;i.args.limitToAuthor&&(s=!0);let a=20;"perPage"in i.args&&(""!=i.args.perPage||i.args.perPage>0)&&(a=i.args.perPage);let p=new FormData;if(p.append("action","uip_get_media"),p.append("security",uip_ajax.security),p.append("search",i.query.search),p.append("page",i.query.page),p.append("limitToAuthor",s),p.append("perPage",a),i.args.fileTypes){let t=JSON.stringify(i.args.fileTypes);p.append("fileTypes",t)}i.uipress.callServer(uip_ajax.ajax_url,p).then(e=>{e.error&&(i.uipress.notify(e.message,"uipress-lite","","error",!0),i.loading=!1),e.success&&(i.files=t?e.media:i.files.concat(e.media),i.totalPages=e.totalPages,i.loading=!1)})},fetchRemote(){let t=this;if(t.remoteFiles.length>0&&""==t.query.search)return void(t.loading=!1);let e=new FormData,i="https://api.uipress.co/unsplash/?key=0e49uptg-aw[e0ifjhiljsoevjhbsoe8gilplhirlvi&s="+t.query.search;t.uipress.callServer(i,e).then(e=>{e.error&&(t.uipress.notify(e.message,"uipress-lite","","error",!0),t.loading=!1),t.loading=!1,t.remoteFiles=e})},selectImage(t){if(0==this.args.multiple){if("library"==this.ui.activeTab)for(const e of this.files)e.id!=t.id&&(e.selected=!1);if("stock"==this.ui.activeTab)for(const e of this.remoteFiles)e.id!=t.id&&(e.selected=!1)}t.selected=!t.selected},destroyGallery(){let t=new CustomEvent("uip_remove_media_gallery");document.dispatchEvent(t),document.documentElement.removeEventListener("click",this.onClickOutside,!1)},chooseImage(t){let e=this,i=this.selected;if(this.args.multiple||("alt_description"in(i=i[0])?i={name:i.alt_description,url:i.urls[t]}:i.url=i.urls[t]),"links"in this.selected[0]){let t=this.selected[0].id,i=new FormData,s="https://api.uipress.co/unsplash/download.php?key=0e49uptg-aw[e0ifjhiljsoevjhbsoe8gilplhirlvi&id="+t;e.uipress.callServer(s,i).then(t=>{})}let s=new CustomEvent("uip_media_selected",{detail:{files:i}});document.dispatchEvent(s),this.destroyGallery()},formatDate(t){let e=new Date("2011-04-11T10:20:30Z"),i=e.getMonth()+1,s=e.getDate(),a=e.getFullYear();return s<10&&(s="0"+s),i<10&&(i="0"+i),s+"/"+i+"/"+a},getfilesFromInput(){if(!this.ui.uploadEnabled)return;let t=this.$refs.manualFileUpload.files;if(t.length>0){let e={dataTransfer:{}};e.dataTransfer.files=t,this.uploadImages(e)}},uploadImages(t){if(!this.ui.uploadEnabled)return;let e=this;e.loading=!0,this.ui.dropping=!1;let i=t.dataTransfer.files,s=e.uipress.notify(__("Uploading files","uipress-lite"),"","default",!1,!0),a=Array.from(i).map(async t=>await e.uploadImage(t));Promise.all(a).then(t=>{e.loading=!1,e.getImages(!0);let i=t.filter(t=>0==t).length;e.uipress.notify(__("Upload finsihed","uipress-lite"),i+__(" errors","uipress-lite"),"success",!0,!1),e.uipress.destroy_notification(s)})},highlightDrop(){this.ui.uploadEnabled&&(this.ui.dropping=!0)},dragEnd(){this.ui.dropping=!1},async uploadImage(t){let e=this;if(t.size>e.maxUpload)return e.uipress.notify(__("File exceeds max upload size","uipress-lite"),t.name,"error",!0,!1),e.uploading=!1,!1;if(!e.fileTypes.includes(t.type))return e.uipress.notify(__("Unable to upload this file type","uipress-lite"),"","error",!0,!1),e.uploading=!1,!1;let i=new FormData;return i.append("action","uip_upload_image"),i.append("security",uip_ajax.security),i.append("image",t),i.append("file",t),await fetch(uip_ajax.ajax_url,{method:"POST",body:i,ContentType:!1,processData:!1,headers:{processData:!1,"process-Data":!1}}).then(t=>t.text()).then(i=>{return e.uipress.uipParsJson(i).success?(e.uipress.notify(__("File uploaded","uipress-lite"),t.name,"success",!0,!1),!0):(e.uipress.notify(__("Unable to handle upload","uipress-lite"),t.name,"error",!0,!1),!1)}).catch(t=>(e.uipress.notify(t,"","error"),!1))},deleteSelected(){let t=this,e=this.selectedIDS;t.modalOpen=!0,e=JSON.stringify(e),t.uipress.confirm(__("Are you sure?","uipress-lite"),__("Are you sure you want to delete this? Once deleted this item can't be recovered"),__("Delete","uipress-lite")).then(i=>{if(i){let i=t.uipress.notify(__("Deleting selected files","uipress-lite"),"","default",!1,!0);t.loading=!0;let s=new FormData;s.append("action","uip_delete_post"),s.append("security",uip_ajax.security),s.append("id",e),t.uipress.callServer(uip_ajax.ajax_url,s).then(s=>{if(s.error&&(t.uipress.notify(s.message,"uipress-lite","","error",!0),t.loading=!1,t.uipress.destroy_notification(i),t.modalOpen=!1),s.success){t.uipress.notify(__("Items deleted","uipress-lite"),s.errorCount+" errors","success",!0),t.loading=!1,t.uipress.destroy_notification(i),t.modalOpen=!1;for(let i of JSON.parse(e)){let e=t.files.findIndex(t=>t.id==i);t.files.splice(e,1)}}})}})},ifMimeType(t,e){for(const i of t)if(e.includes(i))return!0;return!1}},template:'\n\t<div ref="uipMedia" class="uip-max-w-100p uip-position-relative uip-text-normal" :class="{\'uip-w-700\' : args.style != \'inline\'}">\n\t\t<div class="uip-flex uip-flex-row uip-flex-between">\n\t\t\t<div class="uip-flex uip-flex-row uip-gap-s uip-margin-bottom-s">\n\t\t\t\t<template v-for="tab in ui.tabs">\n\t\t\t\t\t<div class="uip-link-muted uip-padding-bottom-s" :class="{\'uip-border-bottom-primary uip-text-bold uip-text-emphasis\' : ui.activeTab == tab.name}" @click="ui.activeTab = tab.name">{{tab.label}}</div>\n\t\t\t\t</template>\n\t\t\t\t<label v-if="ui.uploadEnabled">\n\t\t\t\t\t<div class="uip-flex uip-gap-xxs uip-padding-bottom-s uip-flex uip-flex-center">\n\t\t\t\t\t\t<div class="uip-icon uip-icon-medium uip-link-default">file_upload</div>\n\t\t\t\t\t\t<div class="uip-link-muted">{{ui.strings.upload}}</div>\n\t\t\t\t\t\t<input hidden :accept="fileTypes.toString()" type="file"  ref="manualFileUpload" @change="getfilesFromInput()" multiple>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div v-if="args.style != \'inline\'" class="uip-link-muted uip-text-l uip-icon uip-icon-medium" @click="destroyGallery()">close</div>\n\t\t</div>\n\t\t<div class="">\n\t\t\t\x3c!--TOOLBAR --\x3e\n\t\t\t<div class="uip-flex uip-flex-row uip-flex-between">\n\t\t\t\t<div class="uip-flex uip-padding-xxs uip-border uip-search-block uip-border-round uip-margin-bottom-s">\n\t\t\t\t\t<span class="uip-icon uip-text-muted uip-margin-right-xs uip-text-l uip-icon uip-icon-medium">search</span>\n\t\t\t\t\t<input class="uip-blank-input uip-flex-grow uip-text-s" type="text" :placeholder="ui.strings.searchMedia" v-model="query.search" v-on:keyup.enter="searchLibrary()">\n\t\t\t\t\t<span class="uip-icon uip-text-muted uip-icon uip-icon-medium uip-padding-xxxs uip-border-round uip-border">keyboard_return</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="uip-flex uip-flex-row uip-flex-gap-s">\n\t\t\t\t\t<uip-tooltip :message="ui.strings.gridView" :delay="400">\n\t\t\t\t\t\t<div class="uip-icon uip-icon-medium uip-text-l uip-link-default uip-padding-xxs" @click="ui.view = \'grid\'"\n\t\t\t\t\t\t:class="{\'uip-border-bottom-primary uip-text-emphasis\' : ui.view == \'grid\'}">grid_view</div>\n\t\t\t\t\t</uip-tooltip>\n\t\t\t\t\t<uip-tooltip :message="ui.strings.listView" :delay="400">\n\t\t\t\t\t\t<div class="uip-icon uip-icon-medium uip-text-l uip-link-default uip-padding-xxs" @click="ui.view = \'list\'"\n\t\t\t\t\t\t:class="{\'uip-border-bottom-primary uip-text-emphasis\' : ui.view == \'list\'}" >sort</div>\n\t\t\t\t\t</uip-tooltip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!--END TOOLBAR --\x3e\n\t\t</div>\n\t\t\x3c!--Library --\x3e\n\t\t<div v-if="ui.activeTab == \'library\'" class="uip-position-relative uip-w-100p">\n\t\t\t<div class="uip-ajax-loader" v-if="loading">\n\t\t\t  <div class="uip-loader-bar"></div>\n\t\t\t</div>\n\t\t\t<div ref="dropArea" @drop.prevent="uploadImages" @dragenter.prevent="highlightDrop" @dragover.prevent="highlightDrop">\n\t\t\t\t<div @dragenter.prevent="highlightDrop" @dragover.prevent="highlightDrop" @dragleave.prevent="dragEnd" @dragend.prevent="dragEnd"\n\t\t\t\tclass="uip-position-absolute uip-top-0 uip-bottom-0 uip-left-0 uip-right-0 uip-background-primary-wash uip-flex uip-flex-middle uip-flex-center uip-z-index-3" v-if="ui.dropping">\n\t\t\t\t\t<div class="uip-icon uip-text-xl uip-icon-medium">file_upload</div>\n\t\t\t\t</div>\n\t\t\t\t<div ref="mediaList" class="uip-flex uip-flex-wrap uip-flex-start uip-row-gap-xs uip-gap-xs uip-flex-row uip-max-h-500 uip-overflow-auto uip-scrollbar uip-padding-bottom-l uip-attachment-area" id="media-list" @scroll="watchScroll">\n\t\t\t\t\t<template v-if="ui.view == \'grid\'" v-for="image in files">\n\t\t\t\t\t\t<div @click="selectImage(image)" :class="{\'uip-active-outline\' : image.selected}"\n\t\t\t\t\t\t@mouseenter="image.hover = true" @mouseleave="image.hover = false"\n\t\t\t\t\t\tclass="uip-cursor-pointer uip-flex uip-flex-column uip-row-gap-xs uip-flex-start uip-position-relative">\n            \x3c!--preview area--\x3e\n              \x3c!--image--\x3e\n\t\t\t\t\t\t\t<img v-if="image.type.includes(\'image\')" :style="\'aspect-ratio:\' + image.ratio" :src="image.preview" :alt="image.name" class="uip-max-h-100 uip-h-100 uip-w-auto">\n              \x3c!--View--\x3e\n              <video v-else-if="image.type.includes(\'video\')" :style="\'aspect-ratio:\' + image.ratio" :src="image.preview" :alt="image.name" class="uip-max-h-100 uip-h-100 uip-w-auto"></video>\n              \x3c!--PDF--\x3e\n              <img v-else-if="image.type.includes(\'pdf\')" :style="\'aspect-ratio:\' + image.ratio" :src="image.preview" :alt="image.name" class="uip-max-h-100 uip-h-100 uip-w-auto">\n              \x3c!--ZIP / TAR--\x3e\n              <div v-else-if="ifMimeType([\'zip\', \'tar\', \'gzip\'], image.type)" class="uip-max-h-100 uip-h-100 uip-w-100 uip-flex uip-flex-center uip-flex-middle uip-background-grey"><span class="uip-icon uip-text-xxl">archive</span></div>\n              \x3c!--CODE--\x3e\n              <div v-else-if="ifMimeType([\'php\', \'css\', \'js\', \'html\', \'json\'], image.type)" class="uip-max-h-100 uip-h-100 uip-w-100 uip-flex uip-flex-center uip-flex-middle uip-background-grey"><span class="uip-icon uip-text-xxl">code</span></div>\n              \x3c!--CSV--\x3e\n              <div v-else-if="ifMimeType([\'csv\'], image.type)" class="uip-max-h-100 uip-h-100 uip-w-100 uip-flex uip-flex-center uip-flex-middle uip-background-grey"><span class="uip-icon uip-text-xxl">formatted_list_numbered</span></div>\n              \x3c!--preview area--\x3e\n              \x3c!--CSV--\x3e\n              <div v-else-if="ifMimeType([\'audio\'], image.type)" class="uip-max-h-100 uip-h-100 uip-w-100 uip-flex uip-flex-center uip-flex-middle uip-background-grey"><span class="uip-icon uip-text-xxl">play_circle</span></div>\n              \x3c!--Others--\x3e\n              <div v-else class="uip-max-h-100 uip-h-100 uip-w-100 uip-flex uip-flex-center uip-flex-middle uip-background-grey"><span class="uip-icon uip-text-xxl">description</span></div>\n            \x3c!--preview area--\x3e\n\t\t\t\t\t\t\t<div class="uip-position-absolute uip-padding-xs uip-flex uip-flex-row uip-bottom-0 uip-top-0 uip-left-0 uip-right-0 uip-gradient-dark uip-gap-xs uip-text-inverse uip-flex-end" v-if="image.hover || image.selected">\n\t\t\t\t\t\t\t\t<div><input type="checkbox" class="uip-checkbox" v-model="image.selected"></div>\n\t\t\t\t\t\t\t\t<div class="uip-text-s uip-overflow-hidden uip-text-ellipsis uip-no-wrap">{{image.name}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="uip-w-100p uip-flex uip-flex-column uip-attachment-area uip-max-w-100p uip-overflow-auto uip-scrollbar" v-if="ui.view == \'list\'">\n\t\t\t\t\t\t<table class="uip-border-collapse uip-min-w-500">\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<template v-for="image in files">\n\t\t\t\t\t\t\t\t\t<tr class="uip-cursor-pointer hover:uip-background-muted" @click="selectImage(image)">\n\t\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs"><img :style="\'aspect-ratio:\' + image.ratio" :src="image.preview" :alt="image.name" class="uip-max-w-60"></td>\n\t\t\t\t\t\t\t\t\t\t<td class="uip-text-bold uip-padding-xxxs">{{image.name}}</td>\n\t\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs">{{image.type}}</td>\n\t\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs">{{image.modified}}</td>\n\t\t\t\t\t\t\t\t\t\t<td><input type="checkbox" class="uip-checkbox" v-model="image.selected"></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!--Unsplash Library --\x3e\n\t\t<div class="" v-if="ui.activeTab == \'stock\'">\n\t\t\t<div class="uip-ajax-loader" v-if="loading">\n\t\t\t  <div class="uip-loader-bar"></div>\n\t\t\t</div>\n\t\t\t<div ref="mediaList" class="uip-flex uip-flex-wrap uip-flex-start uip-row-gap-xs uip-gap-xs uip-flex-row uip-max-h-500 uip-overflow-auto uip-scrollbar uip-padding-bottom-l uip-attachment-area" id="media-list">\n\t\t\t\t<template v-if="ui.view == \'grid\'" v-for="image in remoteFiles">\n\t\t\t\t\t<div @click="selectImage(image)" :class="{\'uip-active-outline\' : image.selected}"\n\t\t\t\t\t@mouseenter="image.hover = true" @mouseleave="image.hover = false"\n\t\t\t\t\tclass="uip-cursor-pointer uip-flex uip-flex-column uip-row-gap-xs uip-flex-start uip-position-relative">\n\t\t\t\t\t\t<img :src="image.urls.small" :alt="image.alt_description" class="uip-max-h-100 uip-h-100 uip-w-auto">\n\t\t\t\t\t\t<div class="uip-position-absolute uip-padding-xs uip-flex uip-flex-row uip-bottom-0 uip-top-0 uip-left-0 uip-right-0 uip-gradient-dark uip-gap-xs uip-text-inverse uip-flex-end uip-flex-left" v-if="image.hover || image.selected">\n\t\t\t\t\t\t\t<div><input type="checkbox" class="uip-checkbox" v-model="image.selected"></div>\n\t\t\t\t\t\t\t<div class="uip-text-s uip-overflow-hidden uip-text-ellipsis uip-no-wrap">\n              <a class="uip-link-inverse" :href="image.user.portfolio_url" target="_BLANK">{{image.user.username}}</a>\n              </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class="uip-w-100p uip-flex uip-flex-column uip-attachment-area uip-overflow-auto uip-scrollbar" v-if="ui.view == \'list\'">\n\t\t\t\t\t<table class="uip-border-collapse uip-min-w-500">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<template v-for="image in remoteFiles">\n\t\t\t\t\t\t\t\t<tr class="uip-cursor-pointer hover:uip-background-muted" @click="selectImage(image)">\n\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs"><img :src="image.urls.small" :alt="image.alt_description" class="uip-max-w-60"></td>\n\t\t\t\t\t\t\t\t\t<td class="uip-text-bold uip-padding-xxxs">{{image.alt_description}}</td>\n\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs"><a class="uip-link-muted" :href="image.user.links.html" target="_BLANK">{{image.user.username}}</a></td>\n\t\t\t\t\t\t\t\t\t<td class="uip-padding-xxs">{{formatDate(image.updated_at)}}</td>\n\t\t\t\t\t\t\t\t\t<td><input type="checkbox" class="uip-checkbox" v-model="image.selected"></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!--End unsplash Library --\x3e\n\t\t<div class="uip-padding-top-s uip-background-default uip-flex uip-flex-between uip-bottom-0 uip-left-0 uip-right-0 uip-position-absolute" v-if="selected.length > 0">\n\t\t\t<button v-if="ui.activeTab != \'stock\' && ui.deleteEnabled" class="uip-button-danger" @click="deleteSelected()">{{ui.strings.delete}}</button>\n      <div v-if="ui.activeTab == \'stock\' && selected.length > 0">\n        <div>\n          {{ui.strings.photoBy}} \n          <a class="uip-link-primary" :href="selected[0].user.links.html + \'?utm_source=uipress&utm_medium=referral\'" target="_BLANK">{{selected[0].user.username}}</a>\n          {{ui.strings.on}} \n          <a class="uip-link-primary" href="https://unsplash.com/?utm_source=uipress&utm_medium=referral" target="_BLANK">Unsplash</a>\n        </div>\n        <div class="uip-text-muted uip-text-s">{{selected[0].alt_description}}</div>\n      </div>\n\t\t\t<dropdown pos="bottom right" v-if="args.useType != \'browse\'">\n\t\t\t\t<template v-slot:trigger>\n\t\t\t\t\t<button class="uip-button-primary">{{ui.strings.add}}</button>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xs uip-text-right">\n\t\t\t\t\t\t<template v-for="(size, index) in selected[0].urls">\n\t\t\t\t\t\t\t<div class="uip-link-muted" @click="chooseImage(index)">{{ui.strings[index]}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</dropdown>\n\t\t</div>\n\t</div>'}};