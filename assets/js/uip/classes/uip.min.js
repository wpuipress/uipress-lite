const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export class uip{constructor(e){this.getRequiredVars(),this.uipBlocks=[],this.activeLink="",this.windowWidth=window.innerWidth,this.uipAppData={translations:this.uipTranslations,options:this.uipOptions,blocks:[],templateDarkMode:!1,darkMode:!1,userPrefs:this.userPrefs,adminMenu:this.adminmenu,toolbar:this.toolbar},this.modalResolve,e&&(this.enviroment=e),this.attachWidthListener()}attachWidthListener(){let e=this;window.addEventListener("resize",function(){e.windowWidth=window.innerWidth})}getRequiredVars(){if("undefined"==typeof uipMasterMenu){const e={menu:[]};this.adminmenu=e}else this.adminmenu=uipMasterMenu;if("undefined"==typeof uipMasterToolbar){const e=[];this.toolbar=e}else this.toolbar=uipMasterToolbar;this.uipOptions=uip_ajax.uipAppData.options,this.userPrefs=uip_ajax.uipAppData.userPrefs}uipParseJson(e){return JSON.parse(e,(e,t)=>"uiptrue"===t||"uipfalse"!==t&&("uipblank"===t?"":t))}uipEncodeJson(e){return JSON.stringify(e,(e,t)=>"true"===t?"uiptrue":!0===t?"uiptrue":"false"===t?"uipfalse":!1===t?"uipfalse":""===t?"uipblank":t)}async callServer(e,t,i){const s=this,n=new Headers;return n.append("Content-Length",0),fetch(e,{method:"POST",headers:n,body:t}).then(e=>e.text()).then(e=>{try{let t=s.uipParseJson(e);return t||{error:!0,message:__("Bad request","uipress-lite")}}catch(e){return!!i||(s.notify(__("Parse error","uipress-lite"),__("Unable to parse JSON response","uipress-lite"),"error"),e)}}).catch(e=>!!i||(s.notify(e,"","error"),e))}register_new_blocks(e){wp.hooks.addFilter("uip-register-blocks","child",function(t){for(let i of e){t.find(e=>e.moduleName===i.moduleName)||t.push(i)}return t})}async searchForBlock(e,t){let i=this,s=e.map(async e=>{let s=await i.findBYuid(e,t);return!!this.isObject(s)&&s});return Promise.all(s).then(e=>{if(Array.isArray(e)){let t=!1;for(const i of e)this.isObject(i)&&(t=i);return t}return!!this.isObject(e)&&e})}async findBYuid(e,t){let i=this;if(e.uid==t)return e;if(e.content){let s=e.content.map(async e=>await i.findBYuid(e,t));return Promise.all(s).then(e=>{let t=!1;for(const i of e)this.isObject(i)&&(t=i);return t||!1})}return!1}openTreeViewlayers(e,t){let i=this;if(Array.isArray(e))for(const s of e)Array.isArray(s)&&i.openTreeViewlayers(s,t),s&&s.uid&&s.uid===t?s.tabOpen=!0:s&&s.content&&s.content?(JSON.stringify(s.content).includes(t)&&(s.tabOpen=!0),i.openTreeViewlayers(s.content,t)):"object"==typeof s&&s.constructor===Object&&i.openTreeViewlayers(s,t),0;else if(e&&"object"==typeof e&&e.constructor===Object)for(const s in e)e[s]&&e[s].uid&&e[s].uid===t?item.tabOpen=!0:e[s]&&e[s].content?(JSON.stringify(item.data[s].content).includes(t)&&(item.tabOpen=!0),i.openTreeViewlayers(e[s].content,t)):i.openTreeViewlayers(e[s],t)}findBYmodnameAndReturn(e,t,i){let s=this;if(Array.isArray(e))for(const n of e)Array.isArray(n)&&s.findBYmodnameAndReturn(n,t,i),n&&n.moduleName&&t.includes(n.moduleName)?i.push(n):n&&n.content&&n.content?s.findBYmodnameAndReturn(n.content,t,i):n&&"object"==typeof n&&n.constructor===Object&&s.findBYmodnameAndReturn(n,t,i),0;else if(e&&"object"==typeof e&&e.constructor===Object)for(const n in e)e[n]&&e[n].moduleName&&t.includes(e[n].moduleName)?i.push(e[n]):e[n]&&e[n].content?s.findBYmodnameAndReturn(e[n].content,t,i):s.findBYmodnameAndReturn(e[n],t,i)}findOutdatedBlocks(e,t){let i=this;if(Array.isArray(e))for(const s of e)Array.isArray(s)&&i.findOutdatedBlocks(s,t),this.checkNestedValue(s,["settings","container"])&&t.push(s),s&&s.content&&s.content?i.findOutdatedBlocks(s.content,t):s&&"object"==typeof s&&s.constructor===Object&&i.findOutdatedBlocks(s,t),0;else if(e&&"object"==typeof e&&e.constructor===Object)for(const s in e)this.checkNestedValue(e[s],["settings","container"])&&t.push(e[s]),e[s]&&e[s].content?i.findOutdatedBlocks(e[s].content,t):i.findOutdatedBlocks(e[s],t)}async deletePost(e){if(!e||""==e)return;let t;t=Array.isArray(e)?JSON.stringify(e):JSON.stringify([e]);let i=this;return await this.confirm(__("Are you sure?","uipress-lite"),__("Are you sure you want to delete this? Once deleted this item can't be recovered"),__("Delete","uipress-lite")).then(e=>{if(e){let e=new FormData;return e.append("action","uip_delete_post"),e.append("security",uip_ajax.security),e.append("id",t),i.callServer(uip_ajax.ajax_url,e).then(e=>e.error?(i.notify(e.message,"uipress-lite","","error",!0),!1):e.success?(i.notify(__("Item deleted","uipress-lite"),e.errorCount+" errors","success",!0),!0):void 0)}return!1})}async deleteByUID(e,t){return await new Promise(i=>{this.findBYuidAndDelete(e,t,i)})}async findBYuidAndDelete(e,t,i){let s=this,n=0;if(Array.isArray(e))for(const o of e)Array.isArray(o)&&s.findBYuidAndDelete(o,t,i),void 0!==o&&(o.uid&&o.uid===t?(e.splice(n,1),i(!0)):o.content&&o.content?s.findBYuidAndDelete(o.content,t,i):o&&"object"==typeof o&&o.constructor===Object&&s.findBYuidAndDelete(o,t,i),++n);else if(e&&"object"==typeof e&&e.constructor===Object)for(const n in e)void 0!==e[n]&&(e[n].uid&&e[n].uid===t?(delete e[n],i(!0)):e[n].content?s.findBYuidAndDelete(e[n].content,t,i):s.findBYuidAndDelete(e[n],t,i))}async getParentByUID(e,t){return await new Promise(i=>{this.findBYuidAndGetParent(e,t,i)})}async findBYuidAndGetParent(e,t,i){let s=this;if(Array.isArray(e))for(const n of e)Array.isArray(n)&&s.findBYuidAndDelete(n,t,i),n.uid&&n.uid===t?i(e):n.content&&n.content?s.findBYuidAndGetParent(n.content,t,i):n&&"object"==typeof n&&n.constructor===Object&&s.findBYuidAndGetParent(n,t,i);else if(e&&"object"==typeof e&&e.constructor===Object)for(const n in e)e[n].uid&&e[n].uid===t?i(e):e[n].content?s.findBYuidAndGetParent(e[n].content,t,i):s.findBYuidAndGetParent(e[n],t,i)}explodeBlockSettings(e,t,i,s){let n="",o=this.uipAppData.settings,a=!1;this.userPrefs.darkTheme&&(a=!0),i&&(a=!0);let r=this.windowWidth;s&&(r=s);for(let[i,s]of Object.entries(e)){let s=e[i].settingName,l=(e[i].value,o[s]);l&&l.type==t&&"darkValue"in e[i]&&a&&"undefined"===(e[i].darkValue,!1)&&(n+=l.renderStyle(e[i].darkValue,r))}return void 0===typeof n?"":n}explodeSpecificBlockSettings(e,t,i,s,n){let o="",a=this.uipAppData.settings;if(void 0===e[n])return"";let r=!1;this.userPrefs.darkTheme&&(r=!0),i&&(r=!0);let l=this.windowWidth;s&&(l=s);let p=e[n].settingName,u=e[n].value,d=a[p];return d&&d.type==t&&(void 0!==u&&(o+=d.renderStyle(u,l)),"darkValue"in e[n]&&r&&void 0!==e[n].darkValue&&(o+=d.renderStyle(e[n].darkValue,l))),void 0===typeof o?"":o}assignBlockValues(e,t){if(void 0!==t){if(this.isObject(t))for(const i in t){let s=t[i];void 0!==s&&(i in e||(e[i]={}),this.isObject(s)?this.assignBlockValues(e[i],s):e[i]=s)}return e}}render_block_styles(e,t,i,s){if(!this.isObject(e))return!1;if(!this.isObject(e.settings))return!1;let n=this,o=e.settings,a="",r=this.uipAppData.settings,l=!1;this.userPrefs.darkTheme&&(l=!0),i&&(l=!0);let p=n.windowWidth;s&&(p=s);for(const e in o){let i=o[e];if(!i)continue;let s="#"+t;"container"==e&&(s="#"+t),"style"==i.styleType?i.class&&""!=i.class&&(s+=" "+i.class):"pseudo"==i.styleType&&(s+=i.class);let u=i.options,d=this.checkNestedValue(i,["preset"]);d&&""!=d&&(d=this.checkNestedValue(this.uipAppData.options,["block_preset_styles",d]))&&this.isObject(d)&&(u=d.preset.options);let c="";(c=n.render_option_styles(u,l,p,r))&&void 0!=typeof c&&"undefined"!=c&&(a+=s+"{"+c+"}");let g=n.render_option_styles(u,l,p,r,":hover");g&&(a+=s+":hover{"+g+"}");let f=n.render_option_styles(u,l,p,r,":active");f&&(a+=s+":active,"+s+'[active="true"]{'+f+"}");let h=n.render_option_styles(u,l,p,r,":visited");h&&(a+=s+":visited{"+h+"}");let m=n.render_option_styles(u,l,p,r,":focus");m&&(a+=s+":focus{"+m+"}");let y=n.render_option_styles(u,l,p,r,"::before");if(y){let e="";""!=i.beforeContent&&void 0!==i.beforeContent&&(e=`content:'${i.beforeContent}';`),a+=s+`::before{${y}${e}}`}let v=n.render_option_styles(u,l,p,r,"::after");if(y){let e="";""!=i.afterContent&&void 0!==i.afterContent&&(e=`content:'${i.afterContent}';`),a+=s+`::after{${v}${e}}`}let b=n.render_option_styles(u,l,p,r,":menu-collapsed");b&&(a+=`html[uip-menu-collapsed='true'] ${s} {${b}}`);let k=n.render_option_styles(u,l,p,r,"tablet");k&&(a+=`.uip-tablet-view ${s} {${k}}`);let _=n.render_option_styles(u,l,p,r,"mobile");_&&(a+=`.uip-phone-view ${s} {${_}}`)}return a}render_option_styles(e,t,i,s,n){let o="";for(let[a,r]of Object.entries(e)){if(void 0===e[a])continue;let r=e[a].settingName,l=e[a].value,p=s[r];if(p&&"style"==p.type){if(!n){if(void 0!==l){let e=p.renderStyle(l,i);e&&void 0!==e&&(o+=e)}if("darkValue"in e[a]&&t&&void 0!==e[a].darkValue){let t=p.renderStyle(e[a].darkValue,i);t&&void 0!==t&&(o+=t)}}if(n&&"pseudo"in e[a]){let s=this.checkNestedValue(e[a],["pseudo","light",n]),r=this.checkNestedValue(e[a],["pseudo","dark",n]);if(s){let e=p.renderStyle(s,i);e&&void 0!==e&&(o+=e)}if(r&&t){let e=p.renderStyle(r,i);e&&void 0!==e&&(o+=e)}}}}return void 0===typeof o?"":o}isObject(e){return void 0!==e&&!(!e||"object"!=typeof e||e.constructor!==Object)}isEmptyObject(e){return!(!e||0!==Object.keys(e).length||Object.getPrototypeOf(e)!==Object.prototype)}createUID(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return"uip-"+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}register_global_components(e){wp.hooks.addFilter("uip-register-global-components","child",function(t){for(let i of e)t.push=i;return t})}loadBlocks(){return wp.hooks.applyFilters("uip-register-blocks",[])}register_new_block_settings(e){wp.hooks.addFilter("uip-register-block-settings","child",function(t){for(let[i,s]of Object.entries(e))t[i]=s;return t})}loadSettings(){return wp.hooks.applyFilters("uip-register-block-settings",{})}register_new_dynamic_settings(e){wp.hooks.addFilter("uip-register-dynamic-inputs","child",function(t){for(let[i,s]of Object.entries(e))t[i]=s;return t})}loadDynamics(){return wp.hooks.applyFilters("uip-register-dynamic-inputs",{})}register_new_block_groups(e){wp.hooks.addFilter("uip-register-block-groups","child",function(t){for(let[i,s]of Object.entries(e))t[i]=s;return t})}register_new_template_groups(e){wp.hooks.addFilter("uip-register-template-settings-groups","child",function(t){for(let[i,s]of Object.entries(e))t[i]=s;return t})}register_new_template_groups_options(e){wp.hooks.addFilter("uip-register-template-settings-groups-options","child",function(t){for(let i of e)t.push(i);return t})}register_new_global_groups(e){wp.hooks.addFilter("uip-register-global-settings-groups","child",function(t){for(let[i,s]of Object.entries(e))t[i]=s;return t})}register_new_global_groups_options(e){wp.hooks.addFilter("uip-register-global-settings-groups-options","child",function(t){for(let i of e)t.push(i);return t})}loadTemplateGroups(){let e=wp.hooks.applyFilters("uip-register-template-settings-groups",{}),t=wp.hooks.applyFilters("uip-register-template-settings-groups-options",[]);for(let[i,s]of Object.entries(e)){let s=t.filter(e=>e.group===i);e[i].settings=s}return e}loadGlobalGroups(){let e=wp.hooks.applyFilters("uip-register-global-settings-groups",{}),t=wp.hooks.applyFilters("uip-register-global-settings-groups-options",[]);for(let[i,s]of Object.entries(e)){let s=t.filter(e=>e.group===i),n=[];for(let t of s)n.includes(t.group+t.uniqueKey)||("settings"in e[i]||(e[i].settings=[]),e[i].settings.push(t),n.push(t.group+t.uniqueKey));"settings"in e[i]?e[i].settings.sort((e,t)=>e.order-t.order):e[i].settings=[]}return this.reverseObject(e)}reverseObject(e){let t={};return Object.keys(e).reverse().forEach(function(i){t[i]=e[i]}),t}loadBlockGroups(){return wp.hooks.applyFilters("uip-register-block-groups",{})}register_new_builder_plugins(e){wp.hooks.addFilter("uip-register-builder-plugins","child",function(t){for(let i of e)t.push(i);return t})}loadPlugins(){return wp.hooks.applyFilters("uip-register-builder-plugins",[])}register_new_theme_styles(e){wp.hooks.addFilter("uip-register-theme-styles","child",function(t){for(let[i,s]of Object.entries(e))t[s.name]=s;return t})}loadThemeStyles(){return wp.hooks.applyFilters("uip-register-theme-styles",{})}async dynamicImport(e,t){let i=[];return await Promise.all(e.map(async e=>{if("path"in e&&!i.includes(e.moduleName)){let s=await import(e.path+"?ver="+this.uipAppData.options.uipVersion);await t.component(e.moduleName,s.moduleData());i.push(e.moduleName)}})).then(()=>!0).catch(e=>(console.log(e),!0))}async importPlugins(e,t){return console.log(e),await Promise.all(e.map(async e=>{if("path"in e){let i=await import(e.path+"?ver="+this.uipAppData.options.uipVersion);await t.component(e.component,i.moduleData())}})).then(()=>!0).catch(e=>!0)}async confirm(e,t,i){let s=this;return await new Promise(function(n,o){s.createModal(e,t,i),s.modalResolve=n}).then(function(e){return e})}updatePage(e,t){let i=new RegExp("^(?:[a-z+]+:)?//","i"),s=e=e.replace(/&amp;/g,"&");i.test(e)&&e.includes(this.uipAppData.dynamicOptions.viewadmin.value)&&(s=e.replace(this.uipAppData.dynamicOptions.viewadmin.value,"")),this.activeLink=s;this.uipActiveLinkChange=new CustomEvent("uip_page_change",{detail:{url:this.stripUIPparams(this.activeLink)}}),document.dispatchEvent(this.uipActiveLinkChange),i.test(e)||(e=this.uipAppData.dynamicOptions.viewadmin.value+e);let n=new URL(e);if("undefined"!=typeof UIPdisableUserPages&&UIPdisableUserPages&&"builder"!=this.enviroment&&Array.isArray(UIPdisableUserPages))for(let e of UIPdisableUserPages)if(n.href==e||n.href.includes(e))return void window.location.assign(n);if("undefined"!=typeof UIPdisableDynamicLoading&&UIPdisableDynamicLoading&&"builder"!=this.enviroment)window.location.assign(n);else{if("undefined"==typeof UIPfrontEndReload||!UIPfrontEndReload||"builder"==this.enviroment||n.href.includes(this.uipAppData.dynamicOptions.viewadmin.value))return this.forceReload(n),t?(n.searchParams.set("uip-framed-page",0),void("builder"!=this.enviroment&&window.location.assign(n))):(this.uipUpdateFrame=new CustomEvent("uip_update_frame_url",{detail:{url:n}}),document.dispatchEvent(this.uipUpdateFrame),void(document.getElementsByClassName("uip-page-content-frame")[0]||"builder"!=this.enviroment&&window.location.assign(n)));window.location.assign(n)}}forceReload(e){if(!e.searchParams.get("bricks")||"run"!=e.searchParams.get("bricks"))return e.searchParams.get("page")&&"motionpage"==e.searchParams.get("page")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("action")&&"elementor"==e.searchParams.get("action")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("page")&&"elementor-app"==e.searchParams.get("page")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("breakdance")&&"builder"==e.searchParams.get("breakdance")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("ct_builder")&&"true"==e.searchParams.get("ct_builder")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("page")&&"piotnetforms"==e.searchParams.get("page")&&e.searchParams.get("post")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("action")&&"zion_builder_active"==e.searchParams.get("action")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):e.searchParams.get("et_fb")&&"1"==e.searchParams.get("et_fb")?(e.searchParams.set("uip-framed-page",1),void window.location.assign(e)):void 0;window.location.assign(e)}stripUIPparams(e){let t="";return(t=new RegExp("^(?:[a-z+]+:)?//","i").test(e)?new URL(e):new URL(this.uipAppData.dynamicOptions.viewadmin.value+e)).searchParams.delete("uip-framed-page",1),t.searchParams.delete("uip-hide-screen-options",1),t.searchParams.delete("uip-hide-help-tab",1),t.searchParams.delete("uip-default-theme",1),t.searchParams.delete("uip-hide-notices",1),t.searchParams.delete("uipid",1),t.href.replace(this.uipAppData.dynamicOptions.viewadmin.value,"")}updateActiveLink(e){let t=e,i=e;new RegExp("^(?:[a-z+]+:)?//","i").test(e)?e.includes(this.uipAppData.dynamicOptions.viewadmin.value)&&(t=e.replace(this.uipAppData.dynamicOptions.viewadmin.value,"")):i=this.uipAppData.dynamicOptions.viewadmin.value+e,i=i.replace("about:blank",""),t=t.replace("about:blank",""),this.activeLink=t;if(this.activeLink==this.uipActiveLinkChange)return;let s=new URL(i);s.searchParams.delete("uip-framed-page",1),s.searchParams.delete("uip-hide-screen-options",1),s.searchParams.delete("uip-hide-help-tab",1),s.searchParams.delete("uip-default-theme",1),s.searchParams.delete("uip-hide-notices",1),s.searchParams.delete("uipid",1),this.forceReload(s),this.enviroment,this.uipActiveLinkChange=new CustomEvent("uip_page_change",{detail:{url:this.stripUIPparams(this.activeLink)}}),document.dispatchEvent(this.uipActiveLinkChange)}async cleanTemplate(e){let t=this,i=e.map(async e=>await t.blockHouseKeeping(e));return Promise.all(i).then(e=>e)}async blockHouseKeeping(e){let t=this;if("category"in e&&delete e.category,"description"in e&&delete e.description,"optionsEnabled"in e&&delete e.optionsEnabled,"path"in e&&delete e.path,"tabOpen"in e&&delete e.tabOpen,"settings"in e)for(let t in e.settings){let i=e.settings[t].options;for(let e in i)"args"in i[e]&&delete i[e].args}if("content"in e){let i=e.content.map(async e=>await t.blockHouseKeeping(e));return Promise.all(i).then(t=>e)}return e}async validDateTemplate(e,t){let i=this,s=e.map(async e=>await i.validateBlock(e,t));return Promise.all(s).then(e=>e)}async validateBlock(e,t){let i=this;if(!("name"in e))return!1;if(!("moduleName"in e))return!1;if(!("settings"in e))return!1;if(t||(e.uid=this.createUID()),"content"in e){let s=e.content.map(async e=>await i.validateBlock(e,t));return Promise.all(s).then(e=>!e.includes(!1))}return!0}async saveUserPreference(e,t,i){let s=new FormData,n=this;return 1==t&&(t="uiptrue"),0==t&&(t="uipfalse"),t=this.uipEncodeJson(t),s.append("action","uip_save_user_preference"),s.append("security",uip_ajax.security),s.append("key",e),s.append("value",t),await n.callServer(uip_ajax.ajax_url,s).then(e=>e.error?(n.notify(e.message,"","error",!0),!1):(i&&n.notify(__("Preference updated","uipress-lite"),"","success",!0),!0))}async getUserPreference(e){let t=new FormData,i=this;return t.append("action","uip_get_user_preference"),t.append("security",uip_ajax.security),t.append("key",e),await i.callServer(uip_ajax.ajax_url,t).then(e=>e.error?(i.notify(e.message,"","error",!0),!1):e.value)}createModal(e,t,i){let s=this;i&&""!=i||(i=__("Yes","uipress-lite"));let n='<div class="uip-position-fixed uip-top-0 uip-left-0 uip-h-viewport uip-w-vw uip-background-black-wash uip-flex uip-flex-center uip-flex-middle uip-fade-in uip-text-normal uip-z-index-9999" tabindex="1" id="uip-modal-confirm">    <div class="uip-background-default uip-border uip-padding-m uip-flex uip-flex-column uip-row-gap-s uip-scale-in uip-min-w-350 uip-z-index-9999" style="border-radius: calc(var(--uip-border-radius-large) + var(--uip-padding-xs));">      <div class="uip-text-bold uip-text-l uip-text-emphasis">'+e+'</div>      <div class="uip-text-muted uip-max-w-300">'+t+'</div>      <div class="uip-flex uip-gap-xs">        <button id="uip-confirm-cancel" class="uip-button-default uip-flex uip-gap-xxs uip-flex-center"><span>'+__("Cancel","uipress-lite")+'</span>      <span class="uip-text-s uip-text-muted uip-border uip-border-round" style="padding:1px;">      esc      </span>      </button>        <button id="uip-confirm-yes" class="uip-button-primary uip-flex uip-gap-xxs uip-flex-center"><span>'+i+'</span>          <span class="uip-icon uip-border uip-border-round" >          keyboard_return          </span>      </button>      </div>    </div>',o=document.createElement("div");o.innerHTML=n,o.setAttribute("tabindex","1"),o.classList.add("uip-z-index-9999"),o.classList.add("uip-position-relative");let a=document.body.appendChild(o);a.focus();let r=function(e){"Enter"===e.key&&(s.modalResolve(!0),this.removeEventListener("keydown",r),a.remove()),"Escape"===e.key&&(s.modalResolve(!1),this.removeEventListener("keydown",r),a.remove())};a.addEventListener("keydown",r),document.getElementById("uip-confirm-cancel").addEventListener("click",function(){s.modalResolve(!1),a.remove()}),document.getElementById("uip-confirm-yes").addEventListener("click",function(){s.modalResolve(!0),a.remove()})}notify(e,t,i,s,n){let o="uip-default",a="info";i&&(o="uip-"+i,"success"==i&&(a="done"),"error"==i&&(a="close"),"warning"==i&&(a="priority_high"));let r=document.getElementById("notification-drop");r||((r=document.createElement("div")).setAttribute("id","notification-drop"),r.setAttribute("class","notification-drop uip-dark-mode"),document.body.appendChild(r));let l=`\n    <div class="uip-flex uip-gap-s uip-flex-center">\n      <div class="uip-border-rounder uip-notification-status uip-flex uip-flex-middle uip-padding-xxxs uip-flex-center">\n        <span class="uip-icon uip-text-inverse uip-text-center">${a}</span>\n      </div>\n      <div class="uip-flex-grow uip-column-gap-xs">\n        <div class="uip-text-emphasis uip-text-inverse">${e}</div>\n        <div class="uip-text-s uip-text-muted uip-max-w-500">${t}</div>\n      </div>`;1==n&&(l+='\n      <div class="uip-position-relative" >\n        <span class="uip-load-spinner" ></span>\n      </div>\n    '),0!=s&&(l+='\n        <div class="uip-icon uip-link-muted uip-background-default uip-padding-xxs uip-border-rounder" onclick="this.closest(\'.uip-notification\').remove();">close</div>\n        '),l+="</div>";let p=document.createElement("div"),u=this.createUID();return p.setAttribute("id",u),p.classList.add("uip-notification"),p.classList.add("uip-border"),p.classList.add("uip-slide-in-left"),p.classList.add(o),p.innerHTML=l,r.appendChild(p),0!=s&&setTimeout(function(){p.style.transition="0.6s",p.style.opacity=0,setTimeout(function(){p.remove()},600)},8e3),u}destroy_notification(e){return!!document.getElementById(e)&&(document.getElementById(e).remove(),!0)}get_block_option(e,t,i,s){let n=this;if(!(t in e.settings))return!1;if(!("options"in e.settings[t]))return!1;let o=e.settings[t].options,a=!1;if(i in o&&"value"in o[i]){if(void 0===(a=o[i].value))return!1;if(!s)return(!this.isObject(a)||0!==Object.keys(a).length)&&a;if(o[i].value.dynamic&&"text"==o[i].value.dynamicType){let e=o[i].value.dynamicKey,t=o[i].value.dynamicPos;if(n.uipOptions.dynamicData[e]){let i=n.uipOptions.dynamicData[e].value,s="";void 0!==a.string&&(s=a.string),a="left"==t?i+s:"right"==t?s+i:i+s}}if(o[i].value.dynamic&&"link"==o[i].value.dynamicType){let e=o[i].value.dynamicKey;if(n.uipOptions.dynamicData[e]){return n.uipOptions.dynamicData[e].value}}if(o[i].value.dynamic&&"img"==o[i].value.dynamicType){let e=o[i].value.dynamicKey;if(n.uipOptions.dynamicData[e]){return n.uipOptions.dynamicData[e].value}}}return void 0===a&&(a=!1),a}inject_block_presets(e,t){let i=this,s=e.optionsEnabled;this.uipAppData.settings;for(var n=0;n<s.length;n++){let e=s[n],o=e.options;i.format_block_presets(o,t,e)}return delete e.optionsEnabled,t}async format_block_presets(e,t,i){let s=this.uipAppData.settings;for(var n=0;n<e.length;n++){let o=i.name;if(!(n in e))continue;if(!e[n])continue;let a=e[n].option,r=e[n].help,l=e[n].label,p=e[n].option;if("uniqueKey"in e[n]&&(p=e[n].uniqueKey),t[o]||(t[o]={}),t[o].options||(t[o].options={}),t[o].options[p]||(t[o].options[p]={}),!(a in s)){t[o].options[p].component=a,t[o].options[p].label=l;continue}s.moduleName;"value"in t[o].options[p]||"value"in e[n]&&(t[o].options[p].value=JSON.parse(JSON.stringify(e[n].value))),"darkValue"in t[o].options[p]||"darkValue"in e[n]&&(t[o].options[p].darkValue=JSON.parse(JSON.stringify(e[n].darkValue))),"value"in t[o].options[p]||(t[o].options[p].value=structuredClone(s[a].value)),"darkValue"in t[o].options[p]||"darkValue"in s[a]&&(t[o].options[p].darkValue=structuredClone(s[a].darkValue)),t[o].styleType=i.styleType,t[o].class=i.class,t[o].options[p].settingName=a,r&&(t[o].options[p].help=r),t[o].name=i.name}return!0}async format_block_option(e,t,i){let s=this.uipAppData.settings,n=e.options;for(var o=0;o<n.length;o++){let a=e.name;if(!(o in n))continue;if(!n[o])continue;let r=n[o].option,l=n[o].label,p=n[o].help,u=n[o].option;if("uniqueKey"in n[o]&&(u=n[o].uniqueKey),i[a]||(i[a]={}),i[a].options||(i[a].options={}),i[a].options[u]||(i[a].options[u]={}),!(r in s)){i[a].options[u].component=r,i[a].options[u].label=l;continue}s.moduleName;if(u in t.options&&"pseudo"in t.options[u]){let e=t.options[u].pseudo;void 0!==e&&(i[a].options[u].pseudo=JSON.parse(JSON.stringify(e)))}if(u in t.options){if("value"in t.options[u]){let e=t.options[u].value;void 0!==e&&(i[a].options[u].value=JSON.parse(JSON.stringify(e)))}}else"value"in n[o]&&(i[a].options[u].value=JSON.parse(JSON.stringify(n[o].value)));if(u in t.options){if("darkValue"in t.options[u]){void 0!==t.options[u].darkValue&&(i[a].options[u].darkValue=JSON.parse(JSON.stringify(t.options[u].darkValue)))}}else"darkValue"in n[o]&&(i[a].options[u].darkValue=JSON.parse(JSON.stringify(n[o].darkValue)));"dark"in s[r]&&(i[a].options[u].dark=structuredClone(s[r].dark)),"args"in s[r]&&(i[a].options[u].args=structuredClone(s[r].args)),"args"in n[o]&&(i[a].options[u].args=n[o].args),i[a].label=e.label,i[a].icon=e.icon,i[a].name=e.name,i[a].styleType=e.styleType,i[a].class=e.class,i[a].options[u].settingName=r,i[a].options[u].component=s[r].component,i[a].options[u].label=l,p&&(i[a].options[u].help=p),"beforeContent"in t&&(i[a].beforeContent=t.beforeContent),"afterContent"in t&&(i[a].afterContent=t.afterContent),"preset"in t&&(i[a].preset=t.preset)}return i}async format_block_option_old(e,t,i){let s=this.uipAppData.settings;for(var n=0;n<e.length;n++){let o=i.name,a=e[n].option,r=e[n].label,l=e[n].option;if("uniqueKey"in e[n]&&(l=e[n].uniqueKey),t[o]||(t[o]={}),t[o].options||(t[o].options={}),t[o].options[l]||(t[o].options[l]={}),!(a in s)){t[o].options[l].component=a,t[o].options[l].label=r;continue}s.moduleName;"value"in t[o].options[l]||"value"in e[n]&&(t[o].options[l].value=JSON.parse(JSON.stringify(e[n].value))),"darkValue"in t[o].options[l]||"darkValue"in e[n]&&(t[o].options[l].darkValue=JSON.parse(JSON.stringify(e[n].darkValue))),"value"in t[o].options[l]||(t[o].options[l].value=structuredClone(s[a].value)),"darkValue"in t[o].options[l]||"darkValue"in s[a]&&(t[o].options[l].darkValue=structuredClone(s[a].darkValue)),"dark"in s[a]&&(t[o].options[l].dark=structuredClone(s[a].dark)),"args"in s[a]&&(t[o].options[l].args=structuredClone(s[a].args)),"args"in e[n]&&(t[o].options[l].args=e[n].args),t[o].label=i.label,t[o].icon=i.icon,t[o].name=i.name,t[o].styleType=i.styleType,t[o].class=i.class,t[o].options[l].settingName=a,t[o].options[l].component=s[a].component,t[o].options[l].label=r}return t}renderKeyShortCut(e){const t=["Enter"," ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"],i=[{key:"Enter",icon:"keyboard_return"},{key:" ",icon:"space_bar"},{key:"ArrowLeft",icon:"keyboard_arrow_left"},{key:"ArrowUp",icon:"keyboard_arrow_up"},{key:"ArrowRight",icon:"keyboard_arrow_right"},{key:"ArrowDown",icon:"keyboard_arrow_down"}];let s="";for(let n of e)if("Meta"==n)s+='<span class="uip-command-icon uip-text-muted"></span>';else if("Alt"==n)s+='<span class="uip-alt-icon uip-text-muted"></span>';else if("Shift"==n)s+='<span class="uip-shift-icon uip-text-muted"></span>';else if("Control"==n)s+='<span class="uip-icon uip-text-muted">keyboard_control_key</span>';else if("Backspace"==n)s+='<span class="uip-icon uip-text-muted">backspace</span>';else if(t.includes(n)){s+=`<span class="uip-icon uip-text-muted">${i.find(e=>e.key==n).icon}</span>`}else s+=`<span class="uip-text-muted uip-text-uppercase" style="line-height: 16px;font-size: 11px;">${n}</span>`;return s}checkNestedValue(e,t){let i=e;for(const e of t){if(!this.isObject(i))return!1;if(!i[e])return!1;i=i[e]}return i}createNestedObject(e,t){for(const i of t)e=e[i]=e[i]||{};return e}async updateBlocksV312(e){return Array.isArray(e)?await this.processBlockListUpdate(e):[]}async processBlockListUpdate(e){if(!Array.isArray(e))return;let t=[];for(const i of e){let e=await this.updateSingleBlockV312(i);t.push(e)}return t}async updateSingleBlockV312(e){if(!this.checkNestedValue(e,["settings","container"]))return e;if("uip-container"==e.moduleName){let t=this.checkNestedValue(e,["settings","container","options","dimensions","value","width"]);this.checkNestedValue(e,["settings","style","options","dimensions","value","width"]);t&&(t.value?(this.createNestedObject(e,["settings","style","options","dimensions","value","width"]),e.settings.style.options.dimensions.value.width=t):(this.createNestedObject(e,["settings","style","options","dimensions","value","width"]),e.settings.style.options.dimensions.value.width={value:" ",units:"auto"}))}let t=this.checkNestedValue(e,["settings","block","options"]),i={};if(this.isObject(t)){let s=this.checkNestedValue(t,["flexAlignItems","value"]);s&&(delete e.settings.block.options.flexAlignItems,(s=this.isObject(s)?s.value:s)&&(i.align="left"==s?"flex-start":s));let n=this.checkNestedValue(t,["flexDirection","value"]);n&&(delete e.settings.block.options.flexDirection,this.isObject(n)?i.direction=n.value:i.direction=n,"left"==i.direction&&(i.direction="row"));let o=!1,a=this.checkNestedValue(t,["columnGap","value"]);a&&(this.isObject(a)&&0!=a.value&&""!=a.value&&void 0!==a.value&&(i.gap={value:a.value,units:a.units},o=!0),delete e.settings.block.options.columnGap);let r=this.checkNestedValue(t,["rowGap","value"]);r&&!o&&(this.isObject(r)&&0!=r.value&&""!=r.value&&void 0!==r.value&&(i.gap={value:r.value,units:r.units}),delete e.settings.block.options.rowGap);let l=this.checkNestedValue(t,["flexJustifyContent","value"]);l&&(this.isObject(l)&&(l=l.value),l&&("left"==l&&(i.distribute="start"),"right"==l&&(i.distribute="end"),"center"==l&&(i.distribute="center"),"spaceAround"==l&&(i.distribute="space-around"),"spaceBetween"==l&&(i.distribute="space-between"),"spaceEvenly"==l&&(i.distribute="space-evenly")));let p=this.checkNestedValue(e,["settings","block","options","flexWrap","value","value"]);p&&("noWrap"==p&&(p=p.toLowerCase()),i.wrap=p),i.type="stack",this.createNestedObject(e,["settings","style","options","flexLayout"]),e.settings.style.options.flexLayout={value:i,settingName:"flexLayout"},e.settings.style.options.flexLayout.settingName="flexLayout"}t&&(delete e.settings.block.options.flexAlignItems,delete e.settings.block.options.flexAlignSelf,delete e.settings.block.options.flexJustifyContent,delete e.settings.block.options.flexWrap);let s=this.checkNestedValue(e,["settings","container","options","flexGrow","value","value"]),n=this.checkNestedValue(e,["settings","container","options","overFlow","value"]),o=this.checkNestedValue(e,["settings","container","options","horizontalAlign","value","value"]),a=this.checkNestedValue(e,["settings","container","options","verticalAlign","value","value"]),r=this.checkNestedValue(e,["settings","style","options","dimensions","value"]);this.isObject(r)||(r={}),"grow"==s&&(r.grow="grow"),this.createNestedObject(e,["settings","style","options","dimensions","value"]),e.settings.style.options.dimensions.value={...e.settings.style.options.dimensions.value,...r},n&&(this.createNestedObject(e,["settings","style","options","styles","value","overflow"]),e.settings.style.options.styles.value.overflow=n),o&&(this.createNestedObject(e,["settings","style","options","positionDesigner","value","horizontalAlign"]),e.settings.style.options.positionDesigner.value.horizontalAlign=o),a&&(this.createNestedObject(e,["settings","style","options","positionDesigner","value","verticalAlign"]),e.settings.style.options.positionDesigner.value.verticalAlign=a),delete e.settings.container;for(const[t,i]of Object.entries(e.settings)){if("advanced"==t||"block"==t||"container"==t)continue;let i=this.checkNestedValue(e,["settings",t,"options","padding","value"]),s=this.checkNestedValue(e,["settings",t,"options","margin","value"]),n=this.checkNestedValue(e,["settings",t,"options","colorSelect","value"]),o=this.checkNestedValue(e,["settings",t,"options","border","value"]),a=this.checkNestedValue(e,["settings",t,"options","shadow","value"]),r=this.checkNestedValue(e,["settings",t,"options","imageSelect","value"]),l=this.checkNestedValue(e,["settings",t,"options","backgroundPosition","value"]);this.isObject(i)&&(this.createNestedObject(e,["settings",t,"options","spacing","value","padding"]),"remove"==i.preset&&(i.preset="0"),"small"==i.preset&&(i.preset="S"),"medium"==i.preset&&(i.preset="M"),"large"==i.preset&&(i.preset="L"),"xlarge"==i.preset&&(i.preset="XL"),e.settings[t].options.spacing.value.padding=i,delete e.settings[t].options.padding),this.isObject(s)&&(this.createNestedObject(e,["settings",t,"options","spacing","value","margin"]),"remove"==s.preset&&(s.preset="0"),"small"==s.preset&&(s.preset="S"),"medium"==s.preset&&(s.preset="M"),"large"==s.preset&&(s.preset="L"),"xlarge"==s.preset&&(s.preset="XL"),e.settings[t].options.spacing.value.margin=s,delete e.settings[t].options.margin),n&&(this.createNestedObject(e,["settings",t,"options","styles","value","fill"]),e.settings[t].options.styles.value.fill=n,delete e.settings[t].options.colorSelect),o&&(this.createNestedObject(e,["settings",t,"options","styles","value","borders"]),e.settings[t].options.styles.value.borders=[o],delete e.settings[t].options.border),a&&(this.createNestedObject(e,["settings",t,"options","styles","value","shadows"]),e.settings[t].options.styles.value.shadows=[a],delete e.settings[t].options.shadow),r&&(this.createNestedObject(e,["settings",t,"options","styles","value","backgroundImage"]),e.settings[t].options.styles.value.backgroundImage=r,delete e.settings[t].options.imageSelect),l&&(this.createNestedObject(e,["settings",t,"options","styles","value","backgroundImage","sizing"]),e.settings[t].options.styles.value.backgroundImage.sizing=l,delete e.settings[t].options.backgroundPosition),this.createNestedObject(e,["settings",t,"options","styles","settingName"]),e.settings[t].options.styles.settingName="styles",this.createNestedObject(e,["settings",t,"options","spacing","settingName"]),e.settings[t].options.spacing.settingName="spacing"}return e}returnDefaultOptions(e,t,i){let s=[];if(e){let e={option:"flexLayout",label:__("Layout","uipress-lite")};i&&"flexLayout"in i&&(e.value=i.flexLayout),s.push(e)}t?s.push({option:"dimensions",label:__("Size","uipress-lite"),value:{width:{value:"100",units:"%"}}}):s.push({option:"dimensions",label:__("Size","uipress-lite")});let n={option:"styles",label:__("Style","uipress-lite")};i&&"styles"in i&&(n.value=i.styles),s.push(n);let o={option:"spacing",label:__("Spacing","uipress-lite")};return i&&"spacing"in i&&(o.value=i.spacing),s.push(o),s.push({option:"textFormat",label:__("Text","uipress-lite")}),s.push({option:"positionDesigner",label:__("Position","uipress-lite")}),s.push({option:"effectsDesigner",label:__("Effects","uipress-lite")}),s}returnBlockConatinerOptions(){return[{option:"verticalAlign",label:__("Vertical align","uipress-lite")},{option:"horizontalAlign",label:__("Horizontal align","uipress-lite")},{option:"flexGrow",label:__("Grow or shrink","uipress-lite"),value:{value:"none"}},{option:"stretchDirection",label:__("Stretch direction","uipress-lite"),value:{value:"none"}},{option:"dimensions",label:__("Container dimensions","uipress-lite")},{option:"overFlow",label:__("Overflow","uipress-lite")}]}returnFlexOptions(){return[{option:"flexJustifyContent",label:__("Justify content","uipress-lite")},{option:"flexAlignItems",label:__("Align content","uipress-lite")},{option:"flexDirection",label:__("Content direction","uipress-lite")},{option:"flexWrap",label:__("Content wrap","uipress-lite")},{option:"columnGap",label:__("Column gap","uipress-lite")},{option:"rowGap",label:__("Row gap","uipress-lite")}]}returnAdvancedOptions(){return[{option:"classes",label:__("Classes","uipress-lite")},{option:"conditions",label:__("Conditions","uipress-lite"),help:__("Conditions allow you to control who sees this block. If all conditions are not met then this block will not be loaded for the user.","uipress-lite")},{option:"customCode",uniqueKey:"css",label:__("css","uipress-lite"),args:{language:"css"}},{option:"customCode",uniqueKey:"js",label:__("JavaScript","uipress-lite"),args:{language:"javascript"}}]}};