const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object,contextualData:Object},data:function(){return{formSuccess:!1,contextData:this.contextualData,loading:!1,prePopulate:[],populating:!1,strings:{submit:__("Submit","uipress-lite")}}},inject:["uipData","uipress","uiTemplate"],watch:{"block.settings.block.options":{handler(e,t){this.uipress.enviroment&&"builder"==this.uipress.enviroment&&this.getPrepopulate()},deep:!0},"block.content":{handler(e,t){this.uipress.enviroment&&"builder"==this.uipress.enviroment&&this.getPrepopulate()},deep:!0}},mounted:function(){this.getPrepopulate()},computed:{getSubmitValue(){let e=this.uipress.get_block_option(this.block,"block","submitText",!0);return e?this.uipress.isObject(e)?"string"in e?e.string:"":e:""},getSuccessMessage(){return this.uipress.get_block_option(this.block,"block","successMessage")},returnFormData(){return void 0===this.contextData?(this.contextData={},this.contextData.formData={},this.contextData):this.uipress.isObject(this.contextData)?"formData"in this.contextData?this.contextData:(this.contextData.formData={},this.contextData):(this.contextData={},this.contextData.formData={},this.contextData)}},methods:{getPrepopulate(){let e=this,t=this.uipress.get_block_option(this.block,"block","submitAction");if("email"==t.action||"phpFunction"==t.action)return void(e.prePopulate=[]);if(!this.uipress.get_block_option(this.block,"block","prePopulate"))return void(e.prePopulate=!1);if(this.populating)return;e.populating=!0;let i=[],s=new FormData(this.$refs.form);for(const[e,t]of s)i.push(e);if(i.length<1)return;let r=new FormData;r.append("action","uip_pre_populate_form_data"),r.append("security",uip_ajax.security),r.append("formKeys",JSON.stringify(i)),r.append("saveType",t.action),r.append("objectOrSingle",t.objectOrSingle),r.append("userMetaObjectKey",t.userMetaObjectKey),r.append("siteOptionName",t.siteOptionName),e.uipress.callServer(uip_ajax.ajax_url,r).then(t=>{if(setTimeout(function(){e.populating=!1},2e3),t.error)e.uipress.notify(t.message,"","error",!0);else if(t.success){if(e.prePopulate=t.formValues,void 0===e.contextData)return;if(!e.uipress.isObject(e.contextData))return;e.contextData.formData=e.prePopulate}})},onSubmit(){let e=new FormData(this.$refs.form),t={};for(const[i,s]of e)t[i]=s;let i=this.uipress.get_block_option(this.block,"block","submitAction");if("phpFunction"==i.action){if(!i.phpFunction||""==i.phpFunction)return void this.uipress.notify(__("Configuration error","uipress-lite"),__("No php function supplied to send form data to","uipress-lite"),"error");this.processPHPfunction(t,i.phpFunction)}if("email"==i.action){if(!i.emailAddress||""==i.emailAddress)return void this.uipress.notify(__("Configuration error","uipress-lite"),__("No email supplied to send form data to","uipress-lite"),"error");this.processEmail(t,i)}if("siteOption"==i.action){if(!i.siteOptionName||""==i.siteOptionName)return void this.uipress.notify(__("Configuration error","uipress-lite"),__("No site option name supplied to save as","uipress-lite"),"error");this.processSaveAsSiteOption(t,i)}if("userMeta"==i.action){if(!i.objectOrSingle||""==i.objectOrSingle)return void this.uipress.notify(__("Configuration error","uipress-lite"),__("You have not specified how to save the data to the user meta","uipress-lite"),"error");if("object"==i.objectOrSingle&&""==i.userMetaObjectKey)return void this.uipress.notify(__("Configuration error","uipress-lite"),__("You need to specifiy a meta key to save the meta data to","uipress-lite"),"error");this.processSaveAsUserOption(t,i)}},handleRedirect(){let e=this,t=this.uipress.get_block_option(this.block,"block","submitAction");if(""==t.redirectURL.value)return;let i=t.redirectURL;if(i.dynamic?e.uipData.dynamicOptions[i.dynamicKey]&&(i=e.uipData.dynamicOptions[i.dynamicKey].value):i=i.value,void 0===i)return;let s=t.redirectURL.newTab;""!=s&&"dynamic"!=s||this.uipress.updatePage(i),"newTab"==s&&(this.$refs.hiddenlink.href=i,this.$refs.hiddenlink.click()),"default"==s&&window.location.assign(i)},processSaveAsUserOption(e,t){let i=this,s=JSON.stringify(e);i.loading=!0;let r=new FormData;r.append("action","uip_save_form_as_user_option"),r.append("security",uip_ajax.security),r.append("formData",s),r.append("objectOrSingle",t.objectOrSingle),r.append("userMetaObjectKey",t.userMetaObjectKey),i.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{i.loading=!1,e.error?i.uipress.notify(e.message,"","error",!0):e.success&&(i.handleRedirect(),i.formSuccess=!0,setTimeout(function(){i.formSuccess=!1},1e4))})},processSaveAsSiteOption(e,t){let i=this,s=JSON.stringify(e);i.loading=!0;let r=new FormData;r.append("action","uip_save_form_as_option"),r.append("security",uip_ajax.security),r.append("formData",s),r.append("optionKey",t.siteOptionName),i.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{i.loading=!1,e.error?i.uipress.notify(e.message,"","error",!0):e.success&&(i.handleRedirect(),i.formSuccess=!0,setTimeout(function(){i.formSuccess=!1},1e4))})},processEmail(e,t){let i=this,s=JSON.stringify(e);i.loading=!0;let r=new FormData;r.append("action","uip_send_form_email"),r.append("security",uip_ajax.security),r.append("formData",s),r.append("emailTo",t.emailAddress),r.append("emailSubject",t.emailSubject),r.append("emailTemplate",t.emailTemplate),i.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{i.loading=!1,e.error?i.uipress.notify(e.message,"","error",!0):e.success&&(i.handleRedirect(),i.formSuccess=!0,i.$refs.form.reset(),setTimeout(function(){i.formSuccess=!1},1e4))})},processPHPfunction(e,t){let i=this,s=JSON.stringify(e);i.loading=!0;let r=new FormData;r.append("action","uip_process_form_input"),r.append("security",uip_ajax.security),r.append("formData",s),r.append("userFunction",t),i.uipress.callServer(uip_ajax.ajax_url,r).then(e=>{i.loading=!1,e.error?i.uipress.notify(e.message,"","error",!0):e.success&&(i.handleRedirect(),i.formSuccess=!0,i.$refs.form.reset(),setTimeout(function(){i.formSuccess=!1},1e4))})},returnClasses(){let e="";return e+=this.uipress.get_block_option(this.block,"advanced","classes")}},template:'      <div :class="returnClasses()" :id="block.uid">        <div v-if="formSuccess" class="uip-padding-xxs uip-border-round uip-background-green-wash uip-text-green uip-text-bold uip-margin-bottom-s uip-scale-in-top" v-html="getSuccessMessage"></div>        <div class="uip-ajax-loader" v-if="loading">          <div class="uip-loader-bar"></div>        </div>        <form ref="form" class="uip-form-area uip-body-font" @submit.prevent="onSubmit()">          <uip-content-area :contextualData="returnFormData"          :content="block.content" :returnData="function(data) {block.content = data} " layout="vertical" ></uip-content-area>          <input type="submit" class="uip-button-primary uip-submit-button uip-body-font" :value="getSubmitValue"/>        </form>        <a ref="hiddenlink" target="_BLANK" class="uip-hidden"></a>      </div>'}};