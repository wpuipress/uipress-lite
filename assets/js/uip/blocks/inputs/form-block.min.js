const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export default{props:{display:String,name:String,block:Object,contextualData:Object},data(){return{formSuccess:!1,contextData:this.contextualData,loading:!1,prePopulate:[],populating:!1,strings:{submit:__("Submit","uipress-lite")}}},watch:{"block.settings.block.options":{handler(t,e){this.getPrepopulate()},deep:!0},"block.content":{handler(t,e){this.getPrepopulate()},deep:!0}},mounted(){this.getPrepopulate()},computed:{getSubmitValue(){const t=this.get_block_option(this.block,"block","submitText",!0);return t?this.isObject(t)?t.string?t.string:"":t:""},getSuccessMessage(){return this.get_block_option(this.block,"block","successMessage")},returnFormData(){return this.isObject(this.contextData)||(this.contextData={},this.contextData.formData={}),"formData"in this.contextData||(this.contextData.formData={}),this.contextData}},methods:{async getPrepopulate(){let t=this.get_block_option(this.block,"block","submitAction");if(!t)return;if("email"==t.action||"phpFunction"==t.action)return void(this.prePopulate=[]);if(!this.get_block_option(this.block,"block","prePopulate"))return void(this.prePopulate=!1);if(this.populating)return;this.populating=!0;let e=[],i=new FormData(this.$refs.form);for(const[t,s]of i)e.push(t);if(e.length<1)return;let s=new FormData;s.append("action","uip_pre_populate_form_data"),s.append("security",uip_ajax.security),s.append("formKeys",JSON.stringify(e)),s.append("saveType",t.action),s.append("objectOrSingle",t.objectOrSingle),s.append("userMetaObjectKey",t.userMetaObjectKey),s.append("siteOptionName",t.siteOptionName);const a=this.sendServerRequest(uip_ajax.ajax_url,s);setTimeout(()=>{this.populating=!1},2e3),a.error?this.uipApp.notifications.notify(a.message,"","error",!0):a.success&&(this.prePopulate=a.formValues,this.isObject(this.contextData)&&(this.contextData.formData=this.prePopulate))},onSubmit(){const t=new FormData(this.$refs.form);let e={};for(const[i,s]of t)e[i]=s;const i=this.get_block_option(this.block,"block","submitAction"),s=()=>{this.uipApp.notifications.notify(__("Configuration error","uipress-lite"),__("No php function supplied to send form data to","uipress-lite"),"error")};switch(i.action){case"phpFunction":if(!i.phpFunction)return s();this.processPHPfunction(e,i.phpFunction);break;case"email":if(!i.emailAddress)return s();this.processEmail(e,i);break;case"siteOption":if(!i.siteOptionName)return s();this.processSaveAsSiteOption(e,i);break;case"userMeta":if(!i.objectOrSingle)return s();if("object"==!i.objectOrSingle||""==i.userMetaObjectKey)return s();this.processSaveAsUserOption(e,i)}},handleRedirect(){const t=this.get_block_option(this.block,"block","submitAction");if(!t.redirectURL.value)return;const e=t.redirectURL.value;if(!e)return;const i=t.redirectURL.newTab;""!=i&&"dynamic"!=i?("newTab"==i&&(this.$refs.hiddenlink.href=e,this.$refs.hiddenlink.click()),"default"==i&&window.location.assign(e)):this.updateAppPage(e)},async processSaveAsUserOption(t,e){const i=JSON.stringify(t);this.loading=!0;let s=new FormData;s.append("action","uip_save_form_as_user_option"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("objectOrSingle",e.objectOrSingle),s.append("userMetaObjectKey",e.userMetaObjectKey);const a=await this.sendServerRequest(uip_ajax.ajax_url,s);if(this.loading=!1,a.error)return void this.uipApp.notifications.notify(a.message,"","error",!0);if(!a.success)return;this.handleRedirect(),this.formSuccess=!0;setTimeout(()=>{this.formSuccess=!1},1e4)},async processSaveAsSiteOption(t,e){const i=JSON.stringify(t);this.loading=!0;let s=new FormData;s.append("action","uip_save_form_as_option"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("optionKey",e.siteOptionName);const a=await this.sendServerRequest(uip_ajax.ajax_url,s);if(this.loading=!1,a.error)return void this.uipApp.notifications.notify(a.message,"","error",!0);if(!a.success)return;this.handleRedirect(),this.formSuccess=!0;setTimeout(()=>{this.formSuccess=!1},1e4)},async processEmail(t,e){const i=JSON.stringify(t);this.loading=!0;let s=new FormData;s.append("action","uip_send_form_email"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("emailTo",e.emailAddress),s.append("emailSubject",e.emailSubject),s.append("emailTemplate",e.emailTemplate);const a=await this.sendServerRequest(uip_ajax.ajax_url,s);if(this.loading=!1,a.error)return void this.uipApp.notifications.notify(a.message,"","error",!0);if(!a.success)return;this.handleRedirect(),this.formSuccess=!0,this.$refs.form.reset();setTimeout(()=>{this.formSuccess=!1},1e4)},async processPHPfunction(t,e){const i=JSON.stringify(t);this.loading=!0;let s=new FormData;s.append("action","uip_process_form_input"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("userFunction",e);const a=await this.sendServerRequest(uip_ajax.ajax_url,s);if(this.loading=!1,a.error)return void this.uipApp.notifications.notify(a.message,"","error",!0);if(!a.success)return;this.handleRedirect(),this.formSuccess=!0,this.$refs.form.reset();setTimeout(()=>{this.formSuccess=!1},1e4)}},template:'\n    \n      <div>\n      \n        <div v-if="formSuccess" class="uip-padding-xxs uip-border-round uip-background-green-wash uip-text-green uip-text-bold uip-margin-bottom-s uip-scale-in-top" v-html="getSuccessMessage"></div>\n        \n        <div class="uip-ajax-loader" v-if="loading">\n          <div class="uip-loader-bar"></div>\n        </div>\n        \n        <form ref="form" class="uip-form-area uip-body-font" @submit.prevent="onSubmit()">\n          <uip-content-area :contextualData="returnFormData"\n          :content="block.content" :returnData="function(data) {block.content = data}"/>\n          <input type="submit" class="uip-button-primary uip-submit-button uip-body-font" :value="getSubmitValue"/>\n        </form>\n        \n        <a ref="hiddenlink" target="_BLANK" class="uip-hidden"></a>\n        \n      </div>\n      \n      '};