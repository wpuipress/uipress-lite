const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object,contextualData:Object},data(){return{formSuccess:!1,contextData:this.contextualData,loading:!1,prePopulate:[],populating:!1,strings:{submit:__("Submit","uipress-lite")}}},inject:["uipData","uipress"],watch:{"block.settings.block.options":{handler(e,t){this.uipress.enviroment&&"builder"==this.uipress.enviroment&&this.getPrepopulate()},deep:!0},"block.content":{handler(e,t){this.uipress.enviroment&&"builder"==this.uipress.enviroment&&this.getPrepopulate()},deep:!0}},mounted(){this.getPrepopulate()},computed:{getSubmitValue(){const e=this.uipress.get_block_option(this.block,"block","submitText",!0);return e?this.uipress.isObject(e)?e.string?e.string:"":e:""},getSuccessMessage(){return this.uipress.get_block_option(this.block,"block","successMessage")},returnFormData(){return this.uipress.isObject(this.contextData)||(this.contextData={},this.contextData.formData={}),"formData"in this.contextData||(this.contextData.formData={}),this.contextData}},methods:{async getPrepopulate(){let e=this.uipress.get_block_option(this.block,"block","submitAction");if("email"==e.action||"phpFunction"==e.action)return void(this.prePopulate=[]);if(!this.uipress.get_block_option(this.block,"block","prePopulate"))return void(this.prePopulate=!1);if(this.populating)return;this.populating=!0;let t=[],i=new FormData(this.$refs.form);for(const[e,s]of i)t.push(e);if(t.length<1)return;let s=new FormData;s.append("action","uip_pre_populate_form_data"),s.append("security",uip_ajax.security),s.append("formKeys",JSON.stringify(t)),s.append("saveType",e.action),s.append("objectOrSingle",e.objectOrSingle),s.append("userMetaObjectKey",e.userMetaObjectKey),s.append("siteOptionName",e.siteOptionName);const r=this.uipress.callServer(uip_ajax.ajax_url,s);setTimeout(()=>{this.populating=!1},2e3),r.error?this.uipress.notify(r.message,"","error",!0):r.success&&(this.prePopulate=r.formValues,this.uipress.isObject(this.contextData)&&(this.contextData.formData=this.prePopulate))},onSubmit(){const e=new FormData(this.$refs.form);let t={};for(const[i,s]of e)t[i]=s;const i=this.uipress.get_block_option(this.block,"block","submitAction"),s=()=>{this.uipress.notify(__("Configuration error","uipress-lite"),__("No php function supplied to send form data to","uipress-lite"),"error")};switch(i.action){case"phpFunction":if(!i.phpFunction)return s();this.processPHPfunction(t,i.phpFunction);case"email":if(!i.emailAddress)return s();this.processEmail(t,i);case"siteOption":if(!i.siteOptionName)return s();this.processSaveAsSiteOption(t,i);case"userMeta":if(!i.objectOrSingle)return s();if("object"==!i.objectOrSingle||""==i.userMetaObjectKey)return s();this.processSaveAsUserOption(t,i)}},handleRedirect(){const e=this.uipress.get_block_option(this.block,"block","submitAction");if(!e.redirectURL.value)return;const t=e.redirectURL.value;if(!t)return;const i=e.redirectURL.newTab;""!=i&&"dynamic"!=i?("newTab"==i&&(this.$refs.hiddenlink.href=t,this.$refs.hiddenlink.click()),"default"==i&&window.location.assign(t)):this.uipress.updatePage(t)},async processSaveAsUserOption(e,t){const i=JSON.stringify(e);this.loading=!0;let s=new FormData;s.append("action","uip_save_form_as_user_option"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("objectOrSingle",t.objectOrSingle),s.append("userMetaObjectKey",t.userMetaObjectKey);const r=await this.uipress.callServer(uip_ajax.ajax_url,s);if(this.loading=!1,r.error)return void this.uipress.notify(r.message,"","error",!0);if(!r.success)return;this.handleRedirect(),this.formSuccess=!0;setTimeout(()=>{this.formSuccess=!1},1e4)},async processSaveAsSiteOption(e,t){const i=JSON.stringify(e);this.loading=!0;let s=new FormData;s.append("action","uip_save_form_as_option"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("optionKey",t.siteOptionName);const r=await this.uipress.callServer(uip_ajax.ajax_url,s);if(this.loading=!1,r.error)return void this.uipress.notify(r.message,"","error",!0);if(!r.success)return;this.handleRedirect(),this.formSuccess=!0;setTimeout(()=>{this.formSuccess=!1},1e4)},async processEmail(e,t){const i=JSON.stringify(e);this.loading=!0;let s=new FormData;s.append("action","uip_send_form_email"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("emailTo",t.emailAddress),s.append("emailSubject",t.emailSubject),s.append("emailTemplate",t.emailTemplate);const r=await this.uipress.callServer(uip_ajax.ajax_url,s);if(this.loading=!1,r.error)return void this.uipress.notify(r.message,"","error",!0);if(!r.success)return;this.handleRedirect(),this.formSuccess=!0,this.$refs.form.reset();setTimeout(()=>{this.formSuccess=!1},1e4)},async processPHPfunction(e,t){const i=JSON.stringify(e);this.loading=!0;let s=new FormData;s.append("action","uip_process_form_input"),s.append("security",uip_ajax.security),s.append("formData",i),s.append("userFunction",t);const r=await this.uipress.callServer(uip_ajax.ajax_url,s);if(this.loading=!1,r.error)return void this.uipress.notify(r.message,"","error",!0);if(!r.success)return;this.handleRedirect(),this.formSuccess=!0,this.$refs.form.reset();setTimeout(()=>{this.formSuccess=!1},1e4)}},template:'\n    \n      <div>\n      \n        <div v-if="formSuccess" class="uip-padding-xxs uip-border-round uip-background-green-wash uip-text-green uip-text-bold uip-margin-bottom-s uip-scale-in-top" v-html="getSuccessMessage"></div>\n        \n        <div class="uip-ajax-loader" v-if="loading">\n          <div class="uip-loader-bar"></div>\n        </div>\n        \n        <form ref="form" class="uip-form-area uip-body-font" @submit.prevent="onSubmit()">\n          <uip-content-area :contextualData="returnFormData"\n          :content="block.content" :returnData="function(data) {block.content = data}"/>\n          <input type="submit" class="uip-button-primary uip-submit-button uip-body-font" :value="getSubmitValue"/>\n        </form>\n        \n        <a ref="hiddenlink" target="_BLANK" class="uip-hidden"></a>\n        \n      </div>\n      \n      '}};