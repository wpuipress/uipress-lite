const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{deleteRemotePost}from"../../v3.5/utility/functions.min.js";import{defineAsyncComponent,nextTick}from"../../../libs/vue-esm.js";export default{components:{Confirm:defineAsyncComponent(()=>import("../../v3.5/utility/confirm.min.js?ver=3.3.1"))},props:{display:String,name:String,block:Object},data:()=>({searchString:"",results:[],columns:[],page:1,totalPages:0,totalFound:0,initialLoading:!1,postTypes:[],loading:!1,strings:{nothingFound:__("Nothing posts found","uipress-lite"),by:__("By","uipress-lite"),results:__("items","uipress-lite"),searchPlaceHolder:__("Search items","uipress-lite"),gridView:__("Grid view","uipress-lite"),listView:__("List view","uipress-lite")},ui:{view:"list"},searching:!1}),mounted(){this.getPosts(),this.updateView()},watch:{searchString:{handler(i,e){this.page=1,this.getPosts()}},page:{handler(i,e){i&&this.getPosts()}},postTypes:{handler(i,e){this.getPosts()},deep:!0},perPage:{handler(i,e){this.getPosts()}},"block.settings.block.options":{handler(i,e){this.getPosts()},deep:!0},"ui.view":{handler(i,e){let t=!1;"grid"==i&&(t=!0),this.saveUserPreference("prefersGridView",t,!1)}}},computed:{returnPerPage(){return this.hasNestedPath(this.block,"settings","block","options","postsPerPage","value")},getColumns(){return this.hasNestedPath(this.block,"settings","block","options","activeColumns","value")},getActions(){return this.hasNestedPath(this.block,"settings","block","options","actionsEnabled","value")},limitToAuthor(){let i=this.get_block_option(this.block,"block","limitToAuthor");return!!i&&(this.isObject(i)?!!i.value&&i.value:i)},searchDisabled(){let i=this.get_block_option(this.block,"block","searchDisabled");return!!i&&(this.isObject(i)?!!i.value&&i.value:i)}},methods:{updateView(){if(this.uipApp.data.userPrefs.prefersGridView)return this.ui.view="grid";this.ui.view="list"},async getPosts(){if(this.loading)return;this.loading=!0,this.postTypes=this.get_block_option(this.block,"block","activePostTypes");let i=new FormData;i.append("action","uip_get_posts_for_table"),i.append("security",uip_ajax.security),i.append("search",this.searchString),i.append("page",this.page),i.append("postTypes",JSON.stringify(this.postTypes)),i.append("perPage",this.returnPerPage),i.append("limitToAuthor",this.limitToAuthor),i.append("search",this.searchString),i.append("columns",JSON.stringify(this.getColumns)),i.append("actions",JSON.stringify(this.getActions));const e=await this.sendServerRequest(uip_ajax.ajax_url,i);if(!e)return this.uipApp.notifications.notify(__("Unable to fetch posts at this tiem","uipress-lite"),"","","error",!0),void(this.searching=!1);e.error&&(this.uipApp.notifications.notify(e.message,"","","error",!0),this.searching=!1),e.success&&(this.loading=!1,this.results=e.posts,this.columns=e.columns,this.totalFound=e.total,this.totalPages=e.totalPages)},goBack(){this.page>1&&this.page--},goForward(){this.page<this.totalPages&&this.page++},async deleteThisItem(i){await this.$refs.confirm.show({title:__("Delete post","uipress-lite"),message:__("Are you sure you want to delete this post?","uipress-lite"),okButton:__("Delete post","uipress-lite")})&&(await deleteRemotePost(i),this.uipApp.notifications.notify(__("Post deleted","uipress-lite"),"","success",!0),this.getPosts())}},template:'\n          <div class="uip-flex uip-flex-column uip-self-flex-start uip-max-w-100p uip-table-wrap">\n            <div class="uip-margin-bottom-xs uip-flex uip-flex-between">\n            \n              <div class="uip-flex uip-padding-xxs uip-search-block uip-border-round uip-flex-center" v-if="!searchDisabled">\n                <span class="uip-icon uip-text-muted uip-margin-right-xs">search</span> \n                <input class="uip-blank-input uip-flex-grow" type="search" :placeholder="strings.searchPlaceHolder" v-model="searchString" autofocus="">\n              </div>\n              \n              <div class="uip-flex uip-flex-row uip-flex-gap-s">\n                <uip-tooltip :message="strings.listView" :delay="400">\n                  <div class="uip-icon uip-icon-medium uip-text-l uip-link-default uip-padding-xxs" @click="ui.view = \'list\'"\n                  :class="{\'uip-border-bottom-primary uip-text-emphasis\' : ui.view == \'list\'}" >sort</div>\n                </uip-tooltip>\n                <uip-tooltip :message="strings.gridView" :delay="400">\n                  <div class="uip-icon uip-icon-medium uip-text-l uip-link-default uip-padding-xxs" @click="ui.view = \'grid\'"\n                  :class="{\'uip-border-bottom-primary uip-text-emphasis\' : ui.view == \'grid\'}">grid_view</div>\n                </uip-tooltip>\n              </div>\n            </div>\n            \n            \x3c!--Grid view --\x3e\n            <div v-if="ui.view == \'grid\'"  class="uip-position-relative">\n              <div class="uip-ajax-loader" v-if="loading && !initialLoading">\n                <div class="uip-loader-bar"></div>\n              </div>\n            </div>\n            <div v-if="ui.view == \'grid\'" class="uip-margin-bottom-xs uip-position-relative uip-grid-col-5">\n              \n              <template v-for="item in results">\n                <div class="uip-border-round uip-background-muted uip-overflow-hidden uip-self-flex-start uip-grid-item">\n                  <div v-if="item.img" class="uip-background-grey uip-flex uip-flex-center uip-flex-middle">\n                    <img :src="item.img" class="uip-max-w-100p uip-max-h-130" :alt="item.name">\n                  </div>\n                  <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxs">\n                    <div class="uip-flex uip-flex-row uip-flex-between">\n                      <div class="uip-text-bold uip-link-emphasis uip-grid-item-title" @click="updateAppPage(item.link)">{{item.name}}</div>\n                      <div>\n                        <dropdown pos="left center">\n                          <template v-slot:trigger>\n                            <div class="uip-icon uip-icon-medium uip-text-l uip-link-muted hover:uip-background-muted uip-padding-xxs uip-border-round">more_vert</div>\n                          </template>\n                          <template v-slot:content>\n                            <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xs">\n                              <template v-for="action in item.actions">\n                                <div v-if="action.name == \'delete\'" class="uip-flex uip-gap-xxs uip-flex-center uip-link-muted" @click="deleteThisItem(action.ID)">\n                                  <div class="uip-icon uip-icon-small-emphasis">{{action.icon}}</div>\n                                  <div>{{action.label}}</div>\n                                </div>\n                                <div v-else class="uip-flex uip-gap-xxs uip-flex-center uip-link-muted" @click="updateAppPage(action.link)">\n                                  <div class="uip-icon uip-icon-small-emphasis">{{action.icon}}</div>\n                                  <div>{{action.label}}</div>\n                                </div>\n                              </template>\n                            </div>\n                          </template>\n                        </dropdown>\n                      </div>\n                    </div>\n                    <div class="uip-text-s">\n                      <span class="uip-text-muted">{{strings.by}}</span>\n                      <span class="uip-link-default " @click="updateAppPage(item.authorLink)">{{item.author}}</span>\n                      <span class="uip-text-muted">{{item.modified}}</span>\n                    </div>\n                  </div>\n                  <div class="uip-flex uip-flex-column uip-row-gap-xxs uip-padding-xs" v-if="item.categories.length > 0 || item.tags.length > 0 || item.type">\n                    <div class="uip-flex uip-gap-xxs">\n                      <div class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                        {{item.type}}\n                      </div>\n                    </div>\n                    <div class="uip-flex uip-gap-xxs">\n                      <div v-for="cat in item.categories" class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                        {{cat.name}}\n                      </div>\n                    </div>\n                    <div class="uip-flex uip-gap-xxs">\n                      <div v-for="cat in item.categories" class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                        {{cat.tags}}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </template>\n            </div>\n            \x3c!-- End of list view --\x3e\n          \n            <div class="uip-overflow-auto uip-max-w-100vw uip-scrollbar">\n              <div class="uip-position-relative uip-w-100p">\n                <div class="uip-ajax-loader" v-if="loading && !initialLoading">\n                  <div class="uip-loader-bar"></div>\n                </div>\n              </div>\n              <table class="uip-w-100p uip-border-collapse uip-post-table uip-min-w-700" v-if="ui.view == \'list\'">\n                <thead>\n                  <tr class="uip-post-table-row">\n                    <template v-for="column in columns">\n                        <th v-if="column.active && column.name == \'actions\'" class="uip-post-table-head-cell uip-text-capitalize uip-text-muted uip-text-left uip-text-weight-normal uip-padding-xxs uip-post-table-head" style="text-align:right">\n                          {{column.label}}\n                        </th>\n                        <th v-else-if="column.active" class="uip-post-table-head-cell uip-text-capitalize uip-text-muted uip-text-left uip-text-weight-normal uip-padding-xxs uip-post-table-head">\n                          {{column.label}}\n                        </th>\n                    </template>\n                  </tr>\n                </thead>\n                <tbody>\n                  <template v-for="item in results">\n                    <tr class="uip-post-table-row">\n                      <template v-for="column in columns">\n                        <template v-if="column.active">\n                          <td v-if="column.name == \'name\'" class="uip-padding-xxs uip-post-table-cell" :class="column.name">\n                            <div>\n                              <div class="uip-flex uip-flex-row uip-gap-xxs uip-flex-center" >\n                                <div class="uip-text-bold uip-post-title uip-link-default  uip-cursor-pointer"  @click="updateAppPage(item.editLink)">{{item.name}}</div>\n                                <div class="uip-flex uip-gap-xxs uip-flex-center" v-if="item.hover">\n                                  <div @click="updateAppPage(item.editLink)" :href="item.editLink" class="uip-icon uip-cursor-pointer uip-link-default">edit_document</div>\n                                  <a :href="item.link" target="_BLANK" class="uip-icon uip-cursor-pointer uip-link-default uip-no-underline">open_in_new</a>\n                                </div>\n                              </div>\n                              <div class="uip-text-s uip-post-meta uip-flex uip-flex-row uip-gap-xxxs">\n                                <span class="uip-text-muted">{{strings.by}}</span>\n                                <span class="uip-link-default " @click="updateAppPage(item.authorLink)">{{item.author}}</span>\n                                <span class="uip-text-muted">{{item.modified}}</span>\n                              </div>\n                            </div>\n                          </td>\n                          <td v-else-if="column.name == \'actions\'" class="uip-padding-xxs uip-post-table-cell" :class="column.name">\n                            <div class="uip-flex uip-flex-row uip-flex-wrap uip-gap-xs uip-row-gap-xs uip-flex-right">\n                              <dropdown pos="bottom right">\n                                <template v-slot:trigger>\n                                  <div class="uip-icon uip-icon-medium uip-text-l uip-link-muted hover:uip-background-muted uip-padding-xxs uip-border-round">more_vert</div>\n                                </template>\n                                <template v-slot:content>\n                                  <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xs">\n                                    <template v-for="action in item[column.name]">\n                                      <div v-if="action.name == \'delete\'" class="uip-flex uip-gap-xxs uip-flex-center uip-link-muted" @click="deleteThisItem(action.ID)">\n                                        <div class="uip-icon uip-icon-small-emphasis">{{action.icon}}</div>\n                                        <div class="">{{action.label}}</div>\n                                      </div>\n                                      <div v-else class="uip-flex uip-gap-xxs uip-flex-center uip-link-muted" @click="updateAppPage(action.link)">\n                                        <div class="uip-icon uip-icon-small-emphasis">{{action.icon}}</div>\n                                        <div>{{action.label}}</div>\n                                      </div>\n                                    </template>\n                                  </div>\n                                </template>\n                              </dropdown>\n                            </div>\n                          </td>\n                          <td v-else-if="column.name == \'categories\'" class="uip-padding-xxs uip-post-table-cell" :class="column.name">\n                            <div class="uip-flex uip-flex-row uip-flex-wrap uip-gap-xs uip-row-gap-xs">\n                              <div v-for="cat in item[column.name]" class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                                {{cat.name}}\n                              </div>\n                            </div>\n                          </td>\n                          <td v-else-if="column.name == \'tags\'" class="uip-padding-xxs uip-post-table-cell" :class="column.name">\n                            <div class="uip-flex uip-flex-row uip-flex-wrap uip-gap-xs uip-row-gap-xs">\n                              <div v-for="tag in item[column.name]" class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                                {{tag.name}}\n                              </div>\n                            </div>\n                          </td>\n                          <td v-else class="uip-padding-xxs uip-post-table-cell" :class="column.name">\n                            <template v-if="!Array.isArray(item[column.name])">{{item[column.name]}}</template>\n                            <div v-else class="uip-flex uip-flex-row uip-flex-wrap uip-gap-xs uip-row-gap-xs">\n                              <div v-for="tag in item[column.name]" class="uip-text-xs uip-background-primary-wash uip-border-round uip-padding-xxxs uip-text-normal uip-post-type-label">\n                                {{tag.name}}\n                              </div>\n                            </div>\n                          </td>\n                        </template>\n                      </template>\n                    </tr>\n                  </template>\n                </tbody>\n              </table>\n            </div>\n            \n            <div class="uip-flex uip-flex-between uip-flex-center">\n              <div class="uip-padding-xxs uip-post-count">{{totalFound}} {{strings.results}}</div>\n              <div class="uip-flex uip-gap-xs uip-padding-xs" v-if="totalPages > 1">\n                <button @click="goBack" class="uip-button-default uip-icon uip-nav-button">chevron_left</button>\n                <button @click="goForward" v-if="page < totalPages" class="uip-button-default uip-icon uip-nav-button">chevron_right</button>\n              </div>\n            </div>\n          \n        <Confirm ref="confirm"/>  \n      </div>\n      '};