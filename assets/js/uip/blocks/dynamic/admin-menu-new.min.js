const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent}from"../../../libs/vue-esm.js";const MenuCollapse={props:{collapsed:Boolean,returnData:Function},data(){return{strings:{collapseMenu:__("Collapse menu","uipress-lite")},isCollapsed:this.collapsed}},methods:{toggleCollapse(){this.isCollapsed=!this.isCollapsed,this.returnData(this.isCollapsed)}},template:'\n    \n          <div class="uip-flex uip-flex-row uip-gap-xs uip-flex-center uip-link-muted uip-margin-top-s uip-menu-collapse" \n          @click="toggleCollapse()">\n            <div v-if="isCollapsed" class="uip-icon uip-text-">arrow_forward_ios</div>\n            <div v-if="!isCollapsed" class="uip-icon uip-text-">arrow_back_ios</div>\n            <div v-if="!isCollapsed">{{strings.collapseMenu}}</div>\n          </div>\n    \n  '},MenuSearch={emits:["searching"],props:{workingMenu:Array,maybeFollowLink:Function},data:()=>({strings:{search:__("Search menu","uipress-lite")},menuSearch:"",menuSearchIndex:0}),watch:{menuSearch:{handler(){if(this.menuSearchIndex=0,""==this.menuSearch)return this.$emit("searching",!1);this.$emit("searching",!0)}}},computed:{searchItems(){const e=this.menuSearch.toLowerCase(),t=t=>"sep"!==t.type&&(e=>e&&void 0!==e?e.toLowerCase():"")(this.returnName(t)).includes(e);return this.workingMenu.filter(t).concat(this.workingMenu.filter(e=>e.submenu).flatMap(e=>e.submenu.filter(t).map(t=>({...t,parent:e.name}))))}},methods:{returnName(e){return this.hasNestedPath(e,"custom","name")?e.custom.name:e.name},returnItemTarget(e){return this.hasNestedPath(e,"custom","newTab")?"_BLANK":"_SELF"},watchForArrows(e){switch(e.key){case"Enter":const t=document.querySelector(`#uip-menu-search-results [data-id="${this.menuSearchIndex}"]`);t&&t.click();break;case"ArrowDown":this.menuSearchIndex=this.menuSearchIndex>=this.searchItems.length-1?0:this.menuSearchIndex+1;break;case"ArrowUp":this.menuSearchIndex=this.menuSearchIndex<=0?this.searchItems.length-1:this.menuSearchIndex-1}}},template:'\n    \n          <div class="uip-flex uip-menu-search uip-border-round uip-margin-bottom-s uip-flex-center uip-menu-search">\n            <span class="uip-icon uip-text-muted uip-margin-right-xs uip-icon">search</span>\n            <input @keydown="watchForArrows" ref="menusearcher" class="uip-blank-input uip-flex-grow uip-text-s" type="search" :placeholder="strings.search" v-model="menuSearch">\n          </div>\n          \n          <div v-if="menuSearch" class="uip-flex uip-flex-column uip-row-gap-xxs" id="uip-menu-search-results">\n          \n            <template v-for="(item, index) in searchItems">\n            \n                <a :target="returnItemTarget(item)"\n                class="uip-flex uip-flex- uip-gap-xxxs uip-link-default uip-no-underline uip-flex-center uip-text-s uip-padding-xxxs uip-border-rounder"\n                @click="maybeFollowLink($event, item)"\n                :class="menuSearchIndex == index ? \'uip-background-high-light\' : \'\'" :href="item.url" :data-id="index">\n                  \n                  <span class="uip-text-muted" v-if="item.parent">{{item.parent}}</span>\n                  <span class="uip-icon" v-if="item.parent">chevron_right</span>\n                  <span v-html="returnName(item)"></span>\n                  \n                </a>\n              \n            </template>\n          \n          </div>\n    \n  '},SubMenuItem={name:"SubmenuHandler",props:{maybeFollowLink:Function,item:Object,collapsed:Boolean,block:Object,subMenuStyle:String},data:()=>({}),computed:{returnDropdownPosition(){const e=this.get_block_option(this.block,"block","dropdownPosition");return this.isObject(e)&&e.value?e.value:"right top"}},methods:{sepHasCustomName(e){return this.hasNestedPath(e,["custom","name"])},itemHasOpenSubMenu:e=>!!e.submenu&&(!!e.submenu.length&&(!(!e.active&&!e.open)||void 0)),itemHasSubmenu:e=>!!e.submenu&&!!e.submenu.length,returnSubIcon(e){return"hover"==this.subMenuStyle?"chevron_right":this.itemHasSubmenu(e)?"expand_more":"chevron_left"},itemHiden(e){return this.hasNestedPath(e,"custom","hidden")},returnName(e){return this.hasNestedPath(e,"custom","name")?e.custom.name:e.name},returnItemClasses(e){return this.hasNestedPath(e,"custom","classes")?e.custom.classes:""},returnItemHref(e){return this.hasNestedPath(e,"custom","url")?e.custom.url:e.url},returnItemTarget(e){return this.hasNestedPath(e,"custom","newTab")?"_BLANK":"_SELF"}},template:'\n    \n          <div class="uip-admin-submenu">\n          \n              <template v-for="sub in item.submenu">\n              \n                  <template v-if="!itemHiden(sub)">\n                \n                    \x3c!--Hover menu--\x3e\n                    <dropdown v-if="sub.type != \'sep\' && subMenuStyle == \'hover\'" \n                    :pos="returnDropdownPosition" class="uip-flex uip-flex-column uip-row-gap-xs" \n                    :hover="true" :disableTeleport="true">\n                      \n                      <template #trigger>\n                      \n                        \x3c!-- Main link --\x3e\n                        <a :target="returnItemTarget(sub)"\n                        :href="returnItemHref(sub)" @click="maybeFollowLink($event, sub)" :class="returnItemClasses(sub)" \n                        class="uip-no-underline uip-link-muted uip-sub-level-item uip-flex-grow uip-flex uip-gap-xs uip-flex-center" :active="sub.active ? true : false">\n                        \n                          <span v-html="returnName(sub)"></span>\n                          \n                          \x3c!-- Notifications count --\x3e\n                          <div v-if="sub.notifications && sub.notifications > 0" \n                          class="uip-border-circle uip-w-14 uip-h-14 uip-ratio-1-1 uip-background-secondary uip-text-inverse uip-text-xxs uip-flex uip-flex-center uip-flex-middle uip-menu-notification">\n                            <span>{{sub.notifications}}</span>\n                          </div>\n                          \n                          <div v-if="itemHasSubmenu(sub)" class="uip-flex uip-flex-grow uip-flex-center uip-flex-center uip-flex-right">\n                            <div class="uip-icon">{{returnSubIcon(sub)}}</div>\n                          </div>\n                          \n                        </a>\n                        \n                      </template>\n                      \n                      <template v-if="itemHasSubmenu(sub)"  #content>\n                        \n                            <SubmenuHandler :item="sub" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                            \n                      </template>\n                    </dropdown>\n                \n                    \x3c!-- Normal subitem --\x3e\n                    <div v-else-if="sub.type != \'sep\'" class="uip-flex-grow uip-flex-column uip-flex uip-row-gap-xs" :class="returnItemClasses(sub)" >\n                      \n                      \x3c!-- Main link --\x3e\n                      <a :target="returnItemTarget(sub)"\n                      :href="returnItemHref(sub)" @click="maybeFollowLink($event, sub, itemHasSubmenu(sub))" :class="returnItemClasses(sub)" \n                      class="uip-no-underline uip-link-muted uip-sub-level-item uip-flex-grow uip-flex uip-gap-xs uip-flex-center" :active="sub.active ? true : false">\n                        <span v-html="returnName(sub)"></span>\n                        \n                        \x3c!-- Notifications count --\x3e\n                        <div v-if="sub.notifications && sub.notifications > 0" \n                        class="uip-border-circle uip-w-14 uip-h-14 uip-ratio-1-1 uip-background-secondary uip-text-inverse uip-text-xxs uip-flex uip-flex-center uip-flex-middle uip-menu-notification">\n                          <span>{{sub.notifications}}</span>\n                        </div>\n                        \n                        <div v-if="itemHasSubmenu(sub)" class="uip-flex uip-flex-grow uip-flex-center uip-flex-center uip-flex-right">\n                          <div class="uip-icon">{{returnSubIcon(sub)}}</div>\n                        </div>\n                        \n                      </a>\n                      \n                      \x3c!--Sub menu--\x3e\n                      <SubmenuHandler v-if="itemHasSubmenu(sub) && itemHasOpenSubMenu(sub)" :item="sub" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                      \n                      \n                      \n                    </div>\n                    \n                    \x3c!-- Normal seperator--\x3e\n                    <div v-else-if="!sepHasCustomName(sub)" class="uip-margin-bottom-s uip-menu-separator" :class="returnItemClasses(sub)" ></div>\n                    \n                    \x3c!-- Named seperator--\x3e\n                    <div v-else class="uip-margin-bottom-s uip-margin-top-s uip-flex uip-flex-row uip-gap-xxs uip-menu-separator" :class="returnItemClasses(sub)">\n                      <span v-if="sub.custom.icon && sub.custom.icon != \'uipblank\'" class="uip-icon">{{sub.custom.icon}}</span>\n                      <span>{{sub.custom.name}}</span>\n                    </div>\n                  \n                  \n                  </template>\n                \n              </template>\n              \n          </div>\n    \n  '},TopLevelItem={props:{maybeFollowLink:Function,item:Object,collapsed:Boolean,block:Object},data:()=>({}),computed:{subMenuStyle(){if(this.collapsed)return"hover";let e=this.get_block_option(this.block,"block","subMenuStyle");return this.isObject(e)&&e.value?e.value:"dynamic"},subMenuCustomIcon(){let e=this.get_block_option(this.block,"block","subMenuIcon");return!!this.isObject(e)&&(!!e.value&&e.value)},hideIcons(){if(this.collapsed)return!1;const e=this.hasNestedPath(this.block,["settings","block","options","hideIcons","value"]);return this.isObject(e)?e.value:e},itemHiden(){return this.hasNestedPath(this.item,"custom","hidden")},returnName(){return this.hasNestedPath(this.item,"custom","name")?this.item.custom.name:this.item.name},returnName(){return this.hasNestedPath(this.item,"custom","name")?this.item.custom.name:this.item.name},returnIcon(){return this.hasNestedPath(this.item,"custom","icon")?this.item.custom.icon:this.item.icon},returnItemClasses(){return this.hasNestedPath(this.item,"custom","classes")?this.item.custom.classes:""},returnItemHref(){return this.hasNestedPath(this.item,"custom","url")?this.item.custom.url:this.item.url},returnItemTarget(){return this.hasNestedPath(this.item,"custom","newTab")?"_BLANK":"_SELF"}},methods:{returnTopIcon:e=>!!e&&e.includes("uipblank")?e.replace("uipblank","favorite"):e,returnSubIcon(e){return this.subMenuCustomIcon?this.subMenuCustomIcon:"dynamic"==this.subMenuStyle?"chevron_right":"hover"==this.subMenuStyle?"chevron_right":e.open||e.active?"expand_more":"chevron_left"}},template:'\n    \n    <a v-if="!itemHiden" \n    :target="returnItemTarget"\n    :href="returnItemHref" @click="maybeFollowLink($event, item, true)" class="uip-no-underline uip-link-default uip-top-level-item" :class="returnItemClasses" :active="item.active ? true : false">\n    \n      <div v-if="!hideIcons && returnIcon" v-html="returnTopIcon(returnIcon)" class="uip-flex uip-flex-center uip-menu-icon uip-icon uip-icon-medium"></div>\n      \n      <div v-if="!collapsed" class="uip-flex-grow uip-flex uip-gap-xs uip-flex-center">\n        <div class="uip-line-height-1" v-html="returnName"></div>\n        <div v-if="item.notifications && item.notifications > 0" class="uip-border-round uip-h-14 uip-ratio-1-1 uip-background-secondary uip-text-inverse uip-text-xxs uip-text-bold uip-flex uip-flex-center uip-flex-middle uip-menu-notification"><span>{{item.notifications}}</span></div>\n      </div>\n      \n      <div v-if="item.submenu && item.submenu.length > 0 && !collapsed" class="uip-icon uip-link-muted">{{returnSubIcon(item)}}</div>\n      \n    </a>\n    \n  '},DrillDown={components:{TopLevelItem:TopLevelItem,MenuSearch:MenuSearch,MenuCollapse:MenuCollapse},props:{maybeFollowLink:Function,item:Object,collapsed:Boolean,block:Object,menuItems:Array,returnCollapsed:Function,activeLink:String},watch:{isCollapsed:{handler(){this.returnCollapsed(this.isCollapsed)}},activeLink(){this.handleLinkUpdate()}},data(){return{currentLevel:[],levels:[],currentItem:null,searching:!1,isCollapsed:this.collapsed,strings:{goBackPrevious:__("Go back to previous menu","uipress-lite")}}},mounted(){this.initializeMenu()},computed:{parentItemName(){return this.currentItem?this.decodeHtmlEntities(this.returnName(this.currentItem)):__("Go back","uipress-lite")},hasMenuSearch(){const e=this.get_block_option(this.block,"block","showSearch");return this.isObject(e)?e.value:e},hasMenuCollapse(){const e=this.get_block_option(this.block,"block","menuCollapse");return this.isObject(e)?e.value:e},returnLevelsLength(){return this.levels.length},showSearchBox(){return!!this.searching||this.hasMenuSearch&&!this.levels.length}},methods:{returnName(e){return this.hasNestedPath(e,"custom","name")?e.custom.name:e.name},drillDown(e){this.levels.push(this.currentLevel),this.currentItem=e,this.currentLevel=e.submenu},goBack(){this.currentLevel=this.levels.pop()},initializeMenu(){this.currentLevel=this.menuItems},handleLinkClick(e,t){if(t.submenu&&t.submenu.length)return this.drillDown(t),void e.preventDefault();this.maybeFollowLink(e,t),e.preventDefault()},async handleLinkUpdate(e){const t=e||this.currentLevel;let n=!1;for(let e of t)e.active=!1,e.url==this.activeLink&&(e.active=!0,n=!0),e.submenu&&Array.isArray(e.submenu)&&(n=await this.handleLinkUpdate(e.submenu))&&(this.currentLevel=e.submenu,this.levels.push(t));return n},decodeHtmlEntities:e=>e?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/%20/g," "):"",sepHasCustomName(e){return this.hasNestedPath(e,["custom","name"])},returnItemClasses(e){return this.hasNestedPath(e,"custom","classes")?e.custom.classes:""}},template:'\n    \n             \n              \n              <Transition name="translate" mode="out-in">\n                <div :key="currentLevel" class="uip-admin-menu uip-text-normal" :class="{\'uip-menu-collapsed\' : collapsed}">\n                \n                  <MenuSearch v-if="showSearchBox" \n                  key="menusearch"\n                  @searching="(d)=>{searching = d}"\n                  :maybeFollowLink="maybeFollowLink" :workingMenu="menuItems"/>\n                  \n                  <template v-if="!searching">\n                  \n                    \x3c!-- Display Back button if there are levels to go back to --\x3e\n                    <a v-if="levels.length" \n                    role="button" \n                    :aria-label="strings.goBackPrevious" \n                    class="uip-flex uip-gap-xxs uip-flex-center uip-flex-row uip-flex-center uip-text-bold uip-text-l uip-sub-menu-header uip-link-default uip-margin-bottom-s uip-gap-xxs" \n                    @click="goBack">\n                      <div class="uip-icon">chevron_left</div>\n                      <div class="uip-flex-grow" v-html="parentItemName"></div>\n                    </a>\n                    \n                    \x3c!-- Loop through currentLevel and display each item --\x3e\n                    <template v-for="item of currentLevel">\n                      <TopLevelItem v-if="item.type != \'sep\'" :item="item" :maybeFollowLink="handleLinkClick" :collapsed="isCollapsed" :block="block"/> \n                      \n                      <div v-else-if="!sepHasCustomName(item)" class="uip-margin-bottom-s uip-menu-separator" :class="returnItemClasses(item)"></div>\n                      \n                      <div v-else class="uip-margin-bottom-xs uip-margin-top-xs uip-flex uip-flex-row uip-gap-xxs uip-menu-separator" :class="returnItemClasses(item)">\n                        <span v-if="item.custom.icon && item.custom.icon != \'uipblank\'" class="uip-icon">{{item.custom.icon}}</span>\n                        <span>{{item.custom.name}}</span>\n                      </div>\n                      \n                    </template>\n                    \n                    <MenuCollapse v-if="hasMenuCollapse" :collapsed="isCollapsed" :returnData="(d) => {isCollapsed = d}"/>\n                  \n                  </template>\n                  \n                </div>\n              </Transition>\n              \n    \n  '};export default{props:{display:String,name:String,block:Object},components:{TopLevelItem:TopLevelItem,SubMenuItem:SubMenuItem,DrillDownMenu:DrillDown,MenuSearch:MenuSearch,MenuCollapse:MenuCollapse,Confirm:defineAsyncComponent(()=>import("../../v3.5/utility/confirm.min.js?ver=3.3.1"))},data(){return{menu:[],activeMenu:!1,rendered:!0,workingMenu:[],watchMenu:[],activeLink:"",breadCrumbs:[{name:__("Home","uipress-lite"),url:this.uipApp.data.dynamicOptions.viewadmin.value}],searching:!1,staticMenuEnabled:!1,strings:{mainmenu:__("Main menu","uipress-lite"),collapseMenu:__("Collapse menu","uipress-lite"),search:__("Search menu","uipress-lite")},collapsed:!1}},inject:["uiTemplate"],watch:{breadCrumbs:{handler(e,t){let n=new CustomEvent("uipress/app/breadcrumbs/update",{detail:{crumbs:this.breadCrumbs}});document.dispatchEvent(n)},deep:!0},collapsed:{handler(e,t){let n=!!e;document.documentElement.setAttribute("uip-menu-collapsed",String(n)),this.uiTemplate.menuCollapsed=n,this.saveUserPreference("menuCollapsed",n,!1)}},hasStaticMenuEnabled:{handler(){this.hasStaticMenuEnabled?this.returnStaticMenuID&&this.getStaticMenu():(this.staticMenuEnabled=!1,this.setMenu(),this.buildMenu())},deep:!0},returnStaticMenuID:{handler(){this.returnStaticMenuID&&this.hasStaticMenuEnabled&&this.getStaticMenu()},immediate:!0}},created(){this.setMenu(),this.buildMenu()},mounted(){this.mountEventListeners()},computed:{hasStaticMenuEnabled(){const e=this.get_block_option(this.block,"block","staticMenu");return!!this.isObject(e)&&e.enabled},returnStaticMenuID(){const e=this.get_block_option(this.block,"block","staticMenu");return!!this.isObject(e)&&e.menuid},subMenuStyle(){if(this.collapsed)return"hover";let e=this.get_block_option(this.block,"block","subMenuStyle");return this.isObject(e)&&e.value?e.value:"dynamic"},subMenuCustomIcon(){let e=this.get_block_option(this.block,"block","subMenuIcon");return!!this.isObject(e)&&(!!e.value&&e.value)},autoLoadIsEnabled(){const e=this.get_block_option(this.block,"block","loadOnClick");return!!this.isObject(e)&&e.value},hasMenuCollapse(){const e=this.get_block_option(this.block,"block","menuCollapse");return this.isObject(e)?e.value:e},hasMenuSearch(){const e=this.get_block_option(this.block,"block","showSearch");return this.isObject(e)?e.value:e},returnDropdownPosition(){const e=this.get_block_option(this.block,"block","dropdownPosition");return this.isObject(e)&&e.value?e.value:"right top"},returnClasses(){if(this.collapsed)return"uip-menu-collapsed"},hideIcons(){if(this.collapsed)return!1;const e=this.hasNestedPath(this.block,["settings","block","options","hideIcons","value"]);return this.isObject(e)?e.value:e}},beforeUnmount(){document.removeEventListener("uipress/app/page/change",this.updateActiveLink,{once:!1}),document.removeEventListener("uipress/app/page/load/finish",this.updateMenuFromFrame,{once:!1}),document.removeEventListener("uipress/blocks/adminmenu/togglecollapse",this.handleMenuCollapse,{once:!1})},methods:{setMenu(){this.uipApp.data.userPrefs.menuCollapsed&&(this.collapsed=!0),this.returnStaticMenuID&&this.hasStaticMenuEnabled||(this.menu=JSON.parse(JSON.stringify(this.uipApp.data.adminMenu.menu)))},async getStaticMenu(){if(await this.$nextTick(),!this.returnStaticMenuID)return;if("prod"==this.uiTemplate.display&&this.staticMenuEnabled)return;this.rendered=!1;const e=!(!this.uipApp.data.options.multisite||!this.uipApp.data.options.networkActivated)&&"uiptrue";let t=new FormData;t.append("action","uip_get_custom_static_menu"),t.append("security",uip_ajax.security),t.append("menuid",this.returnStaticMenuID),t.append("isMultisite",e);const n=await this.sendServerRequest(uip_ajax.ajax_url,t),i=()=>{this.menu=JSON.parse(JSON.stringify(this.uipApp.data.adminMenu.menu)),this.buildMenu(),this.rendered=!0};return n.error?(this.uipApp.notifications.notify(n.message,"","error",!0,!1),i()):"data"in n&&Array.isArray(n.data.menu)?(this.menu=n.data.menu,this.buildMenu(),this.staticMenuEnabled=!0,void(this.rendered=!0)):i()},mountEventListeners(){document.addEventListener("uipress/app/page/change",this.updateActiveLink,{once:!1}),document.addEventListener("uipress/app/page/load/finish",this.updateMenuFromFrame,{once:!1}),document.addEventListener("uipress/blocks/adminmenu/togglecollapse",this.handleMenuCollapse,{once:!1})},handleMenuCollapse(e){this.collapsed=!this.collapsed},updateActiveLink(e){this.activeLink=e.detail.url?e.detail.url.replaceAll("%2F","/"):e.detail.url},buildMenu(){const e=this.activeLink;if(!e)return this.workingMenu=this.menu;this.breadCrumbs=[{name:__("Home","uipress-lite"),url:this.uipApp.data.dynamicOptions.viewadmin.value}];const t=t=>{t.active=!1,t.url=t.url?this.decodeHtmlEntities(t.url):void 0,t.name=t.name?this.decodeHtmlEntities(t.name):void 0,t.url===e&&(t.active=!0,this.breadCrumbs.push({name:t.name,url:t.url}))};this.menu.forEach(n=>{n.active=!1,n.url=n.url?this.decodeHtmlEntities(n.url):void 0,n.name=n.name?this.decodeHtmlEntities(n.name):void 0;const i=this.workingMenu.find(e=>e.uip_uid===n.uip_uid);!!i&&i.open&&(n.open=!0),n.url===e&&(n.active=!0,this.breadCrumbs.push({name:n.name,url:n.url})),n.submenu&&(n.submenu.forEach(t),n.submenu.some(e=>!0===e.active)&&(n.active=!0))}),this.workingMenu=this.menu},returnItemLink(e){return this.hasNestedPath(e,"custom","url")?e.custom.url:e.url},updateMenuFromFrame(){if(this.staticMenuEnabled)return;const e=document.querySelector(".uip-page-content-frame");if(!e)return;this.setWatchMenu(e);const t=e.contentWindow.document.querySelector("#uip-admin-menu"),n=!!t&&this.uipParseJson(t.getAttribute("data-menu"));n&&n&&void 0!==n&&"menu"in n&&(this.menu=n.menu,this.buildMenu())},setWatchMenu(e){},async handleNewMenuItems(e){e.length;const t=this.findExistingObjectsByUID(this.uipApp.data.adminMenu.menu,e);if(t.length===e.length)return void console.log("aborted all items already exist");console.log(t),t.length&&(e=this.removeObjectsByUID(e,t));let n='<div class="uip-margin-top-s uip-margin-bottom-s uip-flex uip-flex-column uip-row-gap-xs">';for(let t of e)n+=`<div><div class="uip-text-bold uip-text-normal">${t.name}</div>`,n+=`<a href="${t.url}" target="_BLANK" class="uip-text-s">${t.url}</a></div>`;n+="</div>",await this.$refs.confirm.show({title:__("New menu items detected!","uipress-lite"),message:__("Do you want to add the below items to your menu?","uipress-lite")+n,okButton:__("Add items to menu","uipress-lite")})&&(console.log("added"),this.pushNewItemsToServerMenu(e),this.menu=[...this.menu,...e],this.buildMenu())},async pushNewItemsToServerMenu(e){const t=this.uipApp.data.adminMenu.menu_id;let n=new FormData;n.append("action","uip_push_new_custom_menu_items"),n.append("security",uip_ajax.security),n.append("menu_id",t),n.append("new_items",JSON.stringify(e));const i=await this.sendServerRequest(uip_ajax.ajax_url,n);return i.error?(this.uipApp.notifications.notify(__("Something went wrong","uipress-lite"),i.message,"","error"),!1):i.success?(this.uipApp.notifications.notify(__("Menu updated","uipress-lite"),"","success"),!0):void 0},async removeItemsFromServerMenu(e){const t=this.uipApp.data.adminMenu.menu_id;let n=new FormData;n.append("action","uip_remove_custom_menu_items"),n.append("security",uip_ajax.security),n.append("menu_id",t),n.append("new_items",JSON.stringify(e));const i=await this.sendServerRequest(uip_ajax.ajax_url,n);return i.error?(this.uipApp.notifications.notify(__("Something went wrong","uipress-lite"),i.message,"","error"),!1):i.success?(this.uipApp.notifications.notify(__("Menu updated","uipress-lite"),"","success"),!0):void 0},async handleRemovedMenuItems(e){e.length;const t=this.findExistingObjectsByUID(this.uipApp.data.adminMenu.menu,e);if(!t.length)return void console.log("aborted");e=t;let n='<div class="uip-margin-top-s uip-margin-bottom-s uip-flex uip-flex-column uip-row-gap-xs">';for(let t of e)n+=`<div><div class="uip-text-bold uip-text-normal">${t.name}</div>`,n+=`<a href="${t.url}" target="_BLANK" class="uip-text-s">${t.url}</a></div>`;n+="</div>",await this.$refs.confirm.show({title:__("Items removed from menu!","uipress-lite"),message:__("Do you want to remove the below items from your menu?","uipress-lite")+n,okButton:__("Remove items from menu","uipress-lite")})&&(console.log("removed"),this.removeItemsFromServerMenu(e),this.menu=this.removeObjectsByUID(this.menu,e),this.buildMenu())},removeObjectsByUID(e,t){const n=t.map(e=>e.uip_uid);return e.filter(e=>!n.includes(e.uip_uid))},findExistingObjectsByUID(e,t){const n=t.map(e=>e.uip_uid);return e.filter(e=>n.includes(e.uip_uid))},findRemovedItems:(e,t)=>e.filter(e=>!t.find(t=>t.uip_uid===e.uip_uid)),findAddedItems:(e,t)=>t.filter(t=>!e.find(e=>e.id===t.id)),processWatchMenuItem(e,t){let n=e.id,i=e.querySelector(":scope > a");if("collapse-menu"===n||!i)return;if("true"==i.getAttribute("aria-hidden"))return;let s=t?i:i.querySelector(":scope > .wp-menu-name"),u=s?s.innerText:"",a=s?s.innerHTML.split("<")[0]:"",r=s?this.extractNumberFromHtml(s.innerHTML):0,o=!t&&i.querySelector(":scope > .wp-menu-image");if(o){const e=["uip-w-16","uip-ratio-1-1","uip-background-no-repeat","uip-background-center","uip-background-contain"];o.classList.contains("svg")&&o.classList.add(...e)}let l=t?"":`${n} menu-top menu-top-first`,c=o?o.outerHTML:"",p=i.getAttribute("href"),m=this.findClassWithPrefix(e,"uip_uid_");m=m?m.replace("uip_uid_",""):this.createUID();let d=this.findClassWithPrefix(e,"uip_wp_id_");d=d?d.replace("uip_wp_id_",""):this.createUID();let h=this.findClassWithPrefix(e,"uip_unp_url_");h=h?h.replace("uip_unp_url_",""):p,n=n||i.href;let b=e.querySelector(":scope > ul.wp-submenu"),v=[];if(b){b.querySelectorAll(":scope > li").forEach(e=>{const t=this.processWatchMenuItem(e,!0);t&&v.push(t)})}return{0:u,1:d,2:h,id:n,url:p,submenu:v,name:u,cleanName:a,icon:c,custom:{},notifications:r,type:"menu",uip_uid:m,active:!1,classes:l}},findClassWithPrefix:(e,t)=>Array.from(e.classList).find(e=>e.startsWith(t)),extractNumberFromHtml(e){if(!e)return null;const t=(new DOMParser).parseFromString(e,"text/html").getElementsByTagName("*");for(let e=0;e<t.length;e++){const n=t[e].textContent.trim();if(!isNaN(n)&&""!==n)return parseInt(n,10)}return null},maybeFollowLink(e,t,n){if(!(e.ctrlKey||e.shiftKey||e.metaKey||1==e.button||this.hasNestedPath(t,"custom","newTab"))){if(e.preventDefault(),n&&!this.autoLoadIsEnabled&&t.submenu&&t.submenu.length>0)return t.open=!t.open,void(this.activeMenu=t);t.active=!0,t.submenu&&t.submenu.length>0&&(this.activeMenu=t),this.updateAppPage(this.returnItemLink(t))}},returnSubIcon(e){return this.subMenuCustomIcon?this.subMenuCustomIcon:"dynamic"==this.subMenuStyle?"chevron_right":e.open||e.active?"expand_more":"chevron_left"},returnTopIcon:e=>!!e&&e.includes("uipblank")?e.replace("uipblank","favorite"):e,decodeHtmlEntities:e=>e?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/%20/g," "):"",sepHasCustomName(e){return this.hasNestedPath(e,["custom","name"])},itemHasOpenSubMenu:e=>!!e.submenu&&(!!e.submenu.length&&(!(!e.active&&!e.open)||void 0)),returnItemClasses(e){return this.hasNestedPath(e,"custom","classes")?e.custom.classes:""},itemHiden(e){return this.hasNestedPath(e,"custom","hidden")}},template:'\n    \n          <DrillDownMenu v-if="subMenuStyle == \'dynamic\' && rendered" :menuItems="workingMenu" \n          :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"\n          :activeLink="activeLink"\n          :returnCollapsed="(d)=>{collapsed=d}"/>\n    \n          <div v-else-if="rendered" class="uip-admin-menu uip-text-normal" :class="returnClasses">\n          \n            <Confirm ref="confirm"/> \n          \n            <MenuSearch v-if="hasMenuSearch && !collapsed" \n            @searching="(d)=>{searching = d}"\n            :maybeFollowLink="maybeFollowLink" :workingMenu="workingMenu"/>\n            \n            \x3c!--INLINE DROP MENU--\x3e\n            <template v-if="subMenuStyle == \'inline\' && !searching">\n            \n                <template v-for="item in workingMenu">\n                \n                  <div v-if="item.type != \'sep\' && !itemHiden(item)" class="uip-flex uip-flex-column uip-row-gap-xs">\n                  \n                    <TopLevelItem :item="item" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                    \n                    <Transition name="slide-down">\n                      <SubMenuItem :subMenuStyle="subMenuStyle" v-if="itemHasOpenSubMenu(item)" :item="item" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                    </Transition>\n                    \n                  </div>\n                  \n                  <div v-else-if="!sepHasCustomName(item) && !itemHiden(item)" class="uip-margin-bottom-s uip-menu-separator" :class="returnItemClasses(item)"></div>\n                  \n                  <div v-else-if="!itemHiden(item)" class="uip-margin-bottom-xs uip-margin-top-xs uip-flex uip-flex-row uip-gap-xxs uip-menu-separator" :class="returnItemClasses(item)">\n                    <span v-if="item.custom.icon && item.custom.icon != \'uipblank\'" class="uip-icon">{{item.custom.icon}}</span>\n                    <span>{{item.custom.name}}</span>\n                  </div>\n                  \n                </template>\n              \n            </template>\n            \x3c!--END INLINE DROP MENU--\x3e\n            \n            \n            \n            \x3c!--HOVER MENU--\x3e\n            <template v-if="subMenuStyle == \'hover\' && !searching">\n            \n                <template v-for="item in workingMenu">\n                \n                  <dropdown v-if="item.type != \'sep\' && !itemHiden(item)"  :pos="returnDropdownPosition" class="uip-flex uip-flex-column uip-row-gap-xs" \n                  :hover="true" :disableTeleport="true">\n                    \n                    <template v-slot:trigger>\n                    \n                      <TopLevelItem :item="item" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                      \n                    </template>\n                    \n                    <template v-if="item.submenu && item.submenu.length > 0" v-slot:content>\n                      \n                          <SubMenuItem :subMenuStyle="subMenuStyle" :item="item" :maybeFollowLink="maybeFollowLink" :collapsed="collapsed" :block="block"/>\n                          \n                    </template>\n                  </dropdown>\n                  \n                  \n                  <div v-else-if="!sepHasCustomName(item) && !itemHiden(item)" class="uip-margin-bottom-s uip-menu-separator" :class="returnItemClasses(item)"></div>\n                  \n                  <div v-else-if="!itemHiden(item)" class="uip-margin-bottom-xs uip-margin-top-xs uip-flex uip-flex-row uip-gap-xxs uip-menu-separator" :class="returnItemClasses(item)">\n                    <span v-if="item.custom.icon && item.custom.icon != \'uipblank\'" class="uip-icon">{{item.custom.icon}}</span>\n                    <span>{{item.custom.name}}</span>\n                  </div>\n                \n                  \n                </template>\n              \n            </template>\n            \n            \n            \n            \n            \n            <a ref="newTab" target="_BLANK" class="uip-hidden"></a>\n            \n            <MenuCollapse v-if="hasMenuCollapse" :collapsed="collapsed" :returnData="(d) => {collapsed = d}"/>\n            \n          </div>'};