const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{nextTick}from"../../../libs/vue-esm.js";const submenu={name:"SubMenu",props:{submenu:Object,updatePage:Function,formatHREF:Function,itemHasSubmenu:Function,dropPos:String},data:()=>({}),template:'\n    \n    <div class="uip-toolbar-submenu uip-min-w-200 uip-border-rounder uip-padding-xs uip-max-h-500" style="overflow:auto">\n    \n      <template  v-for="sub in submenu">\n        \n        <dropdown width="200" :pos="dropPos" v-if="sub.title" :hover="true"  :disableTeleport="true">\n        \n          <template v-slot:trigger>\n            <a @click="updatePage(sub, $event)" :href="formatHREF(sub.href)" class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" >\n              <span v-html="sub.title"></span>\n              <span v-if="itemHasSubmenu(sub.submenu)" class="uip-icon">chevron_right</span>\n            </a>\n          </template>\n          \n          \n          <template v-slot:content v-if="itemHasSubmenu(sub.submenu)">\n          \n            <SubMenu\n            :updatePage="updatePage"\n            :formatHREF="formatHREF"\n            :itemHasSubmenu="itemHasSubmenu"\n            :submenu="sub.submenu"/>\n          \n          </template>\n          \n        </dropdown>\n        \n      </template>\n      \n    </div>\n    \x3c!--END SECOND DROP --\x3e\n  \n  '};export default{components:{SubMenu:submenu},props:{display:String,name:String,block:Object},data:()=>({toolbar:{},rendered:!1}),async mounted(){this.dequeueAdminBarStyles(),this.importToolBar(),await nextTick(),this.updateFromDom()},beforeUnmount(){document.removeEventListener("uipress/app/page/load/finish",this.handlePagechange)},computed:{getHidden(){let e=this.get_block_option(this.block,"block","hiddenToolbarItems");return Array.isArray(e)?e:[]},returnToolbar(){return this.toolbar},returnDropdownPosition(){let e=this.get_block_option(this.block,"block","dropdownPosition");return e=(e=(e=!!this.isObject(e)&&e.value)||"bottom left").includes(" ")?e:"bottom left"},returnSubDropdownPosition(){let e=this.get_block_option(this.block,"block","subDropdownPosition");return e=(e=(e=!!this.isObject(e)&&e.value)||"right top").includes(" ")?e:"right top"}},methods:{importToolBar(){this.toolbar=JSON.parse(JSON.stringify(this.uipApp.data.toolbar)),document.addEventListener("uipress/app/page/load/finish",this.handlePagechange)},async handlePagechange(e){this.updateToolBarFromFrame(),setTimeout(()=>{this.updateQM(),this.updateFromDom()},300)},dequeueAdminBarStyles(){let e=document.querySelector('link[href*="load-styles.php?"]');if(!e)return this.rendered=!0;const t=e.href.replace("admin-bar,",","),n=document.createElement("link");n.href=t,n.setAttribute("rel","stylesheet");const i=()=>{e.remove(),n.removeEventListener("load",i),this.rendered=!0},o=document.head;o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.addEventListener("load",i)},async updateFromDom(){const e=document.querySelector(".uip-page-content-frame"),t=e?e.contentWindow.document:document,n=t.getElementById("wp-admin-bar-root-default"),i=t.getElementById("wp-admin-bar-top-secondary");if(!n)return;const o=Array.from(n.children),r=Array.from(i.children),a=[...o,...r],u=this.uipApp.data.options.adminURL,s=this.uipApp.data.options.domain,p=u.replace(s,"");a.forEach(e=>{let t=e.getAttribute("id");if(t=t.replace("wp-admin-bar-",""),!this.toolbar)return;if(!t||this.toolbar[t]||["site-name","menu-toggle","app-logo","my-account"].includes(t))return;const n=this.createToolbarItem(e,p,u);n&&(this.toolbar[t]=n)})},createToolbarItem(e,t,n){let i=e.getAttribute("id");i=i.replace("wp-admin-bar-","");const o=e.querySelector("a.ab-item");if(!o)return!1;let r=o.getAttribute("href")||"";r.startsWith(t)&&(r=r?r.replace(t,n):"");const a={id:i,group:"",meta:[],parent:"",submenu:{},title:o.innerHTML||"",href:r||""};return Array.from(e.querySelectorAll(".ab-sub-wrapper .ab-submenu > *")).forEach(e=>{let i=e.getAttribute("id");if(i=i?i.replace("wp-admin-bar-",""):""){const o=this.createToolbarItem(e,t,n);a.submenu[i]=o}}),a},async updateQM(){if(!this.toolbar["query-monitor"])return;await nextTick();const e=document.querySelector(".uip-page-content-frame");if(!e)return;const t=e.contentWindow.document.querySelector("#wp-admin-bar-query-monitor");t&&(this.updateQMToolbarTitle(t),this.updateQMSubItems(t))},updateQMToolbarTitle(e){const t=e.querySelector(".ab-item"),n=t?t.innerHTML:this.toolbar["query-monitor"].title;this.toolbar["query-monitor"].title=n,this.toolbar["query-monitor"].frameLink=!0,e.classList.contains("qm-warning")&&this.appendToolbarStatusIndicator("red");["qm-alert","qm-notice","qm-deprecated","qm-strict","qm-expensive"].some(t=>e.classList.contains(t))&&this.appendToolbarStatusIndicator("orange")},appendToolbarStatusIndicator(e){this.toolbar["query-monitor"].title+=`<span class="uip-display-inline-block uip-border-circle uip-w-8 uip-ratio-1-1 uip-background-${e} uip-margin-left-xxs"></span>`},updateQMSubItems(e){const t={};e.querySelectorAll("#wp-admin-bar-query-monitor-default > li").forEach(e=>{const n=e.getAttribute("id"),i=n.replace("wp-admin-bar-query-monitor-",""),o=e.querySelector("a");t[i]={group:"",href:o.getAttribute("href"),id:n,meta:[],parent:"query-monitor",submenu:{},title:o.textContent,frameLink:!0}}),this.toolbar["query-monitor"].submenu=t},updateToolBarFromFrame(){const e=document.querySelector(".uip-page-content-frame");if(e){const t=e.contentWindow.document.querySelector("#uip-admin-toolbar"),n=!!t&&this.uipParseJson(t.getAttribute("data-toolbar"));if(!n)return;Array.isArray(n)||(this.toolbar={...n})}},ifHidden(e){return!this.getHidden.includes(e)},customIcon(e){const t=this.get_block_option(this.block,"block","editToolbarItems");return!!(this.isObject(t)&&Object.hasOwn(t,e)&&t[e].icon)&&t[e].icon},customTitle(e){const t=this.get_block_option(this.block,"block","editToolbarItems");return!!(this.isObject(t)&&Object.hasOwn(t,e)&&t[e].title)&&t[e].title},updatePage(e,t,n=!1){if(!(t.ctrlKey||t.shiftKey||t.metaKey||1===t.button))if(t.preventDefault(),e.frameLink){const t=document.querySelector(".uip-page-content-frame");if(t){const n=t.contentWindow.document.querySelector(`#${e.id} a`);n&&n.click()}}else this.updateAppPage(this.formatHREF(e.href),n)},formatHREF(e){const{adminURL:t,domain:n}=this.uipApp.data.options,i=t.replace(n,"");return e&&e.startsWith(i)?e.replace(i,t):e},itemHasSubmenu(e){return!!this.isObject(e)&&(Object.keys(e).length>0||void 0)}},template:'\n            \n              <div id="wpadminbar" style="display: block !important;" class="uip-text-normal" v-if="rendered">\n              \n                <component is="style">\n                  .uip-admin-toolbar #wpadminbar {all:unset}\n                  .uip-admin-toolbar #wpadminbar .ab-icon {font-size:18px; filter: contrast(0.6);}\n                </component>\n              \n                <div class="uip-admin-toolbar uip-flex">\n                \n                  <template v-for="(item, key) in returnToolbar">\n                  \n                      \x3c!--FIRST DROP --\x3e\n                      <dropdown :hover="true" :pos="returnDropdownPosition" :disableTeleport="true"\n                      v-if="ifHidden(key)" :id="\'wp-admin-bar-\' + item.id" :class="item.meta.class">\n                        <template v-slot:trigger>\n                        \n                          <a :href="formatHREF(item.href)" @click="updatePage(item, $event)" class="uip-link-default uip-no-underline uip-toolbar-top-item uip-flex uip-gap-xs uip-flex-center">\n                            <div class="uip-icon uip-toolbar-top-item-icon uip-text-l" v-if="customIcon(item.id)">{{customIcon(item.id)}}</div>\n                            \n                            <component v-if="customIcon(item.id)" is="style" scoped>\n                              #{{\'wp-admin-bar-\' + item.id}} .ab-icon{display:none}\n                            </component>\n                            \n                            <div class="uip-line-height-1 uip-flex uip-gap-xxs" v-if="customTitle(item.id)">{{customTitle(item.id)}}</div>\n                            <div class="uip-line-height-1 uip-flex uip-gap-xxs uip-flex-center" v-if="!customTitle(item.id)" v-html="item.title"></div>\n                          </a>\n                        </template>\n                        \n                        <template v-slot:content v-if="itemHasSubmenu(item.submenu)">\n                        \n                          \n                          \n                          \n                            \x3c!-- NETWORK ADMIN TOOLBAR --\x3e\n                            <div v-if="item.id == \'my-sites\'" class="uip-toolbar-submenu uip-min-w-200 uip-padding-xs uip-max-h-500" style="overflow:auto">\n                              <template  v-for="subsection in item.submenu">\n                                <div class="uip-padding-xxs uip-flex uip-flex-column uip-row-gap-xxs uip-min-w-130">\n                                  <template v-for="sub in subsection.submenu">\n                                  \n                                    \x3c!--SECOND DROP --\x3e\n                                    <dropdown :hover="true" :pos="returnSubDropdownPosition" :disableTeleport="true">\n                                        <template v-slot:trigger>\n                                          <a :href="formatHREF(sub.href)" @click="updatePage(sub, $event, true)"  class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" >\n                                            <span v-html="sub.title"></span>\n                                            <span v-if="sub.submenu" class="uip-icon">chevron_right</span>\n                                          </a>\n                                        </template>\n                                        <template v-slot:content v-if="sub.submenu">\n                                          <div class="uip-toolbar-submenu uip-min-w-200 uip-padding-xs">\n                                            <template v-for="subsub in sub.submenu">\n                                              <a :href="formatHREF(subsub.href)" @click="updatePage(subsub, $event, true)"  class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" v-html="subsub.title"></a>\n                                            </template>\n                                          </div>\n                                        </template>\n                                      </dropdown>\n                                      \x3c!--END SECOND DROP --\x3e\n                                      \n                                  </template>\n                                </div>\n                                <div v-if="subsection.id == \'my-sites-super-admin\'" class="uip-border-bottom"></div>                              </template>\n                            </div>\n                            \x3c!-- END NETWORK ADMIN TOOLBAR --\x3e\n                            \n                            \n                           <SubMenu v-else\n                           :updatePage="updatePage"\n                           :formatHREF="formatHREF"\n                           :itemHasSubmenu="itemHasSubmenu"\n                           :submenu="item.submenu"\n                           :dropPos="returnSubDropdownPosition"/>\n                            \n                        \n                        </template>\n                      </dropdown>\n                      \x3c!--END FIRST DROP --\x3e\n                      \n                  </template>\n                </div>\n              \n              </div>\n              '};