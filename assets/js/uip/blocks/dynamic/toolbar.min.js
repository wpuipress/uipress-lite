const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{nextTick}from"../../../libs/vue-esm-dev.js";export function moduleData(){return{props:{display:String,name:String,block:Object},data:()=>({toolbar:{},rendered:!1}),inject:["uipData","uipress"],async mounted(){this.dequeueAdminBarStyles(),this.importToolBar(),await nextTick(),this.updateFromDom(),this.rendered=!0},beforeUnmount(){document.removeEventListener("uip_page_change_loaded",this.handlePagechange)},computed:{getHidden(){let e=this.block.settings.block.options.hiddenToolbarItems.value;return this.uipress.isObject(e)?[]:e},returnToolbar(){return this.toolbar},returnDropdownPosition(){let e=this.uipress.get_block_option(this.block,"block","dropdownPosition");return this.uipress.isObject(e)?e.value:e||"bottom left"},returnSubDropdownPosition(){let e=this.uipress.get_block_option(this.block,"block","subDropdownPosition");return this.uipress.isObject(e)?e.value:e||"right top"}},methods:{importToolBar(){this.toolbar=JSON.parse(JSON.stringify(this.uipData.toolbar)),document.addEventListener("uip_page_change_loaded",this.handlePagechange)},async handlePagechange(e){this.updateToolBarFromFrame(),setTimeout(()=>{this.updateQM(),this.updateFromDom()},300)},dequeueAdminBarStyles(){let e=document.querySelector('link[href*="load-styles.php?"]');if(!e)return;const t=e.href.replace("admin-bar,",","),i=document.createElement("link");i.href=t,i.setAttribute("rel","stylesheet");const n=()=>{e.remove(),i.removeEventListener("load",n)},o=document.head;o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.addEventListener("load",n)},async updateFromDom(){const e=document.querySelector(".uip-page-content-frame"),t=e?e.contentWindow.document:document,i=t.getElementById("wp-admin-bar-root-default"),n=t.getElementById("wp-admin-bar-top-secondary");if(!i)return;const o=Array.from(i.children),r=Array.from(n.children),a=[...o,...r],u=this.uipData.options.adminURL,s=this.uipData.options.domain,l=u.replace(s,"");a.forEach(e=>{let t=e.getAttribute("id");if(!(t=t.replace("wp-admin-bar-",""))||this.toolbar[t]||["site-name","menu-toggle","app-logo","my-account"].includes(t))return;const i=this.createToolbarItem(e,l,u);this.toolbar[t]=i})},createToolbarItem(e,t,i){const n=e.querySelector("a.ab-item");let o=n.getAttribute("href")||"";o.startsWith(t)&&(o=o.replace(t,i));const r={id:"attr",group:"",meta:[],parent:"",submenu:{},title:n.innerHTML||"",href:o||""};return Array.from(e.querySelectorAll(".ab-sub-wrapper .ab-submenu > *")).forEach(e=>{let n=e.getAttribute("id");if(n=n.replace("wp-admin-bar-","")){const o=createToolbarItem(e,t,i);r.submenu[n]=o}}),r},async updateQM(){if(!this.toolbar["query-monitor"])return;await nextTick();const e=document.querySelector(".uip-page-content-frame");if(!e)return;const t=e.contentWindow.document.querySelector("#wp-admin-bar-query-monitor");t&&(this.updateQMToolbarTitle(t),this.updateQMSubItems(t))},updateQMToolbarTitle(e){const t=e.querySelector(".ab-item"),i=t?t.innerHTML:this.toolbar["query-monitor"].title;this.toolbar["query-monitor"].title=i,this.toolbar["query-monitor"].frameLink=!0,e.classList.contains("qm-warning")&&this.appendToolbarStatusIndicator("red");["qm-alert","qm-notice","qm-deprecated","qm-strict","qm-expensive"].some(t=>e.classList.contains(t))&&this.appendToolbarStatusIndicator("orange")},appendToolbarStatusIndicator(e){this.toolbar["query-monitor"].title+=`<span class="uip-display-inline-block uip-border-circle uip-w-8 uip-ratio-1-1 uip-background-${e} uip-margin-left-xxs"></span>`},updateQMSubItems(e){const t={};e.querySelectorAll("#wp-admin-bar-query-monitor-default > li").forEach(e=>{const i=e.getAttribute("id"),n=i.replace("wp-admin-bar-query-monitor-",""),o=e.querySelector("a");t[n]={group:"",href:o.getAttribute("href"),id:i,meta:[],parent:"query-monitor",submenu:{},title:o.textContent,frameLink:!0}}),this.toolbar["query-monitor"].submenu=t},updateToolBarFromFrame(){const e=document.querySelector(".uip-page-content-frame");if(e&&e.contentWindow.uipMasterToolbar){const t=e.contentWindow.uipMasterToolbar;Array.isArray(t)||(this.toolbar={...t})}},ifHidden(e){return!this.getHidden.includes(e)},customIcon(e){const t=this.uipress.get_block_option(this.block,"block","editToolbarItems");return!!(this.uipress.isObject(t)&&Object.hasOwn(t,e)&&t[e].icon)&&t[e].icon},customTitle(e){const t=this.uipress.get_block_option(this.block,"block","editToolbarItems");return!!(this.uipress.isObject(t)&&Object.hasOwn(t,e)&&t[e].title)&&t[e].title},updatePage(e,t,i=!1){if(!(t.ctrlKey||t.shiftKey||t.metaKey||1===t.button))if(t.preventDefault(),e.frameLink){const t=document.querySelector(".uip-page-content-frame");if(t){const i=t.contentWindow.document.querySelector(`#${e.id} a`);i&&i.click()}}else this.uipress.updatePage(this.formatHREF(e.href),i)},formatHREF(e){const{adminURL:t,domain:i}=this.uipData.options,n=t.replace(i,"");return e&&e.startsWith(n)?e.replace(n,t):e}},template:'\n            <div class="uip-text-normal" v-if="rendered">\n            \n            \n              <component is="style">\n                .uip-admin-toolbar #wpadminbar {all:unset}\n                .uip-admin-toolbar #wpadminbar .ab-icon {font-size:18px; filter: contrast(0.6);}\n              </component>\n              \n              <div id="wpadminbar" style="display: block !important;">\n              \n                <div class="uip-admin-toolbar uip-flex">\n                  <template v-for="item in returnToolbar">\n                  \n                    <div class="" v-if="ifHidden(item.id)" :id="\'wp-admin-bar-\' + item.id" :class="item.meta.class">\n                      \x3c!--FIRST DROP --\x3e\n                      <dropdown :hover="true" :pos="returnDropdownPosition">\n                        <template v-slot:trigger>\n                        \n                          <a :href="formatHREF(item.href)" @click="updatePage(item, $event)" class="uip-link-default uip-no-underline uip-toolbar-top-item uip-flex uip-gap-xs uip-flex-center">\n                            <div class="uip-icon uip-toolbar-top-item-icon uip-text-l" v-if="customIcon(item.id)">{{customIcon(item.id)}}</div>\n                            \n                            <component v-if="customIcon(item.id)" is="style" scoped>\n                              #{{\'wp-admin-bar-\' + item.id}} .ab-icon{display:none}\n                            </component>\n                            \n                            <div class="uip-line-height-1 uip-flex uip-gap-xxs" v-if="customTitle(item.id)">{{customTitle(item.id)}}</div>\n                            <div class="uip-line-height-1 uip-flex uip-gap-xxs uip-flex-center" v-if="!customTitle(item.id)" v-html="item.title"></div>\n                          </a>\n                        </template>\n                        <template v-slot:content v-if="item.submenu && Object.keys(item.submenu).length > 0">\n                        \n                          <div class="uip-toolbar-submenu uip-min-w-200 uip-border-rounder uip-padding-xs">\n                          \n                          \n                            \x3c!-- NETWORK ADMIN TOOLBAR --\x3e\n                            <template v-if="item.id == \'my-sites\'" v-for="subsection in item.submenu">\n                              <div class="uip-padding-xxs uip-flex uip-flex-column uip-row-gap-xxs uip-min-w-130">\n                                <template v-for="sub in subsection.submenu">\n                                  \x3c!--SECOND DROP --\x3e\n                                <dropdown width="200" :hover="true">\n                                    <template v-slot:trigger>\n                                      <a :href="formatHREF(sub.href)" @click="updatePage(sub, $event, true)"  class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" >\n                                        <span v-html="sub.title"></span>\n                                        <span v-if="sub.submenu" class="uip-icon">chevron_right</span>\n                                      </a>\n                                    </template>\n                                    <template v-slot:content v-if="sub.submenu">\n                                      <div class="uip-toolbar-submenu uip-min-w-200 uip-padding-xs">\n                                        <template v-for="subsub in sub.submenu">\n                                          <a :href="formatHREF(subsub.href)" @click="updatePage(subsub, $event, true)"  class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" v-html="subsub.title"></a>\n                                        </template>\n                                      </div>\n                                    </template>\n                                  </dropdown>\n                                  \x3c!--END SECOND DROP --\x3e\n                                </template>\n                              </div>\n                              <div v-if="subsection.id == \'my-sites-super-admin\'" class="uip-border-bottom"></div>                            </template>\n                            \x3c!-- END NETWORK ADMIN TOOLBAR --\x3e\n                            \n                            \n                            <template  v-else v-for="sub in item.submenu">\n                              \x3c!--SECOND DROP --\x3e\n                              <dropdown width="200" :pos="returnSubDropdownPosition" triggerClass="uip-flex uip-flex-grow" :hover="true">\n                                <template v-slot:trigger>\n                                  <a @click="updatePage(sub, $event)" :href="formatHREF(sub.href)" class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" >\n                                    <span v-html="sub.title"></span>\n                                    <span v-if="Object.keys(sub.submenu).length > 0" class="uip-icon">chevron_right</span>\n                                  </a>\n                                </template>\n                                <template v-slot:content v-if="Object.keys(sub.submenu).length > 0">\n                                  <div class="uip-toolbar-submenu uip-min-w-200 uip-padding-xs">\n                                    <template v-for="subsub in sub.submenu">\n                                      <a @click="updatePage(subsub, $event)" :href="formatHREF(subsub.href)" class="uip-link-default uip-no-underline uip-toolbar-sub-item uip-flex uip-flex-center uip-flex-between uip-gap-s uip-flex-grow uip-padding-xxs uip-border-rounder hover:uip-background-muted" v-html="subsub.title"></a>\n                                    </template>\n                                  </div>\n                                </template>\n                              </dropdown>\n                              \x3c!--END SECOND DROP --\x3e\n                            </template>\n                          </div>\n                        </template>\n                      </dropdown>\n                      \x3c!--END FIRST DROP --\x3e\n                      \n                    </div>\n                  </template>\n                </div>\n              \n              </div>\n              \n            </div>'}};