const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm.js";const ToggleSection={props:{title:String,startOpen:Boolean},data:()=>({open:!1}),created(){this.startOpen&&(this.open=!0)},computed:{returnVisibilityIcon(){return this.open?"expand_more":this.open?void 0:"chevron_left"}},methods:{toggleVisibility(){this.open=!this.open}},template:'\n  \n    <div class="uip-flex uip-flex-column uip-row-gap-s">\n    \n      \x3c!-- Title --\x3e\n      <div class="uip-flex uip-gap-s uip-flex-center uip-flex-between">\n        \n       \n        <div class="uip-flex uip-gap-xxs uip-flex-center uip-cursor-pointer uip-flex-between uip-flex-grow"\n        @click="toggleVisibility()">\n          \n          \n          <span class="uip-text-bold uip-text-emphasis">{{ title }}</span> \n          \n          <a class="uip-link-muted uip-icon">{{ returnVisibilityIcon }}</a>\n          \n          \n        </div>\n      \n      </div>\n      \n      <slot v-if="open"></slot>\n      \n    </div>\n  \n  '};export default{components:{ToggleSection:ToggleSection},props:{mode:String,insertArea:Array},data:()=>({loading:!0,categories:[],search:"",strings:{proBlock:__("This block requires uipress pro. Upgrade to unlock.","uipress-lite"),seachBlocks:__("Search blocks...","uipress-lite"),upgrade:__("Upgrade","uipress-lite")}}),inject:["uiTemplate"],computed:{sortedBlocks(){return this.removeOldBlocks().sort((e,n)=>e.name.localeCompare(n.name))},returnCats(){const e=["responsive-grid","uip-admin-menu","uip-user-meta-block"];return Object.entries(this.returnGroups).map(([n,i])=>{const t=this.uipApp.data.blocks.filter(i=>i.group===n&&!e.includes(i.moduleName)).sort((e,n)=>e.name.localeCompare(n.name));return{name:i.label,blocks:t}})},returnGroups(){return this.uipApp.data.blockGroups}},methods:{returnGroupLabel(e){return this.uipApp.data.blockGroups[e].label},removeOldBlocks(){const e=["responsive-grid","uip-admin-menu","uip-user-meta-block"];return this.uipApp.data.blocks.filter(n=>!e.includes(n.moduleName))},clone(e){let n=JSON.parse(JSON.stringify(e));return n.tooltip={},n.settings={},this.inject_block_presets(n),delete n.path,delete n.args,delete n.category,delete n.description,delete n.optionsEnabled,delete n.hover,n},inject_block_presets(e){const n=e.moduleName,i=this.uipApp.data.blocks,t=i.findIndex(e=>e.moduleName===n);if(t<0)return;const s=i[t].optionsEnabled,r=s.findIndex(e=>"block"===e.name),o=["block","advanced"];for(let n of s){if(o.includes(n.name))continue;if(!1 in n)continue;const i=n.presets;if(this.isObject(i))for(let t in i)this.ensureNestedObject(e,"settings",n.name,"options",t,"value"),e.settings[n.name].options[t].value={...i[t]}}if(r<0)return;const p=s[r].options;this.ensureNestedObject(e,"settings","block","options");for(let n of p){if(!n)return;if(!("value"in n))continue;const i=n.uniqueKey?n.uniqueKey:n.option;e.settings.block.options[i]={value:n.value}}},componentExists(e){if(e.premium&&!this.uiTemplate.proActivated)return!1;const n=e.moduleName;return!!this.$root._.appContext.components[n]||void 0},async insertAtPos(e){if("click"!=this.mode)return;if(!Array.isArray(this.insertArea))return;let n=this.clone(e);n.uid=this.createUID(),this.insertArea.push(n),await nextTick();const i=this.insertArea[this.insertArea.length-1];this.uipApp.blockControl.setActive(i,this.insertArea),this.$emit("item-added")},inSearch(e){if(""==this.search)return!0;let n=this.search.toLowerCase();return!!e.name.toLowerCase().includes(n)||!!e.description.toLowerCase().includes(n)}},template:'\n    \n    <div class="uip-flex uip-flex-column uip-row-gap-s">\n    \n        <div class="uip-flex uip-padding-xxs uip-search-block uip-border-rounder uip-padding-xxs uip-background-muted">\n          <span class="uip-icon uip-text-muted uip-margin-right-xs uip-text-l uip-icon uip-icon-medium">search</span>\n          <input class="uip-blank-input uip-flex-grow uip-text-s" type="search" :placeholder="strings.seachBlocks" autofocus="" v-model="search">\n        </div>\n        \n        \x3c!--Searching--\x3e\n        <uip-draggable v-if="search != \'\'"\n          :list="sortedBlocks" \n          class="uip-flex uip-flex-column uip-row-gap-xs uip-padding-left-xs"\n          handle=".uip-block-drag"\n          :group="{ name: \'uip-blocks\', pull: \'clone\', put: false, revertClone: true }"\n          animation="300"\n          :sort="false"\n          :clone="clone"\n          ghostClass="uip-drop-in-ghost"\n          itemKey="name">\n            <template v-for="(element, index) in sortedBlocks" :key="element.name" :index="index">\n          \n                <div v-show="componentExists(element) && inSearch(element)" class="uip-block-item" :block-name="element.name">\n                    <div @click="insertAtPos(element)" class="uip-border-rounder uip-link-default hover:uip-background-muted uip-cursor-pointer uip-block-drag uip-no-text-select">\n                      <div class="uip-flex uip-gap-xxs uip-flex-center">\n                        <div class="uip-icon uip-text-l uip-padding-xxs uip-background-muted uip-border-rounder uip-text-emphasis uip-margin-right-xs">\n                          <span>{{element.icon}}</span>\n                        </div> \n                        <div class="uip-text-center uip-text-s uip-text-muted">{{returnGroupLabel(element.group)}}</div>\n                        <div class="uip-icon uip-text-muted">chevron_right</div>\n                        <div class="uip-text-s">{{element.name}}</div>\n                      </div>\n                    </div>\n                </div>\n            \n            </template>\n        </uip-draggable>\n              \n        \n        <template v-if="search == \'\'" v-for="cat in returnCats">\n          \n            <ToggleSection :title="cat.name" :startOpen="true">\n              \n                <uip-draggable \n                v-if="cat.blocks.length"\n                :list="cat.blocks" \n                class="uip-flex uip-flex-column uip-row-gap-xs uip-padding-left-xs"\n                handle=".uip-block-drag"\n                :group="{ name: \'uip-blocks\', pull: \'clone\', put: false, revertClone: true }"\n                animation="300"\n                :sort="false"\n                :clone="clone"\n                ghostClass="uip-drop-in-ghost"\n                itemKey="name">\n                  <template v-for="(element, index) in cat.blocks" :key="element.name" :index="index">\n                \n                       <div v-if="componentExists(element)" @click="insertAtPos(element)" class="uip-border-rounder uip-link-default hover:uip-background-muted uip-cursor-pointer uip-block-drag uip-no-text-select">\n                         <div class="uip-flex uip-gap-xxs uip-flex-center">\n                           <div class="uip-icon uip-text-l uip-padding-xxs uip-background-muted uip-border-rounder uip-text-emphasis uip-margin-right-xs">\n                             <span>{{element.icon}}</span>\n                           </div> \n                           <div class="uip-text-s">{{element.name}}</div>\n                         </div>\n                       </div>\n                       \n                      <div v-else @mouseenter="element.hover=true" @mouseleave="element.hover = false"\n                      class="uip-border-rounder uip-link-default hover:uip-background-muted uip-cursor-pointer uip-block-drag uip-no-text-select">\n                        <div class="uip-flex uip-gap-xxs uip-flex-center">\n                          <div class="uip-icon uip-icon-medium uip-text-l uip-padding-xxs uip-background-green-wash uip-border-rounder uip-margin-right-xs">\n                            <span>redeem</span>\n                          </div> \n                          <div class="uip-text-s uip-flex-grow">{{element.name}}</div>\n                          \n                          <a v-show="element.hover"\n                          href="https://uipress.co?utm_source=uipressupgrade&utm_medium=referral" \n                          target="_BLANK" \n                          class="uip-link-muted uip-flex uip-gap-xxxs uip-no-underline uip-flex-center uip-padding-right-xxs uip-fade-in">\n                            <span class="uip-text-s">{{strings.upgrade}}</span>\n                            <span class="uip-icon">chevron_right</span>\n                          </a>\n                        </div>\n                      </div>\n                      \n                  \n                  </template>\n                </uip-draggable>\n            \n            </ToggleSection>  \n            \n          \n        </template>\n      </div>'};