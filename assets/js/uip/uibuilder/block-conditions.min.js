export default{data:()=>({currentDate:new Date}),mounted(){this.updateDate(),this.interval=setInterval(this.updateDate,6e4)},beforeUnmount(){clearInterval(this.interval)},computed:{currentDayOfWeek(){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][this.currentDate.getDay()]},currentLocalDate(){const t=this.currentDate;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},currentLocalTime(){const t=this.currentDate;return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}},methods:{updateDate(){this.currentDate=new Date},handleConditionLogic(t,e,a){let i=!1;t=a?t:t.toLowerCase();const o=e.value.toLowerCase(),n=a?t.includes(o):t===o,r=a?t.toString().toLowerCase():"";return"is"===e.operator&&n?i=!0:"isnot"!==e.operator||n?"contains"===e.operator&&!a&&t.includes(o)?i=!0:"contains"===e.operator&&a&&r.includes(o)&&(i=!0):i=!0,i?"met":"not_met"},handleNumericalConditionLogic(t,e){let a=!1;const i=parseFloat(e.value),o=parseFloat(t);return isNaN(i)||isNaN(o)?"not_met":("is"===e.operator&&i===o?a=!0:"isnot"===e.operator&&i!==o?a=!0:"contains"===e.operator&&t.includes(e.value)?a=!0:"greaterThan"===e.operator&&o>i?a=!0:"greaterThanEqualTo"===e.operator&&o>=i?a=!0:"lessThan"===e.operator&&o<i?a=!0:"lessThanEqualTo"===e.operator&&o<=i&&(a=!0),a?"met":"not_met")},handleDateConditionLogic(t){let e=!1;const a=new Date(t.value),i=new Date(this.currentLocalDate);return"is"===t.operator&&a.getTime()===i.getTime()?e=!0:"isnot"===t.operator&&a.getTime()!==i.getTime()?e=!0:"contains"===t.operator&&this.currentLocalDate.includes(t.value)?e=!0:"greaterThan"===t.operator&&i>a?e=!0:"greaterThanEqualTo"===t.operator&&i>=a?e=!0:"lessThan"===t.operator&&i<a?e=!0:"lessThanEqualTo"===t.operator&&i<=a&&(e=!0),e?"met":"not_met"},handleTimeConditionLogic(t){let e=!1;const a=this.timeStringToMinutes(this.currentLocalTime),i=this.timeStringToMinutes(t.value);return console.log(this.currentLocalTime),console.log(t.value),"is"===t.operator&&this.currentLocalTime===t.value?e=!0:"isnot"===t.operator&&this.currentLocalTime!==t.value?e=!0:"contains"===t.operator&&this.currentLocalTime.includes(t.value)?e=!0:"greaterThan"===t.operator&&a>i?e=!0:"greaterThanEqualTo"===t.operator&&a>=i?e=!0:"lessThan"===t.operator&&a<i?e=!0:"lessThanEqualTo"===t.operator&&a<=i&&(e=!0),e?"met":"not_met"},timeStringToMinutes(t){t=t.trim();const[e,a]=t.split(":").map(Number);return 60*e+a},blockMetConditions(){if(!this.isProduction)return!0;let t=this.get_block_option(this.block,"advanced","conditions");if(void 0===t)return!0;if(!this.isObject(t))return!0;let e=t.conditions,a=t.relation?t.relation:"and";if(!Array.isArray(e))return!0;let i=[],o="",n="",r=this.uipApp.data.options.dynamicData.userid.value,s=this.uipApp.data.options.dynamicData.username.value,u=this.uipApp.data.options.dynamicData.userroles.value,l=this.uipApp.data.options.dynamicData.useremail.value;for(let t of e)if(""!==t.value)switch(t.type){case"userlogin":o=this.handleConditionLogic(s,t),i.push(o);break;case"userid":o=this.handleNumericalConditionLogic(r,t),i.push(o);break;case"useremail":o=this.handleConditionLogic(l,t),i.push(o);break;case"userrole":o=this.handleConditionLogic(u,t,!0),i.push(o);break;case"weekday":n=this.currentDayOfWeek==t.value.toLowerCase(),o=this.handleConditionLogic(n,t),i.push(o);break;case"date":o=this.handleDateConditionLogic(t),i.push(o);break;case"time":o=this.handleTimeConditionLogic(t),i.push(o);break;case"siteTitle":o=this.handleConditionLogic(this.uipApp.data.options.site_name,t),i.push(o);break;case"siteURL":o=this.handleConditionLogic(this.uipApp.data.options.domain,t),i.push(o);break;case"adminURL":o=this.handleConditionLogic(this.uipApp.data.options.adminURL,t),i.push(o);break;case"currentPageName":o=this.handleConditionLogic(this.uipApp.data.options.dynamicData.adminPageTitle.value,t),i.push(o);break;case"currentURL":o=this.handleConditionLogic(window.location.href,t),i.push(o);break;case"locale":o=this.handleConditionLogic(this.uipApp.data.options.locale,t),i.push(o);break;case"pluginActive":const e=Object.values(this.uipApp.data.options.activePlugins).map(t=>t.split("/")[0]);o=this.handleConditionLogic(e,t,!0),i.push(o);break;case"notificationCount":console.log(this.uipApp.data.options.dynamicData),o=this.handleNumericalConditionLogic(this.uipApp.data.options.dynamicData.notificationCount.value,t,!0),i.push(o);break;case"darkMode":const a=this.uipApp.data.userPrefs.darkTheme?"true":"false";t.value=t.value?"true":"false",o=this.handleConditionLogic(a,t),i.push(o)}return"or"==a?i.includes("met"):!i.includes("not_met")}}};