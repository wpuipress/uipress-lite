export default{data:()=>({currentDate:new Date,currentURL:window.location.href}),mounted(){this.updateDate(),this.interval=setInterval(this.updateDate,6e4),document.addEventListener("uipress/app/page/change",this.updateCurrentURL,{once:!1})},beforeUnmount(){clearInterval(this.interval),document.removeEventListener("uipress/app/page/change",this.updateCurrentURL,{once:!1})},computed:{currentDayOfWeek(){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][this.currentDate.getDay()]},currentLocalDate(){const e=this.currentDate;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},currentLocalTime(){const e=this.currentDate;return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}},methods:{updateCurrentURL(e){this.currentURL=e.detail.url?e.detail.url.replaceAll("%2F","/"):e.detail.url},updateDate(){this.currentDate=new Date},handleConditionLogic(e,t,a){let i=!1;e="boolean"==typeof e||a?e:e.toLowerCase();const o=t.value.toLowerCase(),n=a?e.includes(o):e===o,r=a?e.toString().toLowerCase():"";return"is"===t.operator&&n?i=!0:"isnot"!==t.operator||n?"contains"===t.operator&&!a&&e.includes(o)?i=!0:"contains"===t.operator&&a&&r.includes(o)&&(i=!0):i=!0,i?"met":"not_met"},handleNumericalConditionLogic(e,t){let a=!1;const i=parseFloat(t.value),o=parseFloat(e);return isNaN(i)||isNaN(o)?"not_met":("is"===t.operator&&i===o?a=!0:"isnot"===t.operator&&i!==o?a=!0:"contains"===t.operator&&e.includes(t.value)?a=!0:"greaterThan"===t.operator&&o>i?a=!0:"greaterThanEqualTo"===t.operator&&o>=i?a=!0:"lessThan"===t.operator&&o<i?a=!0:"lessThanEqualTo"===t.operator&&o<=i&&(a=!0),a?"met":"not_met")},handleDateConditionLogic(e){let t=!1;const a=new Date(e.value),i=new Date(this.currentLocalDate);return"is"===e.operator&&a.getTime()===i.getTime()?t=!0:"isnot"===e.operator&&a.getTime()!==i.getTime()?t=!0:"contains"===e.operator&&this.currentLocalDate.includes(e.value)?t=!0:"greaterThan"===e.operator&&i>a?t=!0:"greaterThanEqualTo"===e.operator&&i>=a?t=!0:"lessThan"===e.operator&&i<a?t=!0:"lessThanEqualTo"===e.operator&&i<=a&&(t=!0),t?"met":"not_met"},handleTimeConditionLogic(e){let t=!1;const a=this.timeStringToMinutes(this.currentLocalTime),i=this.timeStringToMinutes(e.value);return console.log(this.currentLocalTime),console.log(e.value),"is"===e.operator&&this.currentLocalTime===e.value?t=!0:"isnot"===e.operator&&this.currentLocalTime!==e.value?t=!0:"contains"===e.operator&&this.currentLocalTime.includes(e.value)?t=!0:"greaterThan"===e.operator&&a>i?t=!0:"greaterThanEqualTo"===e.operator&&a>=i?t=!0:"lessThan"===e.operator&&a<i?t=!0:"lessThanEqualTo"===e.operator&&a<=i&&(t=!0),t?"met":"not_met"},timeStringToMinutes(e){e=e.trim();const[t,a]=e.split(":").map(Number);return 60*t+a},blockMetConditions(){if(!this.isProduction)return!0;let e=this.get_block_option(this.block,"advanced","conditions");if(void 0===e)return!0;if(!this.isObject(e))return!0;let t=e.conditions,a=e.relation?e.relation:"and";if(!Array.isArray(t))return!0;let i=[],o="",n=this.uipApp.data.options.dynamicData.userid.value,r=this.uipApp.data.options.dynamicData.username.value,s=this.uipApp.data.options.dynamicData.userroles.value,u=this.uipApp.data.options.dynamicData.useremail.value;for(let e of t)if(""!==e.value)switch(e.type){case"userlogin":o=this.handleConditionLogic(r,e),i.push(o);break;case"userid":o=this.handleNumericalConditionLogic(n,e),i.push(o);break;case"useremail":o=this.handleConditionLogic(u,e),i.push(o);break;case"userrole":o=this.handleConditionLogic(s,e,!0),i.push(o);break;case"weekday":o=this.handleConditionLogic(this.currentDayOfWeek,e),i.push(o);break;case"date":o=this.handleDateConditionLogic(e),i.push(o);break;case"time":o=this.handleTimeConditionLogic(e),i.push(o);break;case"siteTitle":o=this.handleConditionLogic(this.uipApp.data.options.site_name,e),i.push(o);break;case"siteURL":o=this.handleConditionLogic(this.uipApp.data.options.domain,e),i.push(o);break;case"adminURL":o=this.handleConditionLogic(this.uipApp.data.options.adminURL,e),i.push(o);break;case"currentPageName":o=this.handleConditionLogic(this.uipApp.data.options.dynamicData.adminPageTitle.value,e),i.push(o);break;case"currentURL":o=this.handleConditionLogic(this.currentURL,e),i.push(o);break;case"locale":o=this.handleConditionLogic(this.uipApp.data.options.locale,e),i.push(o);break;case"pluginActive":const t=Object.values(this.uipApp.data.options.activePlugins).map(e=>e.split("/")[0]);o=this.handleConditionLogic(t,e,!0),i.push(o);break;case"notificationCount":console.log(this.uipApp.data.options.dynamicData),o=this.handleNumericalConditionLogic(this.uipApp.data.options.dynamicData.notificationCount.value,e,!0),i.push(o);break;case"darkMode":const a=this.uipApp.data.userPrefs.darkTheme?"true":"false";e.value=e.value?"true":"false",o=this.handleConditionLogic(a,e),i.push(o)}return"or"==a?i.includes("met"):!i.includes("not_met")}}};