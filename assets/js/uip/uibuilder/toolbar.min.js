const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm.js";import{validDateTemplate}from"../v3.5/utility/functions.min.js";export default{components:{templateHistory:defineAsyncComponent(()=>import("./history.min.js?ver=3.3.1"))},inject:["uiTemplate"],data(){return{templateID:this.$route.params.templateID,saving:!1,helpLoaded:!1,allUiTemplates:[],ui:{strings:{backToList:__("Back to template list","uipress-lite"),zoomIn:__("Zoom in","uipress-lite"),zoomOut:__("Zoom out","uipress-lite"),darkMode:__("Dark mode","uipress-lite"),preview:__("Preview","uipress-lite"),import:__("Import template","uipress-lite"),export:__("Export template","uipress-lite"),templateLibrary:__("Template Library","uipress-lite"),mobile:__("Mobile","uipress-lite"),desktop:__("Desktop","uipress-lite"),tablet:__("Tablet","uipress-lite"),saveTemplate:__("Save","uipress-lite"),help:__("Help","uipress-lite"),docs:__("Documentation and guides","uipress-lite"),draft:__("Draft","uipress-lite"),newTemplate:__("New template","uipress-lite"),recentTemplates:__("Recent templates","uipress-lite"),templateName:__("Template name","uipress-lite"),active:__("Active","uipress-lite"),draft:__("Draft","uipress-lite"),exitBuilder:__("Exit builder","uipress-lite"),patterns:__("Patterns","uipress-lite"),library:__("Library","uipress-lite"),siteSettings:__("Site settings","uipress-lite"),settings:__("Settings","uipress-lite"),templateSettings:__("Template settings","uipress-lite"),next:__("Next","uipress-lite"),previous:__("Previous","uipress-lite"),done:__("Done","uipress-lite"),close:__("Close","uipress-lite"),tips:__("Tips and updates","uipress-lite"),userInterface:__("User interface","uipress-lite"),adminPage:__("Admin Page","uipress-lite"),toolBar:__("Frontend toolbar","uipress-lite")}},previewOptions:[{value:"builder",label:__("Builder","uipress-lite")},{value:"preview",label:__("Preview","uipress-lite")}]}},watch:{"uipApp.data.templateDarkMode":{handler(e,i){const t=e?"dark":"light",n=document.querySelectorAll("iframe");n&&n.forEach(e=>{e.contentWindow.document.documentElement.setAttribute("data-theme",t)})},deep:!0},"uipApp.data.userPrefs.darkTheme":{handler(e,i){"prod"!==this.uiTemplate.display&&(this.uipApp.data.templateDarkMode=e)},deep:!0},"$route.params.templateID":{handler(){this.templateID=this.$route.params.templateID}}},beforeUnmount(){window.removeEventListener("keydown",this.handleCommandS)},mounted(){this.mountShortCuts()},computed:{returnSettingsLink(){return"/uibuilder/"+this.$route.params.templateID+"/settings/template"},returnLoadStyle(){if(this.saving)return"opacity:0;"}},methods:{mountShortCuts(){window.addEventListener("keydown",this.handleCommandS)},handleCommandS(e){83==e.keyCode&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.saveTemplate())},detectOperatingSystem(){const e=window.navigator.userAgent.toLowerCase();return e.includes("mac")||e.includes("ipad")||e.includes("iphone")?"Mac":"Windows"},async saveTemplate(){const e={globalSettings:JSON.parse(JSON.stringify(this.uiTemplate.globalSettings)),content:this.uiTemplate.content},i=JSON.stringify(e,(e,i)=>"true"===i?"uiptrue":!0===i?"uiptrue":"false"===i?"uipfalse":!1===i?"uipfalse":""===i?"uipblank":i);let t=new FormData;t.append("action","uip_save_ui_template"),t.append("security",uip_ajax.security),t.append("templateID",this.templateID),t.append("template",i);const n=await this.sendServerRequest(uip_ajax.ajax_url,t);return n.error?(this.uipApp.notifications.notify(__("Unable to save template","uipress-lite"),n.message,"","error",!0),this.saving=!1,!1):n.success?(await this.saveStylePresets(),this.uipApp.notifications.notify(__("Template saved","uipress-lite"),"","success",!0),this.unsavedChanges=!1,this.saving=!1,!0):void 0},async saveStylePresets(){const e=JSON.stringify(this.uipApp.data.options.block_preset_styles,(e,i)=>"true"===i?"uiptrue":!0===i?"uiptrue":"false"===i?"uipfalse":!1===i?"uipfalse":""===i?"uipblank":i);let i=new FormData;return i.append("action","uip_save_site_option"),i.append("security",uip_ajax.security),i.append("option",e),i.append("optionName","block_preset_styles"),await this.sendServerRequest(uip_ajax.ajax_url,i),!0},exportTemplate(){let e=JSON.stringify({uipLayout:this.uiTemplate.content}),i=this.uiTemplate.globalSettings.name,t=new Date,n=String(t.getDate()).padStart(2,"0"),p="uip-ui-template-"+i+"-"+(String(t.getMonth()+1).padStart(2,"0")+"-"+n+"-"+t.getFullYear())+".json",s="data:text/json;charset=utf-8,"+encodeURIComponent(e),u=this.$refs.templateexport;u.setAttribute("href",s),u.setAttribute("download",p),u.click();let a=__("Layout exported","uipress-lite");this.uipApp.notifications.notify(a,"","success",!0)},importTemplate(e){let i=this.uipApp.notifications.notify(__("Importing layout","uipress-lite"),"","default",!1,!0),t=e.target.files[0];if("application/json"!=t.type)return this.uipApp.notifications.notify(__("Templates must be in valid JSON format","uipress-lite"),"","error",!0,!1),void this.uipApp.notifications.remove(i);if(t.size>1e6)return this.uipApp.notifications.notify(__("Uploaded file is too big","uipress-lite"),"","error",!0,!1),void this.uipApp.notifications.remove(i);let n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=(e=>{let t,n=e.target.result;try{t=JSON.parse(n)}catch(e){return this.uipApp.notifications.notify(e,"","error",!0,!1),void this.uipApp.notifications.remove(i)}if(null!=t){if(!Array.isArray(t)&&!this.isObject(t))return this.uipApp.notifications.notify("Template is not valid","","error",!0,!1),void this.uipApp.notifications.remove(i);let e,n=__("Template imported","uipress-lite");if(Array.isArray(t))e=t;else{if(!("uipLayout"in t))return this.uipApp.notifications.notify(__("Template mismatch","uipress-lite"),"","error",!0,!1),void this.uipApp.notifications.remove(i);e=Array.isArray(t.uipLayout)?t.uipLayout:[t.uipLayout]}validDateTemplate(e,!0).then(t=>{t.includes(!1)?(this.uipApp.notifications.notify(__("File is not a valid JSON template","uipress-lite"),"","error",!0,!1),this.uipApp.notifications.remove(i)):(this.uiTemplate.content=e,this.uipApp.notifications.notify(n,"","success",!0,!1),this.uipApp.notifications.remove(i))})}else this.uipApp.notifications.notify(__("JSON parse failed","uipress-lite"),"","error",!0,!1),this.uipApp.notifications.remove(i)})},async createNewUI(){let e=new FormData;e.append("action","uip_create_new_ui_template"),e.append("security",uip_ajax.security),e.append("templateType","ui-template");const i=await this.sendServerRequest(uip_ajax.ajax_url,e);this.uipApp.notifications.notify(__("New template created","uipress-lite"),"","success",!0,!1),this.$router.push("/"),this.$router.push("/uibuilder/"+i.id+"/")}},template:'\n      \n      \x3c!--PREVIEW TOOLBAR --\x3e\n      <div id="uip-ui-preview-toolbar" class="uip-flex uip-padding-s uip-gap-xs uip-flex-center uip-flex-between uip-background-default uip-border-bottom uip-flex-wrap uip-position-relative" style="z-index:2">\n          <div class="uip-flex  uip-flex-center uip-app-frame">\n        \n            \n            \n            <div class="uip-flex uip-gap-s uip-flex-center">\n            \n              \n              \n              <dropdown pos="bottom left" ref="logomenu">\n                <template v-slot:trigger>\n                  <div class="uip-flex uip-gap-xs uip-flex-center uip-link-default uip-border-rounder uip-background-muted uip-padding-xs uip-padding-top-xxs uip-padding-bottom-xxs">\n                    <div class="uip-logo uip-w-18 uip-ratio-1-1"></div>\n                    <div class="uip-icon uip-text-l uip-text-muted">expand_more</div>\n                  </div>\n                </template>  \n                <template v-slot:content>\n                  <div class="uip-max-h-600 uip-overflow-auto uip-flex uip-flex-column">\n                  \n                    \n                    <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxxs">\n                    \n                      <router-link to="/" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.backToList}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">chevron_left</div>\n                      </router-link>\n                      \n                      <router-link @click="$refs.logomenu.close()"\n                      to="/site-settings" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.siteSettings}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">tune</div>\n                        \n                      </router-link>\n                      \n                      \n                      <div class="uip-border-top uip-margin-top-xxs uip-margin-bottom-xxs"></div>\n                    \n                    \n                      <a @click="createNewUI();$refs.logomenu.close()" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.newTemplate}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">add</div>\n                        \n                      </a>\n                      \n                      <router-link @click="$refs.logomenu.close()"\n                      :to="returnSettingsLink" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.templateSettings}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">settings</div>\n                        \n                      </router-link>\n                      \n                      <label class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.import}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">file_upload</div>\n                        <input hidden accept=".json" type="file" single="" id="uip-import-layout" @change="importTemplate($event, \'template\')">\n                        \n                      </label>\n                      \n                      <a @click="exportTemplate(\'template\');$refs.logomenu.close()" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.export}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">file_download</div>\n                        <a ref="templateexport" href="" style="display:none;"></a>\n                        \n                      </a>\n                      \n                      \n                      \n                    \n                      <div class="uip-border-top uip-margin-top-xxs uip-margin-bottom-xxs"></div>\n                  \n                      <a @click="$refs.logomenu.close()" class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted" href="https://uipress.co/docs/#/" target="_BLANK">\n                        \n                        <div class="uip-flex-grow">{{ui.strings.docs}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">open_in_new</div>\n                      </a>\n                      \n                      \n                      <div @click="uipApp.tipsAndTricks.show();$refs.logomenu.close()" \n                      class="uip-link-default uip-no-underline uip-flex uip-flex-center uip-gap-m uip-padding-xxs uip-border-round hover:uip-background-muted" >\n                        \n                        <div class="uip-flex-grow">{{ui.strings.tips}}</div>\n                        <div class="uip-icon uip-text-l uip-text-muted">tips_and_updates</div>\n                      </div>\n                    \n                    </div>\n                    \n                  </div>\n                </template>\n              </dropdown>  \n              \n              \n              \x3c!-- History --\x3e\n              <templateHistory/>\n              \n              \n              \n            \n            \n            \n            </div>\n            \n              \n            \n        \n          </div>\n          \n          \x3c!--Middle actions --\x3e\n          <div class="uip-flex uip-gap-xxs uip-flex-center">\n          \n            <div class="uip-flex uip-flex-center uip-gap-s">\n              \n              <span class="uip-text-bold uip-blank-input uip-text-right" contenteditable @input="function(event){uiTemplate.globalSettings.name = event.target.innerText}">\n                {{uiTemplate.globalSettings.name}}\n              </span>\n              \n              <router-link :to="returnSettingsLink" v-if="uiTemplate.globalSettings.status" \n              class="uip-border-rounder uip-background-green-wash uip-padding-xxs uip-no-underline uip-link-default">{{ui.strings.active}}</router-link>\n              \n              <router-link :to="returnSettingsLink" v-if="!uiTemplate.globalSettings.status" \n              class="uip-border-rounder uip-background-orange-wash uip-padding-xxs uip-no-underline uip-link-default">{{ui.strings.draft}}</router-link>\n            \n              <select class="uip-input uip-input-small uip-border-rounder" v-model="uiTemplate.globalSettings.type">\n                <option value="ui-template">{{ui.strings.userInterface}}</option>\n                <option value="ui-admin-page">{{ui.strings.adminPage}}</option>\n                <option value="ui-front-template">{{ui.strings.toolBar}}</option>\n              </select>\n              \n            </div>\n            \n            \n          </div>\n          \n          <div class="uip-flex uip-gap-xs">\n            \n            <div @click="uiTemplate.isPreview = !uiTemplate.isPreview;uipApp.blockSettings.close()" :title="ui.strings.preview" class="uip-border-rounder uip-flex uip-gap-xxs uip-flex-center uip-padding-xxs"\n            :class="uiTemplate.isPreview ? \'uip-button-primary uip-text-inverse\' : \'uip-button-default\'">\n              <div class="uip-icon uip-text-xl">play_arrow</div>\n            </div>\n            \n            <router-link :to="returnSettingsLink" class="uip-button-default uip-no-underline uip-flex uip-gap-xxs uip-flex-center uip-text-s">\n              <div class="uip-icon uip-text-l">settings</div>\n              <div class="">{{ui.strings.settings}}</div>\n            </router-link>\n            \n          \n            <button @click="saveTemplate()" class="uip-button-primary uip-flex uip-flex-center uip-flex-middle uip-position-relative uip-text-s" type="button">\n              <span :style="returnLoadStyle" class="uip-flex uip-flex-center uip-flex-middle uip-gap-xs">\n                <span>{{ui.strings.saveTemplate}}</span>\n                <span class="uip-padding-left-xxxs uip-padding-right-xxxs uip-border uip-border-round uip-text-s uip-flex uip-flex-center uip-flex-row" data-theme="dark">\n                  <span class="uip-command-icon uip-text-muted"></span>\n                  <span class="uip-text-muted">S</span>\n                </span>\n              </span>\n              <div class="uip-position-absolute uip-left-0 uip-right-0" v-if="saving">\n                <span class="uip-load-spinner" ></span>\n              </div>\n            </button>\n            \n          </div>\n          \n      </div>\n      \n      \n      \n      \n        '};