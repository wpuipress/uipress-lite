const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm-dev.js";export default{components:{contextmenu:defineAsyncComponent(()=>import("../v3.5/utility/contextmenu.min.js?ver=3.2.12")),Confirm:defineAsyncComponent(()=>import("../v3.5/utility/confirm.min.js?ver=3.2.12"))},data:()=>({templates:[],page:1,totalPages:0,totalFound:0,loading:!1,initialLoading:!0,selectAll:!1,showWelcome:!0,search:"",strings:{templates:__("Templates","uipress-lite"),status:__("Status","uipress-lite"),name:__("Name","uipress-lite"),type:__("Type","uipress-lite"),active:__("Active","uipress-lite"),draft:__("Draft","uipress-lite"),results:__("results","uipress-lite"),searchUsersRoles:__("Search users and roles","uipress-lite"),searchTemplates:__("Search templates and settings","uipress-lite"),templateDuplicated:__("Template duplicated","uipress-lite"),deleteSelected:__("Delete selected","uipress-lite"),uiBuilder:__("uiBuilder","uipress-lite"),newTemplate:__("New template","uipress-lite"),viewDocs:__("View docs","uipress-lite"),settings:__("Site settings","uipress-lite"),phpErrorLog:__("PHP error log","uipress-lite"),setupWizard:__("Setup wizard","uipress-lite"),globalExport:__("Global export","uipress-lite"),templateType:__("New template","uipress-lite"),edit:__("Edit","uipress-lite"),duplicate:__("Duplicate","uipress-lite"),globalImport:__("Global import","uipress-lite"),siteSync:__("Remote sync","uipress-lite"),new:__("New","uipress-lite"),appliesTo:__("Applies to","uipress-lite"),delete:__("Delete","uuipress-lite"),documentation:__("Documentation","uipress-lite"),siteSettings:__("Site settings","uipress-lite")},activeFilter:"all",tabletabs:[{name:"all",label:__("All templates","uipress-lite")},{name:"ui-template",label:__("UI Templates","uipress-lite")},{name:"ui-admin-page",label:__("Admin pages","uipress-lite")},{name:"ui-front-template",label:__("Frontend toolbars","uipress-lite")}],activeSwitchOptions:{draft:{value:"draft",label:__("Draft","uipress-lite")},publish:{value:"publish",label:__("Active","uipress-lite")}}}),mounted(){this.getTemplates(),this.enqueueAdminBarStyles(),this.uipApp.data.userPrefs.supressWelcome&&(this.showWelcome=!1),window.parent&&window.parent.postMessage({eventName:"uip_exit_fullscreen"},"*")},watch:{search:{handler(e,i){this.page=1,this.getTemplates()},deep:!0},selectAll:{handler(e,i){this.selectAllItems(e)},deep:!0},activeTableTab:{handler(e,i){this.getTemplates()}}},computed:{returnTableData(){const e=this.templates;return"all"==this.activeFilter?e:e.filter(e=>e.actualType==this.activeFilter)},returnPage(){return this.page}},methods:{enqueueAdminBarStyles(){let e=document.querySelector('link[href*="load-styles.php?"]');if(!e)return;if(e.href.includes("admin-bar,"))return;const i=e.href.replace("admin-menu,","admin-menu,admin-bar,"),t=document.createElement("link");t.href=i,t.setAttribute("rel","stylesheet");const n=()=>{e.remove(),t.removeEventListener("load",n)},s=document.head;s.firstChild?s.insertBefore(t,s.firstChild):s.appendChild(t),t.addEventListener("load",n)},async getTemplates(){if(1==this.loading)return;this.loading=!0;let e=new FormData;e.append("action","uip_get_ui_templates"),e.append("security",uip_ajax.security),e.append("page",this.returnPage),e.append("search",this.search),e.append("filter",this.activeTableTab);const i=await this.sendServerRequest(uip_ajax.ajax_url,e);i&&(this.templates=i.templates,this.totalPages=i.totalPages,this.totalFound=i.totalFound,this.loading=!1,this.initialLoading=!1)},async duplicateTemplate(e){let i=new FormData;i.append("action","uip_duplicate_ui_template"),i.append("security",uip_ajax.security),i.append("id",e);const t=await this.sendServerRequest(uip_ajax.ajax_url,i);t.error?this.uipApp.notifications.notify(t.message,"","error",!0):(this.uipApp.notifications.notify(this.strings.templateDuplicated,"","success",!0),this.getTemplates())},async deleteTemplate(e){let i=new FormData;i.append("action","uip_delete_ui_template"),i.append("security",uip_ajax.security),i.append("templateids",e);const t=await this.sendServerRequest(uip_ajax.ajax_url,i);if(t.error)return void this.uipApp.notifications.notify(t.message,"","error",!0);this.uipApp.notifications.notify(t.message,"","success",!0);const n=this.templates.findIndex(i=>i.id===e);-1!==n&&this.templates.splice(n,1)},async createNewUI(e){let i=new FormData;i.append("action","uip_create_new_ui_template"),i.append("security",uip_ajax.security),i.append("templateType",e);const t=await this.sendServerRequest(uip_ajax.ajax_url,i);t&&this.$router.push("/uibuilder/"+t.id+"/")},async confirmDelete(e){await this.$refs.confirm.show({title:__("Delete template","uipress-lite"),message:__("Deleted templates can't be recovered","uipress-lite"),okButton:__("Delete","uipress-lite")})&&this.deleteTemplate(e)},async confirmDeleteMultiple(e){await this.$refs.confirm.show({title:__("Delete multiple template","uipress-lite"),message:__("Deleted templates can't be recovered","uipress-lite"),okButton:__("Delete","uipress-lite")})&&this.deleteTemplate(e)},async updateTemplate(e){let i=new FormData;i.append("action","uip_update_ui_template_status"),i.append("security",uip_ajax.security),i.append("templateid",e.id),i.append("status",e.status),i.append("templatefor",JSON.stringify(e.for));const t=await this.sendServerRequest(uip_ajax.ajax_url,i);t.error?this.uipApp.notifications.notify(t.message,"","error",!0):this.uipApp.notifications.notify(t.message,"","success",!0)},returnActiveIndicatorStyle(e){let i="border:1px solid var(--uip-color-green)";return"draft"==e&&(i="border:1px solid var(--uip-color-orange)"),i},loadTemplate(e){this.$router.push("/uibuilder/"+e+"/")},handleRoleChange(e,i){JSON.stringify(e.for)!=JSON.stringify(i)&&(e.for=i,this.updateTemplate(e))},returnRoleClone:e=>e?[...e]:[]},template:'\n  \n  \n  \n  <div v-if="1==2 && showWelcome" class="uip-margin-bottom-m uip-padding-s uip-border-rounder uip-background-orange-wash">\n    \n    <div class="uip-text-bold uip-margin-bottom-s uip-flex uip-flex-between">\n      <div>{{strings.welcomeTov32}}</div>\n      <div @click="showWelcome = false;saveUserPreference(\'supressWelcome\', true, false);"\n      class="uip-padding-xxs uip-border-rounder hover:uip-background-grey uip-cursor-pointer"><span class="uip-icon">close</span></div>\n    </div>\n    \n    <div class="uip-text-muted uip-margin-bottom-s">\n      <p>This update brings a refinded builder experience with plenty of new features, performance improvements and an improved user interface. </p>\n      \n      <p>If you have just updated from an earlier version we suggest clearing browser cache before entering the builder. If you are new to uiPress then you can check out our brand new, in depth documentation below.</p>\n    </div>\n    \n    <div class="uip-flex">\n      <a href="https://uipress.co/docs/#/"\n      target="_BLANK" class="uip-link-default uip-no-underline uip-flex uip-flex-row uip-gap-xxs uip-flex-center">\n        <span class="uip-text-bold">{{strings.viewDocs}}</span>\n        <span class="uip-icon">arrow_forward</span>\n      </a>\n    </div>\n  </div>\n  \n  <div class="uip-flex uip-flex-column uip-h-100p uip-w-100p uip-background-muted" style="min-height:100dvh">\n  \n    \x3c!-- Toolbar --\x3e\n    <div class="uip-padding-s uip-background-default uip-border-bottom uip-border-bottom uip-flex uip-flex-between">\n    \n      \x3c!-- Logo --\x3e\n      <dropdown pos="bottom left" ref="logodrop">\n        <template #trigger>\n          <div class="uip-flex uip-gap-xs uip-flex-center uip-link-default uip-border-rounder uip-background-muted uip-padding-xs uip-padding-top-xxs uip-padding-bottom-xxs">\n            <div class="uip-logo uip-w-18 uip-ratio-1-1"></div>\n            <div class="uip-icon uip-text-l uip-text-muted">expand_more</div>\n          </div>\n        </template>\n        \n        <template #content>\n        \n          <div class="uip-padding-xs uip-flex uip-flex-column uip-text-weight-normal uip-text-s">\n          \n              \n            <router-link to="/site-settings/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.siteSettings}}</span>\n              <span class="uip-icon">tune</span>\n            </router-link>  \n          \n            <router-link to="/setupWizard/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.setupWizard}}</span>\n              <span class="uip-icon">magic_button</span>\n            </router-link>\n            \n            <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n            \n            <a href="https://uipress.co/docs/" target="_BLANK"\n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.documentation}}</span>\n              <span class="uip-icon">import_contacts</span>\n            </a>\n            \n            <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n            \n            <router-link to="/globalexport/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.globalExport}}</span>\n              <span class="uip-icon">file_download</span>\n            </router-link>\n            \n            <router-link to="/globalimport/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.globalImport}}</span>\n              <span class="uip-icon">file_upload</span>\n            </router-link>\n            \n            <router-link to="/sitesync/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.siteSync}}</span>\n              <span class="uip-icon">sync</span>\n            </router-link>\n            \n            <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n            \n            <router-link to="/errorlog/" \n            @click="$refs.logodrop.close()"\n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.phpErrorLog}}</span>\n              <span class="uip-icon">code</span>\n            </router-link>\n            \n            \n            \n            \n            \n            \n            \n          </div>\n        \n        </template>\n      </dropdown>  \n      \n      \x3c!-- Global search --\x3e\n      <div class="uip-flex uip-background-muted uip-border-rounder uip-padding-xxs uip-flex-center uip-w-240">\n        <span class="uip-icon uip-text-muted uip-margin-right-xs">search</span>\n        <input class="uip-blank-input uip-flex-grow uip-text-s" type="search" v-model="search" :placeholder="strings.searchTemplates" autofocus="">\n      </div>\n      \n      \x3c!-- Right actions --\x3e\n      <div class="uip-flex uip-gap-xs uip-flex-center">\n      \n        \x3c!-- Site settings --\x3e\n        <router-link to="/site-settings/" class="uip-button-default uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-no-underline uip-text-s">\n          <span>{{strings.settings}}</span>\n        </router-link>\n        \n        \x3c!-- New template --\x3e\n        <div class="uip-button-primary uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-text-s" @click="createNewUI(\'ui-template\')">\n          <span>{{strings.newTemplate}}</span>\n        </div>\n      \n      </div>\n      \n    </div>\n    \x3c!-- End Toolbar--\x3e\n    \n    \x3c!-- Body--\x3e\n    <div class="uip-flex uip-flex-column uip-flex-center uip-padding-l">\n      \n      \x3c!-- Inner body --\x3e\n      <div class="uip-flex uip-flex-column uip-row-gap-m uip-w-1000 uip-max-w-100p">\n      \n        \x3c!-- Heading --\x3e\n        <div class="uip-text-bold uip-text-xl uip-text-emphasis">{{ strings.templates }}</div>\n        \n        \x3c!-- Filters --\x3e\n        <div class="uip-flex uip-flex-wrap uip-gap-xs">\n        \n          <template v-for="(type, index) in tabletabs">\n          \n            <div class="uip-padding-s uip-padding-top-xs uip-padding-bottom-xs uip-border-rounder uip-transition-all"\n            @click="activeFilter = type.name"\n            :class="activeFilter === type.name ? \'uip-text-inverse uip-background-primary\' : \'uip-border uip-background-default hover:uip-background-grey uip-link-muted\'">\n              {{type.label}}\n            </div>\n          \n          </template>\n        \n        </div>\n        \n        <component is="style">\n          .list-move, /* apply transition to moving elements */\n          .list-enter-active,\n          .list-leave-active {\n            transition: all 0.5s ease;\n          }\n          \n          .list-enter-from,\n          .list-leave-to {\n            opacity: 0;\n            transform: translateX(30px);\n          }\n          \n          /* ensure leaving items are taken out of layout flow so that moving\n             animations can be calculated correctly. */\n          .list-leave-active {\n            position: absolute;\n          }\n          \n          tr:hover {\n           box-shadow: var(--uip-box-shadow);\n          }\n          \n          tr:hover td:first-child{\n            border-radius:8px 0 0 8px;\n          }\n          tr:hover td:last-child{\n            border-radius:0 8px 8px 0;\n          }\n          .uip-template-table tr:first-child td:first-child {border-radius: 8px 0 0 0;}\n          .uip-template-table tr:first-child td:last-child {border-radius: 0 8px 0 0;}\n          .uip-template-table tr:last-child td:first-child {border-radius: 0 0 0 8px;}\n          .uip-template-table tr:last-child td:last-child {border-radius: 0 0 8px 0;}\n          .uip-template-table tr:last-child td {border: none !important;}\n        </component>\n        \n        \x3c!-- Table --\x3e\n        <TransitionGroup name="list" tag="table" class="uip-background-transparent uip-template-table" style="border-collapse: collapse;\n        border-spacing: 0;">\n        \n          <template v-for="(template, index) in returnTableData" :key="template.id">\n            \n          \n            <tr class="uip-link-default uip-border-rounder" @click="loadTemplate(template.id)"\n            @contextmenu.prevent.stop="$refs[\'templatemenu-\'+index][0].show($event)">\n              \x3c!-- Template Title --\x3e\n              <td class="uip-border-bottom uip-padding-s uip-background-default">\n                <div class="uip-flex uip-flex-column uip-gap-xxs">\n                  \n                  <div class="uip-flex uip-gap-xs uip-flex-center">\n                  \n                    <div class="uip-text-bold">{{ template.name }}</div>\n                    \n                    <div class="uip-w-9 uip-ratio-1-1 uip-border-circle uip-opacity-70"\n                    :class="template.status == \'publish\' ? \'uip-background-green\' : \'uip-background-orange\'" \n                    style="returnActiveIndicatorStyle(template.status)"></div>\n                    \n                  </div>\n                  \n                  \n                  <div class="uip-text-muted uip-text-s">{{ template.modified }}</div>\n                  \n                </div>\n              </td>\n              \n              \x3c!-- Template type --\x3e\n              <td class="uip-border-bottom uip-padding-s uip-max-w-160 uip-background-default">\n                <div class="uip-background-primary-wash uip-text-accent uip-padding-xxxs uip-border-round uip-text-s uip-border uip-display-inline">{{ template.type }}</div>\n              </td>\n              \n              \x3c!-- Active state --\x3e\n              <td class="uip-border-bottom uip-padding-s uip-max-w-100 uip-background-default">\n                \n                <switch-select :args="{asText:true, small:true, options: activeSwitchOptions}" \n                @click.stop\n                :value="template.status" \n                :returnData="(d)=>{template.status=d;updateTemplate(template)}"/>\n                \n              </td>\n              \n              \n              \n              \x3c!-- Applies to --\x3e\n              <td class="uip-border-bottom uip-padding-s uip-max-w-160 uip-background-default">\n                \n                <user-role-select :selected="returnRoleClone(template.for)"\n                @click.stop\n                :placeHolder="strings.appliesTo"\n                :searchPlaceHolder="strings.searchUsersRoles"\n                :updateSelected="(d)=>{handleRoleChange(template, d)}"/>\n                \n              </td>\n              \n              \n              \n              \x3c!-- Dropdown --\x3e\n              <td class="uip-border-bottom uip-padding-s uip-text-right uip-background-default">\n                \n                <a @click.prevent.stop="$refs[\'templatemenu-\'+index][0].show($event)"\n                class="uip-link-muted hover:uip-background-muted uip-border-rounder uip-padding-xxs uip-inline-flex uip-flex-centers uip-text-l">\n                  <span class="uip-icon">more_vert</span>\n                </a>\n                \n              </td>\n              \n            </tr>\n          \n          </template>\n        </TransitionGroup>\n        \x3c!-- End table --\x3e\n        \n        <template v-for="(template, index) in returnTableData" :key="template.id">\n          <contextmenu :ref="\'templatemenu-\'+index">\n          \n            <div class="uip-padding-xs uip-flex uip-flex-column uip-text-weight-normal uip-text-s">\n            \n              <router-link :to="\'/uibuilder/\' + template.id + \'/\'" \n              class="uip-link-muted uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n                <span class="">{{strings.edit}}</span>\n                <span class="uip-icon">edit</span>\n              </router-link>\n            \n              <a class="uip-link-muted uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder"\n              @click.prevent="duplicateTemplate(template.id)">\n                <span class="">{{strings.duplicate}}</span>\n                <span class="uip-icon">content_copy</span>\n              </a>\n              \n              <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n              \n              <a class="uip-link-danger uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder"\n              @click.prevent="confirmDelete(template.id)">\n                <span class="">{{strings.delete}}</span>\n                <span class="uip-icon">delete</span>\n              </a>\n            \n            </div>\n          \n          </contextmenu>\n        </template>\n        \n      </div>\n      \x3c!-- End inner body--\x3e\n      \n    </div>\n    \x3c!-- End body--\x3e\n    \n    \x3c!-- Child routes --\x3e\n    <router-view :key="$route.path"/>\n    \n    <Confirm ref="confirm"/>\n  \n  </div>\n  \n    \n    \n  '};