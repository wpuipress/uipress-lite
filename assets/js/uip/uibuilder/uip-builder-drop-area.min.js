import{nextTick}from"../../libs/vue-esm-dev.js";export function moduleData(){return{props:{content:Array,returnData:Function,layout:String,dropAreaStyle:String,contextualData:Object},data:function(){return{items:this.content,footerhideen:!1,rendered:!1,activeTab:"blocks",windowWidth:window.innerWidth,drag:!1,queries:{},randomClass:this.uipress.createUID(),strings:{doesntExist:__("This component is missing or can't be loaded","uipress-lite"),totalItems:__("Total items","uipress-lite"),search:__("Search","uipress-lite"),proOptionUnlock:__("This is a pro option. Upgrade to unlock","uipress-lite")},switchOptions:{blocks:{value:"blocks",label:__("Blocks","uipress-lite")},patterns:{value:"patterns",label:__("Patterns","uipress-lite")}}}},inject:["uipData","uiTemplate","router","uipress"],watch:{content:{handler(e,t){this.rendered&&(this.items=e)},deep:!0},queriesLength:{handler(e,t){for(let e in this.queries){let t=this.items.find(t=>t.uid===e);t&&this.runBlockQuery(t)}},deep:!0},itemsLength:{handler(e,t){for(let[e,t]of this.items.entries())void 0!==t&&("remote"in t&&t.remote?(this.importBlock(t,e),this.items.splice(e,1)):0===Object.keys(t.settings).length&&this.uipress.inject_block_presets(t,t.settings))},deep:!0},"uiTemplate.isPreview":{handler(e,t){for(let e in this.queries){let t=this.items.find(t=>t.uid===e);t&&this.runBlockQuery(t)}},deep:!0}},created:function(){},mounted:function(){let e=this;requestAnimationFrame(()=>{e.rendered=!0})},computed:{queriesLength(){return Object.keys(this.queries).length},returnAllBlocks(){return this.items},itemsLength(){return this.items.length},returnAllQueries(){return this.queries},returnItems(){return this.items},returnActiveBlockUID(){return this.uipress.checkNestedValue(this.$route,["params","uid"])}},methods:{async forceReload(){this.rendered=!1,await nextTick(),this.rendered=!0},importBlock(e,t){let i=this,n=new FormData,s=i.uipress.notify(__("Importing template","uipress-lite"),"","default",!1,!0);i.uipress.callServer(e.path,n).then(e=>{e.error&&(i.uipress.notify(e.message,"","error",!0),i.uipress.destroy_notification(s));let n=JSON.parse(e);if(Array.isArray(n)){(n=n[0]).uid=i.uipress.createUID(),i.uipress.isObject(n)||(i.uipress.notify(__("Unable to import template right now","uipress-lite"),"","error",!0),i.uipress.destroy_notification(s));let e=[];if("content"in n){for(const t of n.content)e.push(i.cleanBlock(t));n.content=e}i.uipress.destroy_notification(s),i.uipress.notify(__("Template imported","uipress-lite"),"","success",!0),i.items.splice(t,0,n)}else i.uipress.notify(__("Unable to import template right now","uipress-lite"),"","error",!0),i.uipress.destroy_notification(s)})},cleanBlock(e){let t=Object.assign({},e);return t.options=[],t.settings=JSON.parse(JSON.stringify(t.settings)),t.content&&(t.content=this.duplicateChildren(t.content)),t},duplicateChildren(e){let t=[];for(let i of e){let e=Object.assign({},i);e.settings=JSON.parse(JSON.stringify(e.settings)),e.content&&(e.content=this.duplicateChildren(e.content)),t.push(e)}return t},async itemAdded(e){if(e.added){if(this.uipress.checkNestedValue(e,["added","element","remote"]))return;let t=e.added.element;"uid"in t||(t.uid=this.uipress.createUID()),0===Object.keys(t.settings).length&&this.uipress.inject_block_presets(t,t.settings),await this.forceReload(),this.uipApp.blockControl.setActive(t,this.items),this.returnData(this.items)}else await this.forceReload()},returnDragStyle(){if(this.uiTemplate.drag)return"border-color:var(--uip-background-primary);"},componentExists(e){return!!this.$root._.appContext.components[e.moduleName]},returnBlockStyles(e,t){if(!this.rendered)return"";let i="";return i=(i+=this.uipress.render_block_styles(this.formatDynamicMatches(e),e.uid,this.uipData.templateDarkMode,this.windowWidth)).replace("#"+e.uid,"."+this.randomClass+" #"+e.uid)},returnQueryStyles(e,t){if(!this.rendered)return"";let i="";return i=(i+=this.uipress.render_block_styles(e,e.uid,this.uipData.templateDarkMode,this.windowWidth)).replace("#"+e.uid,".uip-query-id-"+t+"#"+e.uid)},ifBlockHasCss:e=>!!(e.settings.advanced&&e.settings.advanced.options.css&&e.settings.advanced.options.css.value)&&e.settings.advanced.options.css.value,ifBlockHasJS:e=>!!(e.settings.advanced&&e.settings.advanced.options.js&&e.settings.advanced.options.js.value)&&e.settings.advanced.options.js.value,responsiveHidden(e){if(void 0===e)return!0;if(!e)return!0;let t=window.innerWidth;return"windowWidth"in this.uiTemplate&&(t=this.uiTemplate.windowWidth),!(1==e.mobile&&t<699)&&(!(1==e.tablet&&t<990&&t>=699)&&!(1==e.desktop&&t>990))},addHoverLogic(e,t){if(this.uiTemplate.isPreview)return;document.querySelectorAll("#uip-ui-preview-area .uip-hover-selected-block").forEach(function(e){e.classList.remove("uip-hover-selected-block")});let i=e.target.closest("[block-uid]");i&&i.classList.add("uip-hover-selected-block"),i.style.cursor="pointer"},removeHoverLogic(e,t){let i=e.target.closest("[block-uid]");i&&(i.classList.remove("uip-hover-selected-block"),i.style.cursor="default")},blockHasQuery(e){return!!this.uipress.checkNestedValue(e,["query","enabled"])&&(this.uipress.checkNestedValue(this.queries,[e.uid,"posts"])?(JSON.stringify(e.query)!=JSON.stringify(this.queries[e.uid].query)&&(this.queries[e.uid].query=JSON.parse(JSON.stringify(e.query)),this.runBlockQuery(e)),!0):(this.queries[e.uid]={currentPage:1,posts:[],totalPages:0,totalFound:0,dynamicMatches:{},query:JSON.parse(JSON.stringify(e.query))},!0))},blockPaginationEnabled(e){return!!this.uipress.checkNestedValue(e,["query","settings","showPagination"])},blockSearchEnabled(e){return!!this.uipress.checkNestedValue(e,["query","settings","search"])},runBlockQuery(e){let t=this,i=JSON.stringify(e.query.settings),n=JSON.stringify(e),s=1;this.returnPostQueryCurrentPage(e.uid)&&(s=this.returnPostQueryCurrentPage(e.uid));let r=this.returnQuerySearch(e.uid),o=new FormData;o.append("action","uip_process_block_query"),o.append("security",uip_ajax.security),o.append("query",i),o.append("blockString",n),o.append("page",s),o.append("search",r),t.uipress.callServer(uip_ajax.ajax_url,o).then(i=>{if(i.error)return t.uipress.notify(i.message,"uipress-lite","","error",!0),t.saving=!1,!1;i.success&&(this.queries[e.uid].posts=i.items.list,this.queries[e.uid].totalFound=i.items.found,this.queries[e.uid].dynamicMatches=i.items.matches,this.queries[e.uid].totalPages=i.items.totalPages,this.queries[e.uid].currentPage=s)})},returnPostQuery(e){let t=this.uipress.checkNestedValue(this.queries,[e,"posts"]);return t||[]},returnPostQueryCount(e){let t=this.uipress.checkNestedValue(this.returnAllQueries,[e,"totalFound"]);return t||0},returnPostQueryPageCount(e){let t=this.uipress.checkNestedValue(this.returnAllQueries,[e,"totalPages"]);return t||0},returnPostQueryCurrentPage(e){let t=this.uipress.checkNestedValue(this.returnAllQueries,[e,"currentPage"]);return t||0},returnQuerySearch(e){let t=this.uipress.checkNestedValue(this.returnAllQueries,[e,"search"]);return t||""},formatQueryDynamicMatches(e,t){let i=JSON.stringify(this.formatDynamicMatches(e));if(t in this.queries[e.uid].dynamicMatches)for(let n of this.queries[e.uid].dynamicMatches[t]){let e=n.replace;if("{{post_content}}"==n.match){e=(e=JSON.stringify({html:"uip_remove_this"+n.replace+"uip_remove_this"})).split("uip_remove_this")[1]}let t=i.replace(n.match,e);try{JSON.parse(t),i=t}catch(e){console.log(e);continue}}try{return JSON.parse(i)}catch(t){return console.log(t),e}},formatDynamicMatches(e){if(!this.uiTemplate.isPreview)return e;let t=JSON.stringify(e);const i=t.matchAll(/{{(.*?)}}/g),n=Array.from(i);if(!Array.isArray(n))return e;for(let[e,i]of n.entries()){const e=i[0],n=i[1];n in this.uipData.dynamicOptions&&(t=t.replace(e,this.uipData.dynamicOptions[n].value))}return JSON.parse(t)},pageNext(e){this.queries[e.uid].currentPage>=this.returnPostQueryPageCount(e.uid)||(this.queries[e.uid].currentPage+=1,this.runBlockQuery(e))},pagePrevious(e){this.queries[e.uid].currentPage<=1||(this.queries[e.uid].currentPage-=1,this.runBlockQuery(e))},getComponentInstance(e){return this.$refs[`dynamicComponentRef_${e}`]},returnRefName:e=>`dynamicComponentRef_${e}`,maybeAddHover(e){document.querySelectorAll(".uip-drop-zone").forEach(function(t){e.target.contains(t)||t.classList.remove("uip-drop-zone")});let t=e.toElement.closest(".uip-builder-drop-area");t&&t.classList.add("uip-drop-zone")},removeDragClass(e){e.target.classList.remove("uip-drop-zone")},getBlockClasses(e,t){let i="";return i+=this.uipress.get_block_option(e,"advanced","classes"),e.uid!==this.returnActiveBlockUID||t||(i+=" uip-preview-selected-block"),i},maybeFollowLink(e,t){if(!this.uiTemplate.isPreview)return t;let i=this.uipress.checkNestedValue(t,["linkTo","value"]),n=this.uipress.checkNestedValue(t,["linkTo","newTab"]);if(i&&""!=i)if("dynamic"==n&&this.uipress.updatePage(i),e.ctrlKey||e.shiftKey||e.metaKey||e.button&&1==e.button||"newTab"==n){this.$refs.blocklink.target="","newTab"==n&&(this.$refs.blocklink.target="_BLANK"),this.$refs.blocklink.href=i;let t=new MouseEvent("click",e);this.$refs.blocklink.dispatchEvent(t)}else"default"==n&&this.uiTemplate.isPreview&&(this.$refs.blocklink.target="",this.$refs.blocklink.href=i,this.$refs.blocklink.click())},returnToolTip(e){let t=this.uipress.checkNestedValue(e,["tooltip","message"]);return t||""}},template:'\n    \n      \n      \n                 \n      <uip-draggable \n      v-if="rendered"\n      :class="[{\'uip-border-dashed\' : uiTemplate.display == \'builder\'}, randomClass]" \n      class="uip-flex uip-w-100p uip-builder-drop-area"\n      :group="{ name: \'uip-blocks\', pull: true, put: true }" \n      :list="items"\n      @change="itemAdded"\n      ref="dropzone"\n      ghostClass="uip-canvas-ghost"\n      animation="300"\n      :sort="true">\n              \n              <template v-for="(element, index) in returnItems" \n              :key="element.uid" :index="index">\n              \n                <template v-if="index == 0">\n                  <a ref="blocklink" href="" class="uip-hidden"></a>\n                </template>\n                \n                \x3c!--Block does exist--\x3e\n                <component v-if="componentExists(element) && ifBlockHasCss(element)" is="style">{{ifBlockHasCss(element)}}</component>\n                <component v-if="componentExists(element) && ifBlockHasJS(element)" is="script">{{ifBlockHasJS(element)}}</component>\n                  \n                <component is="style" v-cloak scoped>\n                  {{returnBlockStyles(element, index)}}\n                </component>\n                \n                <component\n                v-if="componentExists(element) && responsiveHidden(element.responsive) && !blockHasQuery(element)" \n                :class="getBlockClasses(element)"\n                :id="element.uid"\n                :modulename="element.moduleName" \n                :is="element.moduleName"\n                :block-uid="element.uid"\n                :index="index" \n                :contextualData="contextualData" \n                :name="element.name"\n                :block="formatDynamicMatches(element)" \n                :title="returnToolTip(element)"\n                @click.prevent.stop="uipApp.blockControl.setActive( element, items, $event)"\n                @mouseenter.prevent.stop="uipApp.blockControl.setHover($event, element)"\n                @mouseleave.prevent.stop="uipApp.blockControl.removeHover($event, element)"\n                @contextmenu.prevent.stop="uipApp.blockcontextmenu.show({event: $event, list: items, index: index, block: element})"\n                />\n                \n                \n                \n                \n                \x3c!--Block query--\x3e\n                <template v-else-if="responsiveHidden(element.responsive) && componentExists(element) && blockHasQuery(element)" :key="index">\n                \n                  \x3c!--Search --\x3e\n                  <div class="uip-flex uip-search-block uip-border-round uip-query-search uip-w-100p" v-if="blockSearchEnabled(element)">\n                    <span class="uip-icon uip-text-muted uip-margin-right-xs uip-text-l uip-icon uip-icon-medium">search</span>\n                    <input @input="runBlockQuery(element)"\n                    class="uip-blank-input uip-flex-grow uip-text-s" type="search" :placeholder="strings.search" v-model="queries[element.uid].search" autofocus="">\n                  </div>\n                  \n                    \n                  \n                  <component\n                  :class="getBlockClasses(element)"\n                  :id="element.uid"\n                  :modulename="element.moduleName" \n                  :is="element.moduleName"\n                  :block-uid="element.uid"\n                  :index="index" \n                  :contextualData="contextualData" \n                  :name="element.name"\n                  :block="element" \n                  :title="returnToolTip(element)"\n                  v-if="!uiTemplate.isPreview"\n                  @mouseover="addHoverLogic($event, element.uid)"\n                  @mouseleave="removeHoverLogic($event, element.uid)"\n                  @click="maybeFollowLink($event, formatDynamicMatches(element))"\n                  />\n                \n                  <template v-for="(loop,index) in returnPostQuery(element.uid)">\n                  \n                    <component is="style" scoped>\n                      {{returnQueryStyles(formatQueryDynamicMatches(element, loop.ID),index)}}\n                    </component>\n                  \n                    <component \n                    :is="element.moduleName"\n                    :modulename="element.moduleName"\n                    :class="getBlockClasses(element, true) + \' uip-query-id-\' + index"\n                    :id="element.uid"\n                    :block-uid="element.uid"\n                    :index="index" \n                    :contextualData="contextualData" \n                    :block="formatQueryDynamicMatches(element, loop.ID)" \n                    uip-block-query="true"\n                    :title="returnToolTip(formatQueryDynamicMatches(element, loop.ID))"\n                    :name="element.name"\n                    @click="maybeFollowLink($event, formatQueryDynamicMatches(element))"\n                    />\n                  \n                  </template>\n                  \n                  \x3c!--Pagination--\x3e\n                  <div class="uip-flex uip-w-100p uip-flex-between uip-pagination-controls" v-if="blockPaginationEnabled(element)">\n                    \n                    <div class="uip-text-muted uip-pagination-count">{{returnPostQueryCount(element.uid)}} {{strings.totalItems}}</div>\n                    \n                    <div v-if="returnPostQueryPageCount(element.uid) > 1" class="uip-flex uip-gap-xs uip-pagination-button-group">\n                      <button class="uip-button-default uip-icon uip-pagination-button uip-border-rounder"\n                      :class="returnPostQueryCurrentPage(element.uid) > 1 ? \'\' : \'uip-link-disabled\'" @click="pagePrevious(element)">chevron_left</button>\n                      \n                      <button class="uip-button-default uip-icon uip-pagination-button uip-border-rounder" \n                      :class="returnPostQueryCurrentPage(element.uid) < returnPostQueryPageCount(element.uid) ? \'\' : \'uip-link-disabled\'" @click="pageNext(element)">chevron_right</button>\n                    </div>\n                    \n                  </div>\n                  \n                </template>\n                \n                \n                <div v-if="!componentExists(element)" class="uip-padding-xxs uip-border-rounder uip-background-green-wash uip-text-s">{{strings.proOptionUnlock}}</div>\n                \n                \n              \n              </template>\n              \n              \n              \n              \n      </uip-draggable>\n      \n\t\t'}};