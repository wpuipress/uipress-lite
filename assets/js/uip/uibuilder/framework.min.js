const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm-dev.js";export default{components:{layersPanels:defineAsyncComponent(()=>import("./layers.min.js?ver=3.2.12")),blockcontextmenu:defineAsyncComponent(()=>import("./block-contextmenu.min.js?ver=3.2.12")),ToolBar:defineAsyncComponent(()=>import("./toolbar.min.js?ver=3.2.12")),Canvas:defineAsyncComponent(()=>import("./canvas.min.js?ver=3.2.12")),BlockList:defineAsyncComponent(()=>import("./block-list.min.js?ver=3.2.12")),TemplateLibrary:defineAsyncComponent(()=>import("./template-library.min.js?ver=3.2.12")),DynamicData:defineAsyncComponent(()=>import("./dynamic-data-watcher.min.js?ver=3.2.12"))},inject:["uipress"],data:function(){return{loading:!0,templateID:this.$route.params.templateID,layoutFetched:!1,unsavedChanges:!1,welcomeMessage:!0,updating:!1,selectedBlocks:[],ui:{contextualMenu:{display:!1,top:"",left:"",block:!1},modal:{open:!1,activeModule:"",title:"",args:{}},settingsPanel:{pos:{}},layers:{display:this.uipApp.data.userPrefs.builderLayers},sideBar:{activeTab:"blocks"},strings:{layers:__("Layers","uipress-lite"),welcomeTitle:__("Welcome to the uiBuilder","uipress-lite"),welcomeMeta:__("Brand new for UiPress 3, the uiBuilder is a powerful drag and drop tool for building great looking, functional admin experiences for yourself or your clients","uipress-lite"),browseTemplates:__("Browse premade templates or start from scratch","uipress-lite"),blankCanvas:__("Blank canvas","uipress-lite"),viewTemplates:__("View templates","uipress-lite"),dontShowAgain:__("Don't show this again","uipress-lite"),close:__("Close","uipress-lite"),deletesAllBlocks:__("Deletes all blocks","uipress-lite"),hideLayers:__("Hide layers","uipress-lite"),shortCuts:__("Block shortcuts","uipress-lite"),shortCutsExplanation:__("As you build your template, key blocks will automatically be added here for easy settings access"),deleteLayout:__("Clear layers","uipress-lite"),searchData:__("Search","uipress-lite")},keyBlocks:[]},template:{copied:!1,notifications:[],activePath:[],activePathLock:!1,windowWidth:window.innerWidth,patterns:[],isPreview:!1,googleAnalyticsRequest:{range:{start:"",end:""},fetching:!1,data:{}},display:"preview",globalSettings:{name:__("Draft Layout","uipress-lite"),status:!1,rolesAndUsers:[],excludesRolesAndUsers:[],type:"ui-template",options:{},menuIcon:{value:""},code:{css:"",js:""}},content:[]},switchOptions:{blocks:{value:"blocks",label:__("Blocks","uipress-lite")},layers:{value:"layers",label:__("Layers","uipress-lite")},library:{value:"library",label:__("Library","uipress-lite")}}}},watch:{"ui.sideBar.activeTab":{handler(e,t){this.$router.push({query:{...this.$route.query,...{tab:e}}})},deep:!0},"$route.params.templateID":{handler(){this.templateID=this.$route.params.templateID,this.template.globalSettings=[],this.template.content=[],this.getTemplate()}}},provide(){return{uiTemplate:this.returnTemplateData,layersPanel:this.ui.layers,openModal:this.openModal,unsavedChanges:this.returnUnsaved}},mounted:function(){let e=this;e.loading=!1,e.getTemplate(),document.addEventListener("uip_page_change_loaded",t=>{e.getNotifications()},{once:!1});for(const t in e.template.layout){let i=e.template.layout[t];e.buildOptions(i.optionsEnabled,i.settings)}let t=e.$route.query;t&&t.tab&&(e.ui.sideBar.activeTab=t.tab),document.addEventListener("right_click_frame",t=>{e.uipress.searchForBlock(e.template.content,t.detail.uid).then(i=>{if(i){let n=document.getElementById(t.detail.uid).getBoundingClientRect();t.detail.pos.y=this.uipApp.data.userPrefs.builderPrefersZoom*t.detail.pos.y+n.y,t.detail.pos.x=this.uipApp.data.userPrefs.builderPrefersZoom*t.detail.pos.x+n.x,e.ui.contextualMenu.block=i,e.setRightClickPos(t.detail.pos),e.ui.contextualMenu.display=!0}})},{once:!1}),window.parent&&window.parent.postMessage({eventName:"uip_request_fullscreen"},"*")},computed:{returnSelectedBlocks(){this.$route.params.uid||(this.selectedBlocks=[]);let e=this,t=this.$route.params.uid;e.uipress.searchForBlock(e.template.content,t).then(t=>{if(t){let i=t,n=document.querySelectorAll(".uip-preview-selected-block");if(!n||!i)return[];for(let t of n)e.selectedBlocks[t];return console.log(e.selectedBlocks),e.selectedBlocks}})},returnTemplateData(){return this.template},returnLayers(){return this.ui.layers},currentRouteName(){return this.$route.name},returnUnsaved(){return this.unsavedChanges},returnOptionsWidth(){let e=parseFloat(this.uipApp.data.userPrefs.builderOptionsWodth);return!((!e||void 0===e||""==e)&&isNaN(e))&&"width:"+e+"px;"},getBlockshortcuts(){return this.ui.keyBlocks=[],this.uipress.findBYmodnameAndReturn(this.template.content,["uip-admin-menu","uip-admin-menu-new","uip-content","uip-toolbar","uip-content-navigator"],this.ui.keyBlocks),this.ui.keyBlocks},returnLeftPanelStyle(){return this.template.isPreview?"transform:scale(0,1);max-width:0%;transition: all 0.2s ease-in-out;transform-origin: left;":"max-width:100%;transition:all 0.2s ease-in-out;transform-origin: left;"}},methods:{getNotifications(){let e,t=document.getElementsByClassName("uip-page-content-frame");if(t[0]){e=t[0].contentWindow.document.querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification")}else e=document.querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification");if(this.template.notifications=[],!e)return;let i=!1;JSON.stringify(this.template.content).includes("site-notifications")&&(i=!0);for(const t of e)this.template.notifications.push(t.outerHTML.replace("uip-framed-page=1","")),i&&t.setAttribute("style","display:none !important; visibility: hidden !important; opacity: 0 !important;");this.uipApp.data.dynamicOptions.notificationCount.value=this.template.notifications.length},addCanvas(){const e=this.uipApp.data.blocks.filter(e=>"uip-container"==e.moduleName);let t=JSON.parse(JSON.stringify(e[0]));delete t.path,delete t.args,delete t.category,delete t.description,delete t.path,t.uid=this.createUID(),t.name=__("Canvas","uipress-lite"),this.uipress.createNestedObject(t,["settings","style","options","flexLayout","value"]),t.settings.style.options.flexLayout.value={direction:"row",distribute:"start",align:"flex-start",wrap:"wrap",type:"stack"},this.template.content.push(t)},injectSavedStyles(e){let t=this.uipApp.data.themeStyles;for(let i in t){let n=t[i];e[n.name]&&("value"in e[n.name]&&(n.value=e[n.name].value),"darkValue"in e[n.name]&&(n.darkValue=e[n.name].darkValue))}for(let t in e){let i=e[t];i.user&&(this.uipApp.data.themeStyles[i.name]=i)}},getTemplate(){let e=this,t=new FormData;t.append("action","uip_get_ui_template"),t.append("security",uip_ajax.security),t.append("templateID",e.templateID),e.layoutFetched=!1,e.sendServerRequest(uip_ajax.ajax_url,t).then(t=>{if(t.error)return void e.uipress.notify(t.message,"","error",!0);t.styles&&e.injectSavedStyles(t.styles);let i=t.settings[0],n=t.content;return e.template.patterns=t.patterns,n?i?("excludesRolesAndUsers"in i&&(e.template.globalSettings.excludesRolesAndUsers=i.excludesRolesAndUsers),"rolesAndUsers"in i&&(e.template.globalSettings.rolesAndUsers=i.rolesAndUsers),"name"in i&&(e.template.globalSettings.name=i.name),"status"in i&&(e.template.globalSettings.status=i.status),"type"in i&&(e.template.globalSettings.type=i.type),"excludesRolesAndUsers"in i&&(e.template.globalSettings.excludesRolesAndUsers=i.excludesRolesAndUsers),"applyToSubsites"in i&&(e.template.globalSettings.applyToSubsites=i.applyToSubsites),"options"in i&&(e.template.globalSettings.options=i.options),"menuParent"in i&&(e.template.globalSettings.menuParent=i.menuParent),"menuIcon"in i&&(e.template.globalSettings.menuIcon=i.menuIcon),e.formatBuilderGroupOptions(),e.unsavedChanges=!1,e.template.content=n,e.template.globalSettings.updatedV312=!0,e.getNotifications(),void requestAnimationFrame(()=>{e.layoutFetched=!0})):("type"in t&&(e.template.globalSettings.type=t.type),0===n.length&&e.addCanvas(),void(e.layoutFetched=!0)):(e.addCanvas(),void(e.layoutFetched=!0))})},formatBuilderGroupOptions(){let e=this.uipApp.data.templateGroupOptions,t=this.template.globalSettings.options;for(let[i,n]of Object.entries(e)){i in t||(t[i]={});for(let e of n.settings)!n.uniqueKey in t[i]&&(e.accepts===String&&(t[group][i]=""),e.accepts===Array&&(t[group][i]=[]),e.accepts===Object&&(t[group][i]={}))}},openThemeLibrary(){this.$router.push({query:{tab:"library"}}),this.ui.sideBar.activeTab="library"},suppressWelcome(){this.welcomeMessage=!1,this.uipApp.data.userPrefs.supressBuilderWelcome=!0,this.uipress.saveUserPreference("supressBuilderWelcome",!0,!1)},closeLayersPanel(){this.ui.layers.display=!1,this.uipress.saveUserPreference("builderLayers",!1,!1)},openModal(e,t,i){e&&""!=e&&(this.ui.modal.activeModule=e,this.ui.modal.title=t,this.ui.modal.args=i,this.ui.modal.open=!0,requestAnimationFrame(()=>{document.documentElement.addEventListener("click",this.onClickOutside,!1)}))},onClickOutside(e){if(!this.$refs.uipmodal)return;const t=e.path||(e.composedPath?e.composedPath():void 0);!t||t.includes(this.$refs.uipmodal)||this.$refs.uipmodal.contains(e.target)||this.closeThisComponent()},closeThisComponent(){this.ui.modal.open=!1,document.documentElement.removeEventListener("click",this.onClickOutside,!1)},confirmEmptyTemplate(){let e=this;this.uipress.confirm(__("Are you sure?","uipress-lite"),__("This will delete all blocks from your template.","uipress-lite")).then(t=>{t&&(e.template.content=[])})},componentExists(e){return!!this.$root._.appContext.components[e]},mouseMoveHandler(e){const t=document.getElementById("uip-builder-settings-panel");let i=e.clientX-this.ui.settingsPanel.pos.startX;t.style.width=this.ui.settingsPanel.pos.width-i+"px"},mouseUpHandler(){document.removeEventListener("mousemove",this.mouseMoveHandler,!0),document.removeEventListener("mouseup",this.mouseUpHandler,!0);const e=document.getElementById("uip-builder-settings-panel");this.uipress.saveUserPreference("builderOptionsWodth",e.style.width,!1)},mouseDownHandler(e){const t=document.getElementById("uip-builder-settings-panel");this.ui.settingsPanel.pos={startX:e.clientX,width:parseInt(t.getBoundingClientRect().width,10)},document.addEventListener("mousemove",this.mouseMoveHandler,!0),document.addEventListener("mouseup",this.mouseUpHandler,!0)},openSettings(e){let t=this.$route.params.templateID;this.$router.push("/uibuilder/"+t+"/settings/blocks/"+e)},showOptions(e,t){let i=this,n=document.querySelector("#uip-builder-settings-panel");if(n&&n.contains(e.target))return;let s=!1;document.querySelector(".uip-template-layers");if(!(s=e.target.closest("[block-uid]")))return void i.closeContextual();let a=s.getAttribute("block-uid");a?(e.preventDefault(),i.uipress.searchForBlock(i.template.content,a).then(t=>{t&&(i.ui.contextualMenu.block=t,i.setRightClickPos(e),i.ui.contextualMenu.display=!0)})):i.closeContextual()},setRightClickPos(e){let t=e.pageX,i=e.pageY;"pageX"in e||(t=e.x,i=e.y);window.innerHeight,i+300>window.innerHeight&&(i-=300),this.ui.contextualMenu.top=`${i}px`,this.ui.contextualMenu.left=`${t}px`},returnContextMenuStyle(){return"top:"+this.ui.contextualMenu.top+"; left:"+this.ui.contextualMenu.left+";"},hideContextual(e){let t=this;t.ui.contextualMenu.display&&(t.$refs.contextualMenu.contains(e.target)||(t.ui.contextualMenu.display=!1))},closeContextual(){this.ui.contextualMenu.display=!1}},template:'\n    \n    \n      <component is="style">\n        .v-enter-active, .v-leave-active {transition: opacity 0.6s ease;}\n        .v-enter-from, .v-leave-to {opacity: 0;}\n      </component>\n      \n      <Transition>\n        <div v-if="!layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-flex-center uip-flex-middle uip-position-fixed uip-z-index-9" \n        style="min-height: 100vh; max-height: 100vh; min-width: 100vw; max-width: 100vw">\n          <loading-chart></loading-chart>\n        </div>\n      </Transition>\n      \n      \n      <component is="style">\n        #wpcontent{margin:0 !important;}\n        #wpadminbar{display:none !important;}\n        html.wp-toolbar{padding-top:0;}\n        #adminmenumain{display:none}\n      </component>\n    \n      <div v-if="layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-text-normal uip-app-frame uip-border-box uip-builder-frame uip-flex uip-flex-column uip-w-100p" >\n          \n          \x3c!--Dynamic data watcher--\x3e\n          <DynamicData/>\n          \n        \n          \x3c!--Builder Toolbar--\x3e\n          <ToolBar/>\n          \n          \n      \n      \n          <div class="uip-flex uip-h-100p uip-flex-grow uip-overflow-hidden uip-position-relative">\n          \n\n            \x3c!--Left panel --\x3e\n            <div class="uip-overflow-auto uip-scrollbar uip-border-right uip-app-frame uip-flex-no-shrink uip-w-300 uip-max-h-100p uip-background-default uip-z-index-1" \n            :style="returnLeftPanelStyle">\n              \n              \n              <div class="uip-flex uip-flex-column uip-h-100p uip-max-h-100p">\n              \n                  <div class="uip-padding-s uip-border-box ">\n                    <toggle-switch :options="switchOptions" :activeValue="ui.sideBar.activeTab" :dontAccentActive="true" :returnValue="function(data){ ui.sideBar.activeTab = data}"></toggle-switch>\n                  </div>\n                  \n                  <div class="uip-padding-left-s uip-padding-right-s uip-flex">\n                    <div class="uip-border-bottom uip-w-100p"></div>\n                  </div>\n                  \n                  \x3c!-- OUTPUT SETTINGS OR BLOCKS --\x3e\n                  <div class="uip-flex-grow uip-overflow-auto uip-padding-s uip-scrollbar">\n                  \n                    <TemplateLibrary v-if="ui.sideBar.activeTab == \'library\'"/>\n                    \n                    <BlockList v-if="ui.sideBar.activeTab == \'blocks\'"/>\n                   \n                    \n                    \x3c!--LAYERS--\x3e\n                    <template v-if="ui.sideBar.activeTab == \'layers\'" >\n                      <div class="uip-flex uip-flex-column uip-row-gap-xs">\n                      \n                        <layersPanels :content="template.content" :returnData="function(data){template.content = data}" />\n                        \n                        \x3c!--Block selector--\x3e\n                        <div class="uip-flex uip-flex-center uip-flex-middle uip-flex-row">\n                          <dropdown width="260" pos="right center" triggerClass="uip-w-100p" class="uip-w-100p">\n                            <template v-slot:trigger>\n                              <div ref="footer" class="uip-text-muted uip-text-center uip-padding-xxs uip-text-center uip-icon uip-link-muted uip-border-rounder uip-border uip-cursor-pointer uip-w-100p uip-text-s" >add</div>\n                            </template>\n                            <template v-slot:content>\n                              <div class="uip-padding-s uip-max-w-300 uip-w-300 uip-max-h-300 uip-overflow-auto uip-scrollbar">\n                                <BlockList mode="click" :insertArea="template.content"/>\n                              </div>\n                            </template>\n                          </dropdown>\n                        </div>\n                        \x3c!--End block selector--\x3e\n                        \n                        \n                        <div class="uip-padding-xs uip-margin-top-s uip-flex uip-flex-column uip-row-gap-xs">\n                        \n                          <div class="uip-text-bold uip-text-m uip-flex uip-gap-xs uip-flex-center uip-flex-between">\n                            {{ui.strings.shortCuts}}\n                          </div>\n                          \n                          <div v-if="getBlockshortcuts.length < 1" class="uip-text-muted uip-text-s">\n                            {{ui.strings.shortCutsExplanation}}\n                          </div>\n                        \n                        </div>\n                          \n                        <div class="uip-flex uip-flex-column uip-row-gap-xxxs uip-padding-xxxs">\n                          \n                          <template v-for="element in getBlockshortcuts">\n                            <div class="uip-flex ui-flex-middle uip-flex-center uip-gap-xxs uip-flex uip-cursor-pointer uip-flex-middle uip-flex-center uip-border-round uip-padding-xxs hover:uip-background-muted" style="min-width:140px">\n                              <div class="uip-cursor-pointer uip-icon uip-padding-xxxs" @click="openSettings(element.uid)">{{element.icon}}</div>\n                              <div class="uip-cursor-pointer uip-flex-grow uip-text-s" @click="openSettings(element.uid)">{{element.name}}</div>\n                            </div>\n                          </template>\n                            \n                        </div>\n                        \n                      </div>\n                      \n                      \n                      \x3c!-- End right click --\x3e\n                    \n                    </template>\n                    \n                    \x3c!--END LAYERS--\x3e\n                    \n                  </div>\n                  \n              </div>\n              \n              \n              \n            </div>\n            \x3c!--End Layers panel --\x3e\n            \n            \x3c!-- Main canvas --\x3e\n            <div class="uip-flex-grow uip-canvas-background">\n              <Canvas/>\n            </div>\n            \x3c!--End canvas--\x3e\n            \n            \n            \x3c!--Right bar --\x3e\n            <router-view :key="$route.path" v-show="!template.isPreview"></router-view>\n            \x3c!-- End right bar --\x3e\n            \n          </div>\n          \n\t      </div>\n      \n        <div ref="modalOuter" v-if="ui.modal.activeModule != \'\' && ui.modal.open" class="uip-position-fixed uip-top-0 uip-left-0 uip-h-viewport uip-w-vw uip-background-black-wash uip-flex uip-flex-center uip-flex-middle uip-fade-in">\n          <div ref="uipmodal" class="uip-background-default uip-border-round uip-border uip-flex uip-flex-column uip-row-gap-s uip-scale-in uip-min-w-350 uip-w-600 uip-max-w-100p uip-text-normal">\n            <div class="uip-flex uip-flex-between  uip-padding-s">\n              <div class="uip-text-bold uip-text-l">{{ui.modal.title}}</div>\n              <div @click="closeThisComponent()" class="hover:uip-background-grey uip-padding-xxs uip-border-round uip-cursor-pointer">\n                <div class="uip-icon uip-text-l">close</div>\n              </div>\n            </div>\n            <div class="uip-max-h-500 uip-overflow-auto uip-scrollbar  uip-padding-s uip-padding-top-remove">\n              <component :is="ui.modal.activeModule" :args="ui.modal.args"></component>\n            </div>\n          </div>\n        </div>\n    \n        \x3c!--Import plugins --\x3e\n        <template v-for="plugin in uipApp.data.plugins" v-if="layoutFetched">\n          <component v-if="componentExists(plugin.component) && plugin.loadInApp" :is="plugin.component"></component>\n        </template>\n        \x3c!-- end plugin import --\x3e\n      \n        \n        \n        \x3c!--Block context menu--\x3e\n        <blockcontextmenu/>\n        \n        \n        \n        \n        \n        \n        \n        '};