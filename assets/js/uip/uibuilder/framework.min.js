const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm.js";export default{components:{layersPanels:defineAsyncComponent(()=>import("./layers.min.js?ver=3.3.1")),blockcontextmenu:defineAsyncComponent(()=>import("./block-contextmenu.min.js?ver=3.3.1")),ToolBar:defineAsyncComponent(()=>import("./toolbar.min.js?ver=3.3.1")),Canvas:defineAsyncComponent(()=>import("./canvas.min.js?ver=3.3.1")),BlockList:defineAsyncComponent(()=>import("./block-list.min.js?ver=3.3.1")),TemplateLibrary:defineAsyncComponent(()=>import("./template-library.min.js?ver=3.3.1")),DynamicData:defineAsyncComponent(()=>import("./dynamic-data-watcher.min.js?ver=3.3.1"))},data(){return{templateID:this.$route.params.templateID,layoutFetched:!1,unsavedChanges:!1,welcomeMessage:!0,updating:!1,selectedBlocks:[],ui:{contextualMenu:{display:!1,top:"",left:"",block:!1},modal:{open:!1,activeModule:"",title:"",args:{}},settingsPanel:{pos:{}},sideBar:{activeTab:"blocks"},strings:{layers:__("Layers","uipress-lite"),welcomeTitle:__("Welcome to the uiBuilder","uipress-lite"),welcomeMeta:__("Brand new for UiPress 3, the uiBuilder is a powerful drag and drop tool for building great looking, functional admin experiences for yourself or your clients","uipress-lite"),blankCanvas:__("Blank canvas","uipress-lite"),viewTemplates:__("View templates","uipress-lite"),dontShowAgain:__("Don't show this again","uipress-lite"),close:__("Close","uipress-lite"),deletesAllBlocks:__("Deletes all blocks","uipress-lite"),hideLayers:__("Hide layers","uipress-lite"),shortCuts:__("Block shortcuts","uipress-lite"),deleteLayout:__("Clear layers","uipress-lite"),searchData:__("Search","uipress-lite")},keyBlocks:[]},template:{copied:!1,notifications:[],activePath:[],activePathLock:!1,windowWidth:window.innerWidth,patterns:[],isPreview:!1,googleAnalyticsRequest:{range:{start:"",end:""},fetching:!1,data:{}},display:"preview",globalSettings:{name:__("Draft Layout","uipress-lite"),status:!1,rolesAndUsers:[],excludesRolesAndUsers:[],type:"ui-template",options:{},menuIcon:{value:""},code:{css:"",js:""}},content:[]},switchOptions:{blocks:{value:"blocks",label:__("Blocks","uipress-lite")},layers:{value:"layers",label:__("Layers","uipress-lite")},library:{value:"library",label:__("Library","uipress-lite")}}}},watch:{"ui.sideBar.activeTab":{handler(e,t){this.$router.push({query:{...this.$route.query,...{tab:e}}})},deep:!0},"$route.params.templateID":{handler(){this.templateID=this.$route.params.templateID,this.template.globalSettings=[],this.template.content=[],this.getTemplate()}}},provide(){return{uiTemplate:this.returnTemplateData}},async created(){await this.getTemplate()},mounted(){this.mountWatchers(),this.setTab()},beforeUnmount(){document.removeEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1}),document.removeEventListener("uipress/app/darkmode/toggle",this.toggleDarkMode,{once:!1})},computed:{returnTemplateData(){return this.template},returnLeftPanelStyle(){return this.template.isPreview?"transform:scale(0,1);max-width:0%;transition: all 0.2s ease-in-out;transform-origin: left;":"max-width:100%;transition:all 0.2s ease-in-out;transform-origin: left;"}},methods:{setTab(){this.$route.query&&this.$route.query.tab&&(this.ui.sideBar.activeTab=this.$route.query.tab)},mountWatchers(){document.addEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1}),document.addEventListener("uipress/app/darkmode/toggle",this.toggleDarkMode,{once:!1}),window.parent&&window.parent.postMessage({eventName:"uip_request_fullscreen"},"*")},toggleDarkMode(){const e=this.uipApp.data.userPrefs.darkTheme;this.uipApp.data.userPrefs.darkTheme=!e;const t=e?"light":"dark";document.documentElement.setAttribute("data-theme",t);const i=document.querySelectorAll("iframe");if(i){for(const e of i){const i=e.contentWindow.document.documentElement;i&&i.setAttribute("data-theme",t)}this.saveUserPreference("darkTheme",!e,!1)}},getNotifications(){const e=document.querySelector(".uip-page-content-frame");let t;if(!(t=(e?e.contentWindow.document:document).querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification")))return;this.template.notifications=[];let i=!1;JSON.stringify(this.template.content).includes("site-notifications")&&(i=!0);for(const e of t)this.template.notifications.push(e.outerHTML.replace("uip-framed-page=1","")),i&&e.setAttribute("style","display:none !important; visibility: hidden !important; opacity: 0 !important;");this.uipApp.data.dynamicOptions.notificationCount.value=this.template.notifications.length},async addCanvas(){const e=this.uipApp.data.blocks.filter(e=>"uip-container"==e.moduleName);let t=JSON.parse(JSON.stringify(e[0]));delete t.path,delete t.args,delete t.category,delete t.description,delete t.optionsEnabled,t.uid=this.createUID(),t.name=__("Canvas","uipress-lite"),t.settings={},t.tooltip={},await nextTick(),this.template.content.push(t)},async getTemplate(){let e=new FormData;e.append("action","uip_get_ui_template"),e.append("security",uip_ajax.security),e.append("templateID",this.templateID),this.layoutFetched=!1;const t=await this.sendServerRequest(uip_ajax.ajax_url,e);if(t.error)return void this.uipApp.notifications.notify(t.message,"","error",!0);let i=t.settings[0],n=t.content,a=t.styles;if(this.isObject(a)&&(this.uipApp.data.themeStyles={...this.uipApp.data.themeStyles,...a}),this.template.patterns=t.patterns,!n||!n.length)return this.addCanvas(),void(this.layoutFetched=!0);if(this.template.content=n,!i)return"type"in t&&(this.template.globalSettings.type=t.type),void(this.layoutFetched=!0);if(this.isObject(i)){const e=this.template.globalSettings;this.template.globalSettings={...e,...i}}this.getNotifications(),await nextTick(),this.layoutFetched=!0},componentExists(e){return!!this.$root._.appContext.components[e]}},template:'\n    \n    \n      <component is="style">\n        .v-enter-active, .v-leave-active {transition: opacity 0.6s ease;}\n        .v-enter-from, .v-leave-to {opacity: 0;}\n      </component>\n      \n      <Transition>\n        <div v-if="!layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-flex-center uip-flex-middle uip-position-fixed uip-z-index-9" \n        style="min-height: 100vh; max-height: 100vh; min-width: 100vw; max-width: 100vw">\n          <loading-chart></loading-chart>\n        </div>\n      </Transition>\n      \n      \n      <component is="style">\n        #wpcontent{margin:0 !important;}\n        #wpadminbar{display:none !important;}\n        html.wp-toolbar{padding-top:0;}\n        #adminmenumain{display:none}\n      </component>\n    \n      <div v-if="layoutFetched" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-text-normal uip-app-frame uip-border-box uip-builder-frame uip-flex uip-flex-column uip-w-100p" >\n          \n          \x3c!--Dynamic data watcher--\x3e\n          <DynamicData/>\n          \n        \n          \x3c!--Builder Toolbar--\x3e\n          <ToolBar/>\n          \n          \n      \n      \n          <div class="uip-flex uip-h-100p uip-flex-grow uip-overflow-hidden uip-position-relative" style="max-width:100vw">\n          \n\n            \x3c!--Left panel --\x3e\n            <div class="uip-overflow-auto uip-border-right uip-app-frame uip-flex-no-shrink uip-w-300 uip-max-h-100p uip-background-default uip-z-index-1" \n            :style="returnLeftPanelStyle">\n              \n              \n              <div class="uip-flex uip-flex-column uip-h-100p uip-max-h-100p">\n              \n                  <div class="uip-padding-s uip-border-box ">\n                    <toggle-switch :options="switchOptions" :activeValue="ui.sideBar.activeTab" :dontAccentActive="true" :returnValue="function(data){ ui.sideBar.activeTab = data}"></toggle-switch>\n                  </div>\n                  \n                  <div class="uip-padding-left-s uip-padding-right-s uip-flex">\n                    <div class="uip-border-bottom uip-w-100p"></div>\n                  </div>\n                  \n                  \x3c!-- OUTPUT SETTINGS OR BLOCKS --\x3e\n                  <div class="uip-flex-grow uip-overflow-auto uip-padding-s uip-scrollbar">\n                  \n                    <TemplateLibrary v-if="ui.sideBar.activeTab == \'library\'"/>\n                    \n                    <BlockList v-if="ui.sideBar.activeTab == \'blocks\'"/>\n                   \n                    \n                    \x3c!--LAYERS--\x3e\n                    <template v-if="ui.sideBar.activeTab == \'layers\'" >\n                      <div class="uip-flex uip-flex-column uip-row-gap-xs">\n                      \n                        <layersPanels :content="template.content" :returnData="function(data){template.content = data}" />\n                      \n                      </div>\n                      \n                      \n                      \x3c!-- End right click --\x3e\n                    \n                    </template>\n                    \n                    \x3c!--END LAYERS--\x3e\n                    \n                  </div>\n                  \n              </div>\n              \n              \n              \n            </div>\n            \x3c!--End Layers panel --\x3e\n            \n            \x3c!-- Main canvas --\x3e\n            <div class="uip-flex-grow uip-canvas-background uip-overflow-hidden">\n              <Canvas/>\n            </div>\n            \x3c!--End canvas--\x3e\n            \n            \n            \x3c!--Right bar --\x3e\n            <router-view :key="$route.path" v-show="!template.isPreview"></router-view>\n            \x3c!-- End right bar --\x3e\n            \n          </div>\n          \n\t      </div>\n      \n        \n        \x3c!--Import plugins --\x3e\n        <template v-for="plugin in uipApp.data.plugins" v-if="layoutFetched">\n          <component v-if="componentExists(plugin.component) && plugin.loadInApp" :is="plugin.component"></component>\n        </template>\n        \x3c!-- end plugin import --\x3e\n      \n        \n        \n        \x3c!--Block context menu--\x3e\n        <blockcontextmenu/>\n        \n        \n        \n        \n        \n        \n        \n        '};