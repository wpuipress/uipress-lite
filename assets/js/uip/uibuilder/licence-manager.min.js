const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{defineAsyncComponent,nextTick}from"../../libs/vue-esm.js";export default{data:()=>({loading:!0,validating:!1,userKey:"",activated:!1,URL:"https://api.uipress.co/",menuWatcher:[],strings:{licence:__("Licence","uipress-lite"),noValidKey:__("Please enter a valid licence key","uipress-lite"),activate:__("Activate","uipress-lite"),validatingKey:__("Validating key","uipress-lite"),licenceActive:__("Licence active","uipress-lite"),removeKey:__("Remove","uipress-lite"),removingKey:__("Removing key","uipress-lite")}}),mounted(){this.getData()},methods:{async validateLicenceKey(){if(!this.userKey)return void this.uipApp.notifications.notify(this.strings.noValidKey,"","error",!0);const i=this.uipApp.notifications.notify(this.strings.validatingKey,"","default",!1,!0);this.validating=!0;let t=this.uipApp.data.options.domain,e="";e+="?k="+this.userKey,e+="&d="+t,e+="&instance=";let s=this.URL+"validate/"+e,a=new FormData;const n=await this.sendServerRequest(s,a);n.error?(this.validating=!1,this.uipApp.notifications.notify(n.message,"","error",!0)):n instanceof Error?(this.validating=!1,this.uipApp.notifications.notify(__("Check failed","uipress-pro"),__("Unable to contact licencing servers. Please try again later","uipress-pro"),"error",!0)):"false"==n.state?(this.validating=!1,this.uipApp.notifications.notify(n.message,"","error",!0)):"true"==n.state?(this.sp=!1,this.validating=!1,this.activated=!0,this.uipApp.notifications.notify(__("Thank you!","uipress-pro"),__("Your key is valid and you can now use pro features","uipress-pro"),"success",!0),this.saveData(this.userKey,n),this.saveUserPreference("uipfa",2,!1),this.userKey=""):(this.validating=!1,this.uipApp.notifications.notify(__("Check failed","uipress-pro"),__("Something went wrong. Please try again later","uipress-pro"),"error",!0)),this.uipApp.notifications.remove(i)},async saveData(i,t){const e="instance_id"in t&&t.instance_id;let s=new FormData;s.append("action","uip_save_uip_pro_data"),s.append("security",uip_ajax.security),s.append("key",i),s.append("instance",e),s.append("multisite",this.uipApp.data.options.multisite),s.append("networkActivated",this.uipApp.data.options.networkActivated),s.append("primarySite",this.uipApp.data.options.primarySite);const a=await this.sendServerRequest(uip_ajax.ajax_url,s);a.error&&this.uipApp.notifications.notify(a.message,"","error",!0)},async getData(){this.loading=!0;let i=new FormData;i.append("action","uip_get_pro_app_data"),i.append("security",uip_ajax.security);const t=await this.sendServerRequest(uip_ajax.ajax_url,i);if(this.loading=!1,t.error)return this.uipApp.notifications.notify(t.message,"","error",!0),void(this.activated=!1);t.uip_pro?(this.activated=!0,this.userData=t.uip_pro):this.activated=!1},removeData(){const i=this.uipApp.notifications.notify(this.strings.removingKey,"","default",!1,!0);let t=new FormData;t.append("action","uip_remove_uip_pro_data"),t.append("security",uip_ajax.security),this.sendServerRequest(uip_ajax.ajax_url,t),this.uipApp.notifications.remove(i),this.uipApp.notifications.notify(__("Key successfully removed","uipress-pro"),"","success",!0),this.activated=!1}},template:'\n  \n  <div v-if="loading" class="uip-w-100p uip-flex uip-flex-middle uip-flex-center uip-padding-s"><loading-chart></loading-chart></div>\n  \n  <div v-else class="uip-grid-col-1-3">\n  \n  \n  \t<div class="uip-text-muted uip-padding-xs uip-max-w-200">{{strings.licence}}</div>\n\t  \n\t  \n\t<form v-if="!activated" class="uip-flex uip-gap-xs uip-flex-no-wrap" autocomplete="off" @submit.prevent="validateLicenceKey">\n\t\t\n\t\t<input class="uip-input-small uip-w-100p" type="password" v-model="userKey" placeholder="xxxx-xxxx-xxxx-xxxx">\n\t\t\n\t\t<input type="submit" class="uip-button-primary uip-text-s" :value="strings.activate"/>\n\t\n\t</form>  \n\t\n\t<div v-else class="uip-flex uip-gap-xs uip-flex-no-wrap">\n\t\n\t\n\t\t<div class="uip-background-green-wash uip-text-green uip-text-bold uip-border-rounder uip-text-s uip-padding-xs uip-flex uip-flex-column uip-row-gap-xs uip-flex-grow uip-text-center">\n\t\t\t{{strings.licenceActive}}\n\t\t</div>\n\t\t\n\t\t<button @click="removeData()"\n\t\tclass="uip-button-primary uip-text-s uip-flex uip-gap-xxs uip-flex-center">\n\t\t\t\n\t\t\t<div class="uip-icon uip-text-muted uip-text-l uip-text-inverse">close</div>\n\t\t\t<span>{{strings.removeKey}}</span>\n\t\t\t\n\t\t</button>\n\t\n\t\n\t</div>\n  \n  </div>\n  \n  '};