const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{nextTick}from"../../libs/vue-esm.js";export default{data:()=>({history:[],currentIndex:-1,track:!1,currentPage:null,maxHistory:20,strings:{undo:__("Undo","uipress-lite"),redo:__("Redo","uipress-lite")}}),inject:["uiTemplate"],watch:{"uiTemplate.content":{immediate:!0,handler(){this.track&&this.addToHistory()},deep:!0},"$route.params.templateID":{immediate:!0,handler(t,i){t!==i&&(this.history=[],this.currentIndex=-1)},deep:!0}},mounted(){this.track=!0,document.addEventListener("keydown",this.watchHistoryKeys)},beforeUnmount(){document.removeEventListener("keydown",this.watchHistoryKeys)},methods:{addToHistory(){const t=this.cloneTemplate(this.uiTemplate.content);if(this.history[this.currentIndex]&&JSON.stringify(this.history[this.currentIndex])===JSON.stringify(t))return;this.history=this.history.slice(0,this.currentIndex+1);const i=this.cloneTemplate(this.uiTemplate.content);this.history.push(i),this.currentIndex++,this.history.length>this.maxHistory&&(this.history.shift(),this.currentIndex--)},cloneTemplate:t=>JSON.parse(JSON.stringify(t)),watchHistoryKeys(t){"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&90===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.shiftKey?this.handleForwardsInHistory():this.handleBackInHistory())},handleBackInHistory(){this.currentIndex<=0||(this.uipApp.scrolling=!0,this.track=!1,this.currentIndex--,this.uiTemplate.content=this.cloneTemplate(this.history[this.currentIndex]),nextTick(()=>{this.track=!0,this.uipApp.scrolling=!1}))},handleForwardsInHistory(){this.currentIndex>=this.history.length-1||(this.uipApp.scrolling=!0,this.track=!1,this.currentIndex++,this.uiTemplate.content=this.cloneTemplate(this.history[this.currentIndex]),nextTick(()=>{this.track=!0,this.uipApp.scrolling=!1}))}},template:'\n    \n      <div class="uip-flex uip-gap-xxs uip-flex-center uip-background-muted uip-border-rounder uip-padding-xs uip-padding-top-xxs uip-padding-bottom-xxs">\n      \n  \t\t<div :title="strings.undo" \n        @click="handleBackInHistory()" \n        class="hover:uip-background-muted uip-border-round uip-flex uip-flex-center  uip-icon uip-link-default uip-text-xl uip-ratio-1-1 uip-line-height-1 uip-icon-medium" :class="{\'uip-link-disabled\' : currentIndex <= 0}">\n\t\t\tundo\n  \t\t</div>\n        \n  \t\t<div :title="strings.redo" \n        @click="handleForwardsInHistory()" \n        class="hover:uip-background-muted uip-border-round uip-flex uip-flex-center  uip-icon uip-link-default uip-text-xl uip-ratio-1-1 uip-line-height-1 uip-icon-medium" \n  \t\t:class="{\'uip-link-disabled\' : currentIndex >= history.length - 1}">\n\t\t\t\tredo\n  \t\t</div>\n        \n        \n      </div>  \n\t  \t'};