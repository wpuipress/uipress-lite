import{nextTick}from"../../libs/vue-esm.js";export default{props:{returnData:Function,value:[String,Array,Object],placeHolder:String,args:Object,size:String},data(){return{option:this.returnDefaultOptions,updating:!1,strings:{newCondition:__("New condition","uipress-lite"),type:__("Type","uipress-lite"),operator:__("Operator","uipress-lite"),searchUsers:__("Search","uipress-lite"),value:__("Value","uipress-lite"),addCondition:__("Add condition","uipress-lite"),editCondition:__("Edit condition","uipress-lite"),users:__("Users","uipress-lite"),dateAndTime:__("Date and time","uipress-lite"),site:__("Site","uipress-lite")},newCondition:{type:"userrole",operator:"is",value:""},conditions:{relations:{and:{value:"and",label:__("And","uipress-lite")},or:{value:"or",label:__("Or","uipress-lite")}},operators:{is:{value:"is",label:__("Is (===)","uipress-lite"),shortHand:"==="},isnot:{value:"isnot",label:__("Is not (!=)","uipress-lite"),shortHand:"!=="},contains:{value:"contains",label:__("Contains","uipress-lite"),shortHand:"contains"}},numericalOperators:{greaterThan:{value:"greaterThan",label:__("Greater than (>)","uipress-lite"),shortHand:">"},greaterThanEqualTo:{value:"greaterThanEqualTo",label:__("Greater than or equal to (>=)","uipress-lite"),shortHand:">="},lessThan:{value:"lessThan",label:__("Less than (<)","uipress-lite"),shortHand:"<"},lessThanEqualTo:{value:"lessThanEqualTo",label:__("Less than or equal to (<=)","uipress-lite"),shortHand:"<="}}}}},watch:{value:{handler(){this.updating||this.injectProp()},deep:!0,immediate:!0},option:{handler(t,e){this.updating||this.returnData(this.option)},deep:!0}},computed:{returnAllOperators(){return{...this.conditions.operators,...this.conditions.numericalOperators}},returnUserTypes:()=>[{value:"userrole",label:__("User role","uipress-lite")},{value:"userlogin",label:__("User login","uipress-lite")},{value:"userid",label:__("User ID","uipress-lite")},{value:"useremail",label:__("User email","uipress-lite")}],returnDateTypes:()=>[{value:"weekday",label:__("Weekday (EN)","uipress-lite")},{value:"date",label:__("Date (YYYY-MM-DD)","uipress-lite")},{value:"time",label:__("Time (HH:MM)","uipress-lite")}],returnSiteTypes:()=>[{value:"siteTitle",label:__("Site title","uipress-lite")},{value:"siteURL",label:__("Site URL","uipress-lite")},{value:"adminURL",label:__("Admin URL","uipress-lite")},{value:"currentPageName",label:__("Current page name","uipress-lite")},{value:"currentURL",label:__("Current URL","uipress-lite")},{value:"locale",label:__("Language (en-US)","uipress-lite")},{value:"pluginActive",label:__("Plugin is active (uipress-lite)","uipress-lite")},{value:"notificationCount",label:__("Notification count","uipress-lite")},{value:"darkMode",label:__("Dark mode (true | false)","uipress-lite")}],hasConditions(){return!!this.option.conditions&&this.option.conditions.length},returnDefaultOptions:()=>({relation:"and",conditions:[]})},methods:{returnOperators(t){return["date","time","userid","notificationCount"].includes(t)?{...this.conditions.operators,...this.conditions.numericalOperators}:this.conditions.operators},async injectProp(){this.updating=!0,this.option=this.isObject(this.value)?this.value:{relation:"and",conditions:[]},await nextTick(),this.updating=!1},async addCondition(){const t=JSON.parse(JSON.stringify(this.newCondition));this.option.conditions.push(t),await this.$nextTick();setTimeout(()=>{const t=this.option.conditions.length-1;this.$refs["condition"+t][0].show()},100)},removeCondition(t){this.option.conditions.splice(t,1)},handleUserReturn(t,e){e.value=t},maybeShowUserSearch(t){return!!this.returnUserTypes.find(e=>e.value===t)}},template:'\n\t\n\t<div class="uip-flex uip-w-100p uip-flex-column uip-row-gap-xs">\n  \n\t  <template v-for="(element, index) in option.conditions">\n    \n\t\t<dropdown pos="left center" class="uip-w-100p" :snapX="[\'#uip-block-settings\']" :ref="\'condition\'+index">\n\t\t  <template v-slot:trigger>\n\t\t\t\n\t\t\t<div class="uip-flex uip-flex-row uip-gap-xxs">\n\t\t\t  <div class="uip-padding-xxs uip-border-rounder uip-text-s uip-background-muted uip-flex-grow uip-text-ellipsis uip-no-wrap uip-overflow-hidden uip-max-w-160">\n\t\t\t\t{{element.type}} {{returnAllOperators[element.operator].shortHand}} {{element.value}}\n\t\t\t  </div>\n\t\t\t  \n\t\t\t  <button class="uip-button-default uip-border-rounder uip-icon uip-padding-xxs uip-link-muted"\n\t\t\t  @click="removeCondition(index)">close</button>\n\t\t\t</div>  \n\t\t\t\n\t\t  </template>\n\t\t  <template v-slot:content>\n\t\t\t<div class="uip-padding-s uip-flex uip-flex-column uip-row-gap-s">\n      \n              <div class="uip-flex uip-flex-between uip-flex-center">\n                <div class="uip-text-emphasis uip-text-bold uip-text-s">{{strings.editCondition}}</div>\n                <div @click="$refs[\'condition\'+index][0].close()" class="uip-flex uip-flex-center uip-flex-middle uip-padding-xxs uip-link-muted hover:uip-background-muted uip-border-rounder">\n                  <span class="uip-icon">close</span>\n                </div>\n              </div>\n\t\t\t\n\t\t\t  <div class="uip-grid-col-1-3">\n\t\t\t  \n\t\t\t\t  <div class="uip-text-muted uip-flex uip-flex-center uip-text-s"><span>{{strings.type}}</span></div>\n\t\t\t\t  <div class="uip-flex uip-flex-center">\n          \n\t\t\t\t\t<select v-model="element.type" \n                    class="uip-input uip-input-small uip-padding-top-xxxs uip-padding-bottom-xxxs uip-max-w-100p uip-w-100p uip-border-rounder" \n                    style="padding-top: 2px; padding-bottom: 2px; border-radius: var(--uip-border-radius-large);">\n          \n                      \x3c!--Users--\x3e\n                      <optgroup :label="strings.users">\n\t\t\t\t\t    <template v-for="item in returnUserTypes">\n\t\t\t\t\t\t  <option :value="item.value">{{item.label}}</option>\n\t\t\t\t\t    </template>\n                      </optgroup>\n                      \n                      \n                      \x3c!--Date & time--\x3e\n                      <optgroup :label="strings.dateAndTime">\n                        <template v-for="item in returnDateTypes">\n                        <option :value="item.value">{{item.label}}</option>\n                        </template>\n                      </optgroup>\n                      \n                      \x3c!--Site--\x3e\n                      <optgroup :label="strings.site">\n                        <template v-for="item in returnSiteTypes">\n                        <option :value="item.value">{{item.label}}</option>\n                        </template>\n                      </optgroup>\n                      \n\t\t\t\t\t</select>\n          \n\t\t\t\t  </div>\n\t\t\t\t  \n\t\t\t\t  <div class="uip-text-muted uip-flex uip-flex-center uip-text-s"><span>{{strings.operator}}</span></div>\n          \n                  <select class="uip-input uip-input-small uip-padding-top-xxxs uip-padding-bottom-xxxs uip-max-w-100p uip-w-100p uip-border-rounder" \n                  v-model="element.operator" style="padding-top: 2px; padding-bottom: 2px; border-radius: var(--uip-border-radius-large);">\n                  \n                    <template v-for="item in returnOperators(element.type)">\n                      <option :value="item.value">{{item.label}}</option>\n                    </template>\n                    \n                  </select>  \n          \n\t\t\t\t  \n\t\t\t\t  <div class="uip-text-muted uip-flex uip-flex-center uip-text-s"><span>{{strings.value}}</span></div>\n\t\t\t\t  <div class="uip-flex uip-flex-center uip-gap-xxs">\n\t\t\t\t\t<input type="text" class="uip-input-small uip-flex-grow" style="min-width:1px" v-model="element.value">\n\t\t\t\t\t<user-role-search \n                    v-if="maybeShowUserSearch(element.type)"\n                    :selected="[]" :returnType="element.type" :searchPlaceHolder="strings.searchUsers" :updateSelected="(d)=>handleUserReturn(d, element)"></user-role-search>\n\t\t\t\t  </div>\n\t\t\t\t  \n\t\t\t  </div>    \n\t\t\t  \n\t\t\t</div>\n\t\t\t\n\t\t  </template>\n\t\t</dropdown>\n\t  \n\t  </template>\n\t  \n\t  <toggle-switch v-if="hasConditions" :options="conditions.relations" :activeValue="option.relation" :dontAccentActive="true" :returnValue="function(data){ option.relation = data;}"></toggle-switch> \n\t  \n\t  <div @click="addCondition()" class="uip-padding-xxs uip-border-rounder uip-background-muted hover:uip-background-grey uip-cursor-pointer uip-flex uip-flex-middle uip-flex-center uip-gap-xs uip-flex-grow">\n\t\t<span class="uip-icon">add</span>\n\t  </div>\n\t  \n\t  \n\t</div>'};