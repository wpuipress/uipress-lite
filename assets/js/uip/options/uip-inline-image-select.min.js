const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;import{uipMediaLibrary}from"../classes/uip-media-library.min.js";export function moduleData(){return{props:{returnData:Function,value:Object,args:Object},data:function(){return{open:!1,loading:!0,hasPositioning:!0,img:{url:"",dynamic:!1,dynamicKey:"",loading:!1,sizing:{}},dynamics:this.uipData.dynamicOptions,maxUpload:this.uipData.options.maxUpload,fileTypes:this.uipData.options.uploadTypes,fileType:"",manualURL:"",uploading:!1,strings:{dynamicData:__("Dynamic data","uipress-lite"),currentValue:__("Current value","uipress-lite"),select:__("select","uipress-lite"),dataPos:__("Dynamic data position","uipress-lite"),replace:__("Replace","uipress-lite"),edit:__("Edit","uipress-lite"),upload:__("Upload","uipress-lite"),uploading:__("Uploading","uipress-lite"),library:__("Library","uipress-lite"),dynamic:__("Dynamic","uipress-lite"),chooseImage:__("Add image","uipress-lite"),backgroundImage:__("Image","uipress-lite"),addImage:__("Add image","uipress-lite"),url:__("URL","uipress-lite")}}},inject:["uipData","uipress"],watch:{img:{handler(i,e){this.returnData(this.img)},deep:!0},manualURL:{handler(i,e){""!=i&&(this.removeDynamicItem(),this.img.url=i)}}},mounted:function(){this.formatInput(this.value),this.args&&this.uipress.isObject(this.args)&&"hasPositioning"in this.args&&(this.hasPositioning=this.args.hasPositioning)},computed:{returnValue(){return this.value},imgReset:()=>({url:"",dynamic:!1,dynamicKey:"",loading:!1,sizing:{}})},methods:{formatInput(i){void 0!==i&&this.uipress.isObject(i)&&(this.img={...this.img,...this.returnValue})},chooseImage(i){let e=this,n=new uipMediaLibrary({multiple:!1,style:"modal",features:["stock","upload","delete"],fileTypes:["image/*"]});n.create(),n.on("uip_media_selected",function(i){i.detail.files&&(e.removeDynamicItem(),e.img.url=i.detail.files.url)})},chooseItem(i){this.img.dynamic=!0,this.img.dynamicType="img",this.img.dynamicKey=i.key,this.img.url=i.value,this.returnData({url:this.img.value,dynamic:this.img.dynamic,dynamicKey:this.img.dynamicKey,dynamicPos:this.img.dynamicPos})},removeDynamicItem(){this.img.dynamic=!1,this.img.dynamicKey="",this.img.url="",this.returnData({url:this.img.value,dynamic:this.img.dynamic,dynamicKey:this.img.dynamicKey,dynamicPos:this.img.dynamicPos})},get_url_extension:i=>i.split(/[#?]/)[0].split(".").pop().trim(),getFileTypeFromUrl(i){let e=this;if(!i||""==i)return void(e.fileType="");let n=new XMLHttpRequest;n.open("GET",i,!0),n.onreadystatechange=function(){let i=n.getResponseHeader("Content-Type");i&&(n.abort(),e.fileType=i)},n.send()},recieveDynamic(i){this.img.dynamic=!0,this.img.dynamicKey=i.key,this.img.dynamicType="img",this.img.url=i.value,this.returnData({url:this.img.value,dynamic:this.img.dynamic,dynamicKey:this.img.dynamicKey,dynamicPos:this.img.dynamicPos})},uploadImage(){let i=this,e=i.uipress.notify(__("Uploading image","uipress-lite"),"","default",!1,!0);i.uploading=!0;let n=document.getElementById("uip-image-upload").files[0];if(!this.fileTypes.includes(n.type))return i.uipress.notify(__("Unable to upload this file type","uipress-lite"),"","error",!0,!1),i.uipress.destroy_notification(e),void(i.uploading=!1);if(n.size>i.maxUpload)return i.uipress.notify(__("Image exceeds max upload size","uipress-lite"),"","error",!0,!1),i.uipress.destroy_notification(e),void(i.uploading=!1);let t=new FormData;t.append("action","uip_upload_image"),t.append("security",uip_ajax.security),t.append("image",n),t.append("file",n),fetch(uip_ajax.ajax_url,{method:"POST",body:t,ContentType:!1,processData:!1,headers:{processData:!1,"process-Data":!1}}).then(i=>i.text()).then(n=>{let t=i.uipress.uipParsJson(n);t.success?(i.removeDynamicItem(),i.img.url=t.url,i.uipress.destroy_notification(e),i.uipress.notify(__("Image uploaded","uipress-lite"),"","success",!0,!1),i.uploading=!1):(i.uipress.notify(__("Unable to handle upload","uipress-lite"),"","error",!0,!1),i.uploading=!1)}).catch(n=>{i.uipress.notify(n,"","error"),i.uipress.destroy_notification(e),i.uploading=!1})},returnBackgroundImage(){let i=this.img.url;return i?`background-image: url(${i})`:""}},template:'\n      <div class="uip-w-100p uip-flex uip-gap-xs">\n      \n        <dropdown pos="left center" triggerClass="uip-flex uip-flex-grow uip-w-100p" containerClass="uip-flex uip-flex-grow uip-w-100p" :dontAnimate="true">\n          <template v-slot:trigger>\n            <div class="uip-background-muted uip-border-rounder uip-padding-xxs uip-flex uip-gap-xs uip-w-100p">\n              <div class="uip-border uip-border-round uip-w-18 uip-ratio-1-1 uip-flex uip-background-cover" :style="returnBackgroundImage()"></div>\n              <div class="uip-text-capitalize">\n                <div v-if="img.url" class="uip-overflow-hidden uip-no-wrap uip-text-ellipsis uip-max-w-100 uip-flex-no-grow uip-text-lowercase">{{img.url}}</div>\n                <div v-else class="uip-text-muted">{{strings.addImage}}...</div>\n              </div>\n            </div>\n          </template>\n          <template v-slot:content>\n            <div class="uip-padding-s uip-border-bottom uip-text-bold">\n              {{strings.backgroundImage}}\n            </div>\n            <div class="uip-padding-s uip-flex uip-flex-column uip-row-gap-s">\n              \n              <div class="uip-background-muted uip-border-rounder uip-flex uip-flex-center uip-flex-middle uip-position-relative uip-scale-in-center uip-h-120 uip-w-240 uip-background-contain uip-background-no-repeat  uip-background-center" :style="returnBackgroundImage()">\n                \n                <dropdown pos="bottom left">\n                  <template v-slot:trigger>\n                  \n                  <div class="uip-button-default">\n                    <div v-if="img.url" class="uip-link-default uip-text-bold">{{strings.replace}}</div>\n                    <div v-if="!img.url" class="uip-flex uip-gap-xxs uip-flex-center">\n                      <div class="uip-icon uip-icon-medium">add</div>\n                      <div class="uip-link-default uip-text-bold">{{strings.chooseImage}}</div>\n                    </div>\n                  </div>  \n                  </template>\n                  <template v-slot:content>\n                    <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xxs uip-w-100 uip-overflow-hidden">\n                      <label class="">\n                        <div class="uip-flex uip-flex-row uip-gap-xs uip-link-default uip-flex-center">\n                          <div v-if="!uploading" class="uip-icon uip-text-l uip-icon-medium">file_upload</div>\n                          <div v-if="uploading" class="uip-load-spinner-dark"></div>\n                          <div v-if="!uploading" class="">{{strings.upload}}</div>\n                          <div v-if="uploading" class="">{{strings.uploading}}</div>\n                        </div>\n                        <input hidden :accept="fileTypes.toString()" type="file" single="" id="uip-image-upload" @change="uploadImage()">\n                      </label>\n                      <div class="uip-flex uip-flex-row uip-gap-xs uip-link-default uip-flex-center" @click="chooseImage()">\n                        <div class="uip-icon uip-text-l uip-icon-medium">photo_library</div>\n                        <div class="">{{strings.library}}</div>\n                      </div>\n                      <dropdown v-if="img.dynamic" pos="bottom left">\n                        <template v-slot:trigger>\n                          <div class="uip-flex uip-flex-row uip-gap-xs uip-link-default uip-flex-center">\n                            <div class="uip-icon uip-text-l uip-icon-medium">database</div>\n                            <div class="">{{strings.dynamic}}</div>\n                          </div>\n                        </template>\n                        <template v-slot:content>\n                          <dynamic-data-list type="image" :returnData="recieveDynamic"></dynamic-data-list>\n                        </template>\n                      </dropdown>\n                    </div>\n                  </template>\n                </dropdown>\n                \n                \n                <div v-if="img.dynamic" class="uip-position-absolute uip-top-0 uip-left-0 uip-padding-xs">\n                  <div class="uip-padding-left-xxs uip-padding-right-xxs uip-background-primary uip-border-round uip-flex uip-gap-xxs uip-flex-center uip-text-inverse uip-cursor-pointer">\n                    <span class="uip-icon uip-icon uip-text-l">database</span>\n                    <span class="uip-text-xs">{{img.dynamicKey}}</span>\n                    <span @click="removeDynamicItem()" class="uip-icon uip-text-l">backspace</span>\n                  </div>\n                </div>\n              </div>\n              \n              \n              \x3c!--Tooltip text --\x3e\n              <div class="uip-grid-col-1-3">\n              \n                <div class="uip-text-muted uip-flex uip-flex-center"><span>{{strings.url}}</span></div>\n                  \n                <input class="uip-input uip-input-small" type="text" v-model="img.url">\n                \n              </div>\n              \n              \n              <background-position v-if="hasPositioning" :value="img.sizing" :returnData="function(d){img.sizing = d}"></background-position>\n              \n            </div>\n            \n          </template>\n        </dropdown>\n        \n        <button class="uip-button-default uip-icon uip-border-rounder uip-padding-xxs uip-link-muted" @click="img = imgReset">close</button>\n        \n        \n        \n      </div>'}};