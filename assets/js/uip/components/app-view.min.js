import{nextTick}from"../../libs/vue-esm-dev.js";export default{props:{},data:function(){return{template:{display:"prod",notifications:[],settings:null,content:null,globalSettings:null,updated:null,id:null},loading:!0,updateAvailable:!1,windowWidth:window.innerWidth}},provide(){return{uiTemplate:this.template}},created(){this.initiateApp()},async mounted(){await this.mountEventListeners(),await nextTick(),this.loading=!1},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1})},computed:{returnTemplateJS(){if(void 0!==this.template.globalSettings.options)return this.hasNestedPath(this.template,"globalSettings","options","advanced","js")},returnTemplateCSS(){if(void 0!==this.template.globalSettings.options)return this.hasNestedPath(this.template,"globalSettings","options","advanced","css")},returnResponsiveClass(){return this.windowWidth>=990?"uip-desktop-view":this.windowWidth>=699?"uip-tablet-view":this.windowWidth<699?"uip-phone-view":void 0},isLoading(){return this.loading}},methods:{initiateApp(){this.template.settings=this.uipParseJson(JSON.stringify(uipUserTemplate.settings)),this.template.content=this.uipParseJson(JSON.stringify(uipUserTemplate.content)),this.template.globalSettings=this.uipParseJson(JSON.stringify(uipUserTemplate.settings)),this.template.updated=this.uipParseJson(uipUserTemplate.updated),this.template.id=uipUserTemplate.id},mountEventListeners(){window.addEventListener("resize",this.handleWindowResize),document.addEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1}),"ui-template"==this.template.globalSettings.type&&setInterval(this.checkForUpdates,6e4)},handleWindowResize(){this.windowWidth=window.innerWidth},getNotifications(){const t=document.querySelector(".uip-page-content-frame");let e;if(!(e=(t?t.contentWindow.document:document).querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification")))return;this.template.notifications=[];let i=!1;JSON.stringify(this.template.content).includes("site-notifications")&&(i=!0);for(const t of e)this.template.notifications.push(t.outerHTML.replace("uip-framed-page=1","")),i&&t.setAttribute("style","display:none !important; visibility: hidden !important; opacity: 0 !important;");this.uipApp.data.dynamicOptions.notificationCount.value=this.template.notifications.length},async checkForUpdates(){if(this.updateAvailable)return;let t=new FormData;t.append("action","uip_check_for_template_updates"),t.append("security",uip_ajax.security),t.append("template_id",this.template.id);const e=await this.sendServerRequest(uip_ajax.ajax_url,t);e.success&&e.updated>this.template.updated&&(this.updateAvailable=!0,this.updateNotification())},updateNotification(){let t=__("Changes have been made to your current app. Refresh the page to update","uipress-lite");this.uipApp.notifications.notify(__("Update available","uipress-lite"),t,"",!0)},componentExists(t){return!!this.$root._.appContext.components[t]}},template:'\n    \n    <component is="style" scoped >\n      .uip-user-frame:not(.uip-app-frame){\n        <template v-for="(item, index) in template.styles">\n          <template v-if="item.value">{{index}}:{{item.value}};</template>\n        </template>\n      }\n      [data-theme="dark"] :not(.uip-app-frame) *{\n        <template v-for="(item, index) in template.styles">\n          <template v-if="item.darkValue"> {{index}}:{{item.darkValue}};</template>\n        </template>\n      }\n      {{returnTemplateCSS}}\n    </component>\n    \n    <component is="script" scoped>\n      {{returnTemplateJS}}\n    </component>\n    \n    <component is="style">\n      .v-enter-active, .v-leave-active {transition: opacity 0.6s ease;}\n      .v-enter-from, .v-leave-to {opacity: 0;}\n    </component>\n    \n    \n    <TransitionGroup>\n    \n      <div v-if="isLoading" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-flex-center uip-flex-middle uip-position-fixed uip-z-index-9" \n      style="min-height: 100vh; max-height: 100vh; min-width: 100vw; max-width: 100vw">\n        <loading-chart></loading-chart>\n      </div>\n      \n      <uip-content-area v-else :content="template.content" :class="returnResponsiveClass"\n      :returnData="function(data) {template.content = data} ">\n      </uip-content-area>\n    \n    </TransitionGroup>\n    \n   \n    \n    \n    \n    \x3c!--Import plugins --\x3e\n    <template v-for="plugin in uipApp.data.plugins">\n      <component v-if="componentExists(plugin.component) && plugin.loadInApp"\n      :is="plugin.component">\n      </component>\n    </template>\n    \x3c!-- end plugin import --\x3e'};