import{nextTick}from"../../libs/vue-esm.js";export default{props:{},data:()=>({template:{display:"prod",notifications:[],settings:null,content:null,globalSettings:null,updated:null,id:null},loading:!0,updateAvailable:!1,windowWidth:window.innerWidth}),provide(){return{uiTemplate:this.template}},created(){this.initiateApp()},async mounted(){await this.mountEventListeners(),await nextTick(),this.loading=!1},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1}),document.removeEventListener("uipress/app/darkmode/toggle",this.toggleDarkMode,{once:!1})},computed:{returnThemeStyles(){return this.isObject(this.uipApp.data.themeStyles)?this.uipApp.data.themeStyles:{}},returnTemplateJS(){if(void 0!==this.template.globalSettings.options)return this.hasNestedPath(this.template,"globalSettings","options","advanced","js")},returnTemplateCSS(){if(void 0!==this.template.globalSettings.options)return this.hasNestedPath(this.template,"globalSettings","options","advanced","css")},returnResponsiveClass(){return this.windowWidth>=990?"uip-desktop-view":this.windowWidth>=699?"uip-tablet-view":this.windowWidth<699?"uip-phone-view":void 0},isLoading(){return this.loading}},methods:{initiateApp(){this.template.settings=this.uipParseJson(JSON.stringify(uipUserTemplate.settings)),this.template.content=this.uipParseJson(JSON.stringify(uipUserTemplate.content)),this.template.globalSettings=this.uipParseJson(JSON.stringify(uipUserTemplate.settings)),this.template.updated=this.uipParseJson(uipUserTemplate.updated),this.template.id=uipUserTemplate.id},mountEventListeners(){window.addEventListener("resize",this.handleWindowResize),document.addEventListener("uipress/app/page/load/finish",this.getNotifications,{once:!1}),document.addEventListener("uipress/app/darkmode/toggle",this.toggleDarkMode,{once:!1}),"ui-template"==this.template.globalSettings.type&&setInterval(this.checkForUpdates,6e4)},handleWindowResize(){this.windowWidth=window.innerWidth},toggleDarkMode(){const e=this.uipApp.data.userPrefs.darkTheme;this.uipApp.data.userPrefs.darkTheme=!e;const t=e?"light":"dark";document.documentElement.setAttribute("data-theme",t);const i=document.querySelectorAll("iframe");if(i){for(const e of i){const i=e.contentWindow.document.documentElement;i&&i.setAttribute("data-theme",t)}this.saveUserPreference("darkTheme",!e,!1)}},getNotifications(){const e=document.querySelector(".uip-page-content-frame");let t;if(!(t=(e?e.contentWindow.document:document).querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification")))return;this.template.notifications=[];let i=!1;JSON.stringify(this.template.content).includes("site-notifications")&&(i=!0);for(const e of t)this.template.notifications.push(e.outerHTML.replace("uip-framed-page=1","")),i&&e.setAttribute("style","display:none !important; visibility: hidden !important; opacity: 0 !important;");this.uipApp.data.dynamicOptions.notificationCount.value=this.template.notifications.length},async checkForUpdates(){if(this.updateAvailable)return;let e=new FormData;e.append("action","uip_check_for_template_updates"),e.append("security",uip_ajax.security),e.append("template_id",this.template.id);const t=await this.sendServerRequest(uip_ajax.ajax_url,e);t.success&&t.updated>this.template.updated&&(this.updateAvailable=!0,this.updateNotification())},updateNotification(){let e=__("Changes have been made to your current app. Refresh the page to update","uipress-lite");this.uipApp.notifications.notify(__("Update available","uipress-lite"),e,"",!0)},componentExists(e){return!!this.$root._.appContext.components[e]}},template:'\n    \n    <component is="style" scoped id="mycustomstyles">\n      #uip-ui-app{\n        <template v-for="(item, index) in returnThemeStyles">\n          <template v-if="item.value && item.value != \'uipblank\'">{{index}}:{{item.value}};</template>\n        </template>\n      }\n      [data-theme="dark"] #uip-ui-app, .uip-dark-mode #uip-ui-app, .uip-dark-mode#uip-ui-app, #uip-ui-app .uip-dark-mode {\n        <template v-for="(item, index) in returnThemeStyles">\n          <template v-if="item.darkValue && item.darkValue != \'uipblank\'"> {{index}}:{{item.darkValue}};</template>\n        </template>\n      }\n      {{returnTemplateCSS}}\n    </component>\n    \n    <component is="script" scoped>\n      {{returnTemplateJS}}\n    </component>\n    \n    <component is="style">\n      .v-enter-active, .v-leave-active {transition: opacity 0.6s ease;}\n      .v-enter-from, .v-leave-to {opacity: 0;}\n    </component>\n    \n    \n    <TransitionGroup>\n    \n      <div v-if="isLoading" class="uip-background-default uip-body-font uip-h-viewport uip-max-h-viewport uip-flex uip-flex-center uip-flex-middle uip-position-fixed uip-z-index-9" \n      style="min-height: 100vh; max-height: 100vh; min-width: 100vw; max-width: 100vw">\n        <loading-chart></loading-chart>\n      </div>\n      \n      <uip-content-area v-else :content="template.content" :class="returnResponsiveClass"\n      :returnData="function(data) {template.content = data} ">\n      </uip-content-area>\n    \n    </TransitionGroup>\n    \n   \n    \n    \n    \n    \x3c!--Import plugins --\x3e\n    <template v-for="plugin in uipApp.data.plugins">\n      <component v-if="componentExists(plugin.component) && plugin.loadInApp"\n      :is="plugin.component">\n      </component>\n    </template>\n    \x3c!-- end plugin import --\x3e'};