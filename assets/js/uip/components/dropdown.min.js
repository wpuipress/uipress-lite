import{nextTick}from"../../libs/vue-esm.js";export default{props:{pos:{type:String,default:"bottom left"},onOpen:Function,offsetX:{type:Number,default:8},offsetY:{type:Number,default:8},snapX:Array,snapY:Array,shortCut:[Boolean,String,Array],hover:Boolean,disableTeleport:Boolean},data:()=>({modelOpen:!1,currentHeight:0,hoverTimeout:!1,pressedKeys:null,position:{left:"auto",right:"auto",top:"auto",bottom:"auto",opacity:0}}),beforeUnmount(){this.removeShortCuts()},mounted(){this.mountShortcut()},methods:{removeShortCuts(){document.removeEventListener("scroll",this.handleScroll,!0),document.body.removeEventListener("click",this.onClickOutside),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)},mountShortcut(){this.shortCut&&(this.pressedKeys=new Set,this.shortcut=[...this.shortCut],window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp))},handleKeyDown(t){this.pressedKeys.add(t.key),this.shortcut.every(t=>this.pressedKeys.has(t))&&this.show()},handleKeyUp(){this.pressedKeys.clear()},resetPosition(){this.position={left:"auto",right:"auto",top:"auto",bottom:"auto",opacity:0}},handleScroll(){this.setPosition()},onClickOutside(t){if(!this.$refs.uipdrop)return this.close();this.$refs.droptrigger.contains(t.target)||this.$refs.uipdrop.contains(t.target)||this.close()},show(){if(this.modelOpen&&!this.hover)return this.close();this.modelOpen=!0,document.addEventListener("scroll",this.handleScroll,!0),this.onOpen&&this.onOpen(),setTimeout(()=>{this.setPosition(),document.body.addEventListener("click",this.onClickOutside)},100)},close(){this.modelOpen=!1,this.position.opacity=0,this.removeShortCuts()},domRectToObject:t=>({top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}),setPosition(){const t=this.$refs.uipdrop,e=this.$refs.droptrigger;if(!t||!e)return;this.resetPosition();let o=this.domRectToObject(e.getBoundingClientRect());const i=window.innerHeight||document.documentElement.clientHeight,s=window.innerWidth||document.documentElement.clientWidth;if(this.snapX&&Array.isArray(this.snapX))for(let t of this.snapX){let e=document.querySelector(t);if(!e)continue;let i=e.getBoundingClientRect();o.left=i.left,o.right=i.right;break}let n=this.pos.split(" "),r=n[0],h=n[1];"bottom"==r&&(this.position.top=`${o.bottom+this.offsetY}px`),"top"==r&&(this.position.bottom=`${i-o.top+this.offsetY}px`),"left"==r&&(this.position.right=`${s-o.left+this.offsetX}px`),"right"==r&&(this.position.left=`${o.right+this.offsetX}px`),"left"==h&&(this.position.left=`${o.left}px`),"right"==h&&(this.position.right=`${s-o.right}px`),"top"==h&&(this.position.top=`${o.top}px`),"bottom"==h&&(this.position.bottom=`${i-o.bottom}px`),"center"!=h||"left"!=r&&"right"!=r||(this.position.top=`${o.top-t.offsetHeight/2}px`),"center"!=h||"top"!=r&&"bottom"!=r||(this.position.left=`${o.left-(t.offsetWidth-e.offsetWidth)/2}px`),nextTick(()=>{let e=t.getBoundingClientRect();e.top<0&&(this.position.top=`${o.top}px`),e.bottom>i&&(this.position.top=`${e.top-(e.bottom-i)-16}px`),e.left<0&&(this.position.left="auto",this.position.right=`${s-2*t.offsetWidth}px`),e.right>s&&(this.position.left=`${s-t.offsetWidth}px`),this.position.opacity=1})},maybeOpen(){this.hover&&(clearTimeout(this.hoverTimeout),this.show())},maybeClose(){this.hover&&(this.hoverTimeout=setTimeout(this.close,400))},clearCloseTimeout(){clearTimeout(this.hoverTimeout)}},template:'\n      <div ref="droptrigger"\n      @mouseenter="maybeOpen"\n      @mouseover="clearCloseTimeout()"\n      @mouseleave="maybeClose"\n      @click="show($event)">\n      \n        <slot name="trigger"/>\n        \n        <teleport to="body" :disabled="disableTeleport">\n          <div v-if="modelOpen && $slots.content" @mouseleave="maybeClose" @mouseover="clearCloseTimeout()"\n          @click.stop\n          ref="uipdrop" class="uip-z-index-9 uip-position-fixed uip-shadow uip-background-default uip-border-rounder uip-body-font uip-dropdown-container" \n          style="border-radius:calc(var(--uip-border-radius-large) + var(--uip-padding-xxs));" :style="position">\n        \n          <slot name="content"/>\n            \n          </div>\n        </teleport>\n        \n      </div>'};